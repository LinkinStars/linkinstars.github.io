<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[GolangÁöÑstrings.goÊ∫êÁ†ÅËß£Êûê - Rabin-Karp‰∫ÜËß£‰∏Ä‰∏ãÔºü]]></title>
    <url>%2F2019%2F06%2F20%2Fgolang%2Fsource-code%2Fstrings-go-source-code%2F</url>
    <content type="text"><![CDATA[stringsÂåÖÊòØÊàë‰ª¨ÁªèÂ∏∏Âú®Â§ÑÁêÜÂ≠óÁ¨¶‰∏≤ÁöÑÊó∂ÂÄôË¶ÅÁî®ÁöÑÔºåËøôÊ¨°Êàë‰ª¨Êù•ÁúãÁúãÂÆÉÂÖ∂‰∏≠ÁöÑ‰∏Ä‰∫õÊñπÊ≥ïÂÖ∑‰ΩìÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÁöÑ„ÄÇÊàëÂ∞±ÊâæÂà∞ÂÖ∂‰∏≠Â∏∏Áî®ÁöÑÂá†‰∏™ÊñπÊ≥ïÔºåÁÑ∂ÂêéÈíàÂØπÂÖ∂‰∏≠ÊØîËæÉÈöæÁöÑÈÉ®ÂàÜËøòÊúâÂ∫îÁî®Âà∞‰∏Ä‰∫õÁâπÂà´ÁÆóÊ≥ïÁöÑÈÉ®ÂàÜËøõË°åÂàÜÊûê„ÄÇ ToUpperÂÖàÊù•Áúã‰∏™ÁÆÄÂçïÁöÑToUpperÔºåÂ∞ÜÊâÄÊúâÂ≠óÁ¨¶ËΩ¨Êç¢ÊàêÂ§ßÂÜô„ÄÇËøô‰∏™Â¶ÇÊûúËÆ©Êàë‰ª¨Ëá™Â∑±ÂÆûÁé∞‰πüÊ≤°Êúâ‰ªÄ‰πàÈöæÂ∫¶ÔºåÂ∞±ÊòØÈÅçÂéÜÊØè‰∏™Â≠óÁ¨¶ËΩ¨Êç¢ÊàêÂ§ßÂÜôÂ∞±ÂèØ‰ª•„ÄÇ 12345678910111213141516171819202122232425262728// ToUpper returns a copy of the string s with all Unicode letters mapped to their upper case.func ToUpper(s string) string &#123; isASCII, hasLower := true, false for i := 0; i &lt; len(s); i++ &#123; c := s[i] if c &gt;= utf8.RuneSelf &#123; isASCII = false break &#125; hasLower = hasLower || (c &gt;= 'a' &amp;&amp; c &lt;= 'z') &#125; if isASCII &#123; // optimize for ASCII-only strings. if !hasLower &#123; return s &#125; b := make([]byte, len(s)) for i := 0; i &lt; len(s); i++ &#123; c := s[i] if c &gt;= 'a' &amp;&amp; c &lt;= 'z' &#123; c -= 'a' - 'A' &#125; b[i] = c &#125; return string(b) &#125; return Map(unicode.ToUpper, s)&#125; ÂèØ‰ª•ÁúãÂà∞ÔºåÊ∫êÁ†Å‰∏≠ËÄÉËôëÁöÑÊØîËæÉÂë®ÂÖ®ÔºåÂà§Êñ≠‰∫Ü‰∏Ä‰∏ãÂ≠óÁ¨¶ÈõÜÁöÑÈóÆÈ¢ò„ÄÇ Â∞èÊäÄÂ∑ßc -= ‚Äòa‚Äô - ‚ÄòA‚ÄôÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ÔºåËøô‰∏™ËΩ¨Êç¢Â§ßÂÜôÁöÑÊäÄÂ∑ßÔºåÂ≠¶‰π†‰∏Ä‰∏ã„ÄÇÂ¶ÇÊûúËΩ¨Êç¢ÊàêÂ∞èÂÜôÔºåÂè™Ë¶ÅÊîπÊàê+Â∞±ÂèØ‰ª•‰∫Ü„ÄÇ ReplaceÁÑ∂ÂêéÁúã‰∏Ä‰∏™Á®çÂæÆÂ§çÊùÇ‰∏Ä‰∫õÁöÑÔºåReplaceÔºåËøô‰∏™ÂáΩÊï∞ÁöÑÁõÆÊ†áÊòØÊõøÊç¢s‰∏≠oldÁöÑÂ≠óÁ¨¶ÔºåÊõøÊç¢Ââçn‰∏™ÔºåÂ¶ÇÊûún‰∏∫Ë¥üÊï∞ÂàôÂÖ®ÈÉ®ÊõøÊç¢„ÄÇ‰Ωú‰∏∫ÂÆûÁé∞‰πüÂÖ∂ÂÆû‰∏çÈöæÔºåÂ∞±ÊòØÊâæÂà∞ÂØπÂ∫îÂ≠óÁ¨¶ÊõøÊç¢Â∞±ÂèØ‰ª•„ÄÇ 123456789101112131415161718192021222324252627282930313233343536373839// Replace returns a copy of the string s with the first n// non-overlapping instances of old replaced by new.// If old is empty, it matches at the beginning of the string// and after each UTF-8 sequence, yielding up to k+1 replacements// for a k-rune string.// If n &lt; 0, there is no limit on the number of replacements.func Replace(s, old, new string, n int) string &#123; if old == new || n == 0 &#123; return s // avoid allocation &#125; // Compute number of replacements. if m := Count(s, old); m == 0 &#123; return s // avoid allocation &#125; else if n &lt; 0 || m &lt; n &#123; n = m &#125; // Apply replacements to buffer. t := make([]byte, len(s)+n*(len(new)-len(old))) w := 0 start := 0 for i := 0; i &lt; n; i++ &#123; j := start if len(old) == 0 &#123; if i &gt; 0 &#123; _, wid := utf8.DecodeRuneInString(s[start:]) j += wid &#125; &#125; else &#123; j += Index(s[start:], old) &#125; w += copy(t[w:], s[start:j]) w += copy(t[w:], new) start = j + len(old) &#125; w += copy(t[w:], s[start:]) return string(t[0:w])&#125; ÂÖ∂ÂÆûÊ†∏ÂøÉÂ∞±ÊòØ‰∏ãÈù¢‰∏âÂè•w += copy(t[w:], s[start:j])w += copy(t[w:], new)start = j + len(old)Âà©Áî®‰∏Ä‰∏™startÂéªÊ†áËÆ∞‰ªéÊóßÂ≠óÁ¨¶‰∏≤ÁöÑÈÇ£‰∏™‰ΩçÁΩÆÂºÄÂßãÂ§çÂà∂ÔºåÂà∞ÁõÆÊ†áÂ≠óÁ¨¶Â§ÑÔºåÁÑ∂ÂêéÂ§çÂà∂ÈúÄË¶ÅÊõøÊç¢ÁöÑÂ≠óÁ¨¶ËøõÂéªÂ∞±ÂèØ‰ª•‰∫ÜÔºåÊúÄÂêéÁßªÂä®start‰∏∫‰∫Ü‰∏ã‰∏ÄÊ¨°ÂáÜÂ§áÂ∞±ÂèØ‰ª•‰∫Ü„ÄÇ Â∞èÊäÄÂ∑ßt := make([]byte, len(s)+n*(len(new)-len(old)))Ëøô‰∏™Âú®Ê∫êÁ†Å‰∏≠ÂæàÊòØÂ∏∏ËßÅÔºåÂëäËØâÊàë‰ª¨‰∏Ä‰∏™ÈÅìÁêÜÔºåÂú®ÂàõÂª∫sliceÁöÑÊó∂ÂÄôÔºåÂ∞ΩÂèØËÉΩÁöÑÂéªÊåáÂÆöÂ•Ω‰Ω†ÈúÄË¶ÅÁöÑÈïøÂ∫¶Êù•ÈÅøÂÖçÊâ©ÂÆπ„ÄÇ IndexÂ•Ω‰∫ÜÔºåÁÉ≠Ë∫´Â∑Æ‰∏çÂ§ö‰∫ÜÔºåÊù•ÁúãÊàë‰ª¨ËøôÊ¨°ÁöÑÈáçÂ§¥ÊàèÔºåindex„ÄÇÊàë‰ª¨ÁªèÂ∏∏ÈúÄË¶ÅÁ°ÆÂÆö‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÊòØÂê¶Â≠òÂú®‰∫éÂè¶‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÂÜÖÔºåÂπ∂‰∏îË¶ÅÁü•ÈÅìÂÆÉÁöÑ‰ΩçÁΩÆÔºåÊâÄ‰ª•ÈúÄË¶ÅindexÊñπÊ≥ï„ÄÇÂÖ∂ÂÆûËØ¥Âà∞Â∫ïÂ∞±ÊòØÂ≠óÁ¨¶‰∏≤ÂåπÈÖçÂòõ„ÄÇ Ëá™Â∑±ÊÄùËÄÉ‰∏ÄËà¨ÁúãÊ∫êÁ†ÅÊàëÈÉΩ‰π†ÊÉØÂÖàËá™Â∑±ÊÉ≥ÊÉ≥ÊÄé‰πàÂéªÂÆûÁé∞ÔºåËøô‰∏™ÊñπÊ≥ïÂØπ‰∫éÊàëÊù•ËØ¥ÂæàÁÜüÊÇâÔºåÂú®java‰∏≠ÂÖ∂ÂÆûÂæàÊö¥ÂäõÔºåÂ∞±ÊòØ‰∏§Â±ÇforÊêûÂÆöÔºåÂÖàÊâæÂà∞Á¨¨‰∏Ä‰∏™‰∏ÄÊ†∑ÁöÑÂ≠óÁ¨¶ÔºåÁÑ∂ÂêéÂåπÈÖçÂâ©‰∏ãÁöÑ„ÄÇÁÑ∂ÂêéÊàë‰πüÁü•ÈÅìÔºåÂ≠óÁ¨¶‰∏≤ÂåπÈÖçÂú®ÁÆóÊ≥ï‰∏≠ÊúâËëóÂêçÁöÑKMPÁÆóÊ≥ïÔºå‰ΩÜÊòØÁêÜËß£ÈöæÂ∫¶ÂæàÂ§ß„ÄÇ‰∏çÁü•ÈÅìgolang‰ºöÊÄé‰πàÂÆûÁé∞Ôºå‰∫éÊòØÊàëÁúãÂà∞‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑÁÆóÊ≥ïRabinKarpÔºàÊàë‰πãÂâç‰∏ç‰∫ÜËß£Ôºâ Ê∫êÁ†Å1234567891011121314151617181920212223func indexRabinKarp(s, substr string) int &#123; // Rabin-Karp search hashss, pow := hashStr(substr) n := len(substr) var h uint32 for i := 0; i &lt; n; i++ &#123; h = h*primeRK + uint32(s[i]) &#125; if h == hashss &amp;&amp; s[:n] == substr &#123; return 0 &#125; for i := n; i &lt; len(s); &#123; h *= primeRK h += uint32(s[i]) h -= pow * uint32(s[i-n]) i++ if h == hashss &amp;&amp; s[i-n:i] == substr &#123; return i - n &#125; &#125; return -1&#125; ‰Ω†ÂÖàËá™Â∑±Â∞ùËØïÁúãÁúãÊòØÂê¶ËÉΩÁúãÂá∫‰ªÄ‰πàÈó®ÈÅìÔºü ÁåúÊµãÊòØ‰∏çÊòØ‰πçÁúã‰πã‰∏ãËøô‰∏™ÊñπÊ≥ïÂæàÂ§çÊùÇÔºåÂêÑÁßçÊìç‰ΩúÁúºËä±Áº≠‰π±ÔºåÂ¶ÇÊûú‰Ω†ÊòØÁ¨¨‰∏ÄÊ¨°ÁúãÊ∫êÁ†ÅÂèØËÉΩÊòØËøôÊ†∑ÁöÑÔºåÁúãÂ§ö‰∫Ü‰Ω†Â∫îËØ•ÊúâÂíåÊàë‰∏ÄÊ†∑ÁöÑÁõ¥ËßâÂíåÁªèÈ™åÔºàÂèçÊ≠£ÊàëÊòØÊúâÊÑüËßâÔºâÊàëÁúãÊ∫êÁ†ÅÁöÑÁ¨¨‰∫å‰∏™Ê≠•È™§Â∞±ÊòØÂ§ßËá¥Áúã‰∏ÄÁúºÔºåÁÑ∂ÂêéÂú®‰∏çÁúã‰ªª‰ΩïÊñáÁ´†Ëß£ÊûêÁöÑÊÉÖÂÜµ‰∏ãÁåúÊµãÂÆÉÁöÑÂÆûÁé∞„ÄÇÂú®ÊàëÁúãÂÆå‰∏äÈù¢‰πãÂêéÁïô‰∏™Êàë‰∏â‰∏™ÈáçÁÇπ hashss, pow := hashStr(substr) h += uint32(s[i]) h -= pow * uint32(s[i-n]) if h == hashss &amp;&amp; s[i-n:i] == substr { ÂÆÉËé∑Âèñ‰∫ÜÂØπÂ∫îÁöÑhashÂÄºÔºåËøô‰∏™ÁÆóÊ≥ïÂíåhashÊúâÂÖ≥ ÂÆÉÂØπÂìàÂ∏åÂÄºËøõË°å‰∫ÜÂ¢ûÂáèÊìç‰Ωú ÂÆÉÊØîËæÉÂìàÂ∏åÂÄºÂíåÂ≠óÁ¨¶‰∏≤‰ªéËÄåÁ°ÆÂÆö‰ΩçÁΩÆ Âà∞ËøôÈáåÔºåÊàëÂ∑≤ÁªèÊúâ‰∫Ü‰∏Ä‰∏™Â§ßÊ¶ÇÁöÑÊÄùË∑ØÔºåËøô‰∏™ÁÆóÊ≥ïÂ∫îËØ•ÊòØÈÄöËøáÂìàÂ∏åÂÄºÂø´ÈÄüÁ°ÆÂÆöÂ≠ê‰∏≤ÊòØÂê¶ÂèØËÉΩÂ≠òÂú®ÔºåÂú®ÂìàÂ∏åÂÄºÁõ∏ÂêåÁöÑÊÉÖÂÜµ‰∏ãÂÜçÂéªÊØîËæÉÁúüÂÆûÁöÑÂ≠óÁ¨¶ÊòØÂê¶‰∏ÄËá¥ÔºåÂêåÊó∂Âú®ËÆ°ÁÆóÂìàÂ∏åÂÄºÁöÑÊó∂ÂÄôÈááÁî®ÁâπÊÆäÁöÑÊú∫Âà∂Êù•ÂÆûÁé∞‰∫ÜÂ¢ûÂä†Â∞±ÂèØ‰ª•ÂÆåÊàêÂìàÂ∏åÁöÑÊîπÂèò„ÄÇÂÖ∂ÂÆûÂ¶ÇÊûú‰Ω†ÊúâÁõ∏ÂêåÁöÑÊÉ≥Ê≥ïÔºåÊÅ≠Âñú‰Ω†ÔºåÂ∑≤ÁªèÂÖ´‰πù‰∏çÁ¶ªÂçÅ‰∫Ü„ÄÇ ÂàÜÊûêÊàë‰ª¨‰∏æ‰∏™ÂÆûÈôÖÁöÑ‰æãÂ≠êÊù•ËØ¥Êòé‰∏äÈù¢ÁöÑ‰∫ãÊÉÖÂéüÊú¨ÁöÑÂ≠óÁ¨¶‰∏≤‰∏∫Ôºö‚ÄùABCDE‚ÄùÔºåÂ≠ê‰∏≤‰∏∫‚ÄùBCD‚ÄùÈ¶ñÂÖàËÆ°ÁÆóÂá∫‚ÄùBCD‚ÄùÁöÑhash‰∏∫100Ôºà‰∏æ‰∏™‰æãÂ≠êÔºâÁÑ∂ÂêéÂæ™ÁéØÂéüÊú¨ÁöÑÂ≠óÁ¨¶‰∏≤ÂèñÂá∫‚ÄùABC‚ÄùËÆ°ÁÆóhash‰∏∫200 != 100ÊâÄ‰ª•‰∏ÄÂÆö‰∏çÊòØÂèñÂá∫Â≠óÁ¨¶DÂéüÊù•ÁöÑhashÂä†DÂáèÂéªAËÆ°ÁÆóhash‰∏∫100 == 100ÔºàËøôÈáåÊ≥®ÊÑèÔºå‰∏çÊòØÈáçÊñ∞ËÆ°ÁÆóÔºåËÄåÊòØÂú®ÂéüÊúâÁöÑÂü∫Á°Ä‰∏äËøõË°åÁöÑËÆ°ÁÆóÔºâÊúÄÂêéËøòÊòØË¶ÅÊØîËæÉ‰∏ÄÈÅçÊòØÂê¶Ê≠£Á°ÆÔºåÂõ†‰∏∫hash‰∏ÄËá¥‰∏ç‰∏ÄÂÆöÂéüÂÄº‰∏ÄËá¥„ÄÇ ÂÅáËÆæÂæÖÂåπÈÖçÂ≠óÁ¨¶‰∏≤ÁöÑÈïøÂ∫¶‰∏∫MÔºåÁõÆÊ†áÂ≠óÁ¨¶‰∏≤ÁöÑÈïøÂ∫¶‰∏∫NÔºåÈÇ£‰πà‰∏ÄÂÖ±ÊØîËæÉN-M+1Â∞±ÂèØ‰ª•‰∫Ü hashÈÇ£‰πàÂÖ∂ÂÆû‰Ω†Â∫îËØ•Ê≥®ÊÑèÂà∞‰∫ÜÔºåÊúÄÁ•ûÂ•áÁöÑÂ∞±ÊòØËøô‰∏™hashÂÄºÔºå‰∏∫‰ªÄ‰πàÂèØ‰ª•ËøôÊ†∑Êìç‰ΩúÔºåÂ¶ÇÊûúÊòØmd5ËøôÁßçÂøÖÈ°ªÈáçÊñ∞ËÆ°ÁÆóÔºåÊòØ‰∏çÂèØËÉΩÂÆåÊàêËøôÊ†∑ÁöÑÊìç‰ΩúÁöÑ„ÄÇ 12345678910111213141516171819// primeRK is the prime base used in Rabin-Karp algorithm.const primeRK = 16777619// hashStr returns the hash and the appropriate multiplicative// factor for use in Rabin-Karp algorithm.func hashStr(sep string) (uint32, uint32) &#123; hash := uint32(0) for i := 0; i &lt; len(sep); i++ &#123; hash = hash*primeRK + uint32(sep[i]) &#125; var pow, sq uint32 = 1, primeRK for i := len(sep); i &gt; 0; i &gt;&gt;= 1 &#123; if i&amp;1 != 0 &#123; pow *= sq &#125; sq *= sq &#125; return hash, pow&#125; Ëøô‰∏™Â∞±ÊòØhashÁÆóÊ≥ïÔºåÂÖ∂ÂÆûÂÆÉÊØèÊ¨°ÂÆåÊàêÁöÑÂ∞±ÊòØ *primeRK Âä†‰∏äÊñ∞ÁöÑÂ≠óÁ¨¶ÔºåÈÇ£‰πàpowÊòØ‰ªÄ‰πàÂë¢ÔºüÂä†ÂáèÁ©∂Á´üÊòØÂ¶Ç‰ΩïÂÆåÊàêÁöÑÂë¢ÔºüÊàë‰∏æ‰∏™‰æãÂ≠ê‰Ω†Â∞±ÊòéÁôΩ‰∫Ü„ÄÇ ËøòÊòØÂàöÊâçÁöÑABCDEÂíåBCDÔºåÊàë‰ª¨Áî®qË°®Á§∫Â∏∏Êï∞primeRKÈÇ£‰πàBCDÁöÑhashËÆ°ÁÆóÂá∫Êù•Â∫îËØ•ÊòØB q^2 + C q + DËÄåABCÁöÑhashÂ∫îËØ•ÊòØA q^2 + B q + CÈÇ£ÂΩìDÊù•ÁöÑÊó∂ÂÄôÂ¶Ç‰ΩïÊìç‰ΩúÁöÑÂë¢ÔºüÂõûÁúã‰∏Ä‰∏ãindexRabinKarpÂ∞±ÊòéÁôΩ‰∫Ü„ÄÇ[A q^2 + B q + C] q + D - A pow= A q^3 - A pow + B q^2 + C q + DÊòéÁôΩ‰∫ÜÂêßÔºåËøô‰∏™powÂÖ∂ÂÆûÂ∞±ÊòØËÆ°ÁÆóhashÂÄºÊó∂ÁöÑÊúÄÈ´òÊåáÊï∞ÔºåÈÄöËøáÊØèÊ¨°ÂáèÂéªÂ∏∏Êï∞ÁöÑÊúÄÈ´òÊåáÊï∞È°πÂ∞±ËÉΩÂÆåÊàê‰πãÂâçÁöÑÊìç‰Ωú„ÄÇ ËÅ™Êòé„ÄÇ‰∏çÁî±Âæó‰Ω©ÊúçËÉΩÊÉ≥Âá∫ËøôÊ†∑ÁÆóÊ≥ïÁöÑ‰∫∫~ ÂÖ∂‰ªñ‰∏Ä‰∫õÊñπÊ≥ïÁúãÂÆåÊúÄÂ§çÊùÇÁöÑindexÂÆûÁé∞ÔºåÂÜçËØ¥ËØ¥Âá†‰∏™Áî±ÂÆÉÂºïÁî≥Âá∫Êù•ÁöÑÊñπÊ≥ï„ÄÇ genSplitÂÖ∂ÂÆûÂ∞±ÊòØÂàÜÁªÑÂ≠óÁ¨¶‰∏≤ÔºåÈÄöËøáÊüê‰∫õÂ≠ê‰∏≤ÂéªÂàÜÂâ≤Êàê‰∏Ä‰∏™‰∏™ÈÉ®ÂàÜÔºåÂÖ∂ÂÆûÂÆûÁé∞Â∞±ÊòØÊØèÊ¨°IndexÊâæÂà∞‰ΩçÁΩÆÁÑ∂ÂêéËøõË°åÂ≠òÂÇ®Âà∞Êñ∞ÁöÑÂú∞ÊñπÂ∞±ÂèØ‰ª•‰∫Ü„ÄÇ123456789for i &lt; n &#123; m := Index(s, sep) if m &lt; 0 &#123; break &#125; a[i] = s[:m+sepSave] s = s[m+len(sep):] i++&#125; countGenericËÆ°Êï∞ÔºåÁªüËÆ°Â≠óÁ¨¶‰∏≤‰∏≠Â≠ê‰∏≤Âá∫Áé∞ÁöÑÊï∞ÁõÆÔºå‰πüÊòØÈÄöËøáindexÂÆåÊàêÔºåÁªüËÆ°‰∏Ä‰∏ãËÄåÂ∑≤12345678for &#123; i := Index(s, substr) if i == -1 &#123; return n &#125; n++ s = s[i+len(substr):]&#125; ÊÄªÁªìÂÖ∂ÂÆûÂæàÂ§öÊ∫êÁ†Å‰∏≠ÁöÑÂÆûÁé∞‰∏çÂ§çÊùÇÔºåÂ§öÁúãÁúãÔºå‰∏ç‰ªÖËÉΩÁÜüÁªÉ‰ΩøÁî®apiËøòËÉΩÂ≠¶Âà∞‰∏Ä‰∫õÈ™öÊìç‰ΩúÔºå‰Ωï‰πêËÄå‰∏ç‰∏∫Âë¢Ôºü‰∏çÂæó‰∏ç‰Ω©Êúç‰∏Ä‰∫õÁâõÈÄºÁöÑÁÆóÊ≥ïÂÆûÁé∞ÔºåÁúüÁöÑÂéâÂÆ≥~]]></content>
      <categories>
        <category>golangÊ∫êÁ†ÅËß£Êûê</category>
      </categories>
      <tags>
        <tag>strings</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[GolangÁöÑslice]]></title>
    <url>%2F2019%2F06%2F18%2Fgolang%2Fsource-code%2Fslice-source-code-review%2F</url>
    <content type="text"><![CDATA[‰ªäÂ§©Êù•ËØ¥‰∏™ÁÆÄÂçïÁöÑÔºå‰πü‰∏çÁÆÄÂçïÁöÑ‰∏úË•øÔºåÈÇ£Â∞±ÊòØÂàáÁâá„ÄÇsliceÂØπ‰∫égolangÊù•ËØ¥ÈÇ£ÁúüÁöÑÊòØ‰∏Ä‰∏™ÈùûÂ∏∏Â∏∏Áî®ÁöÑ‰∏úË•ø‰∫ÜÔºåÂæàÂ§öÂú∞ÊñπÈÉΩ‰ºöÁî®Âà∞ÂÆÉÔºå‰ªäÂ§©Â∞±Êù•ËØ¥ËØ¥ÔºåsliceÂ∫ïÂ±ÇÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÁöÑÔºåÂèàÊúâÂì™‰∫õÂùëÊòØÈúÄË¶ÅÊèêÂâçÊ≥®ÊÑèÁöÑ„ÄÇ sliceÁªìÊûÑÂæàÂ§öÁ¨¨‰∏ÄÊ¨°Êé•Ëß¶golangÁöÑÂêåÂ≠¶ÈÉΩ‰ºöËÆ§‰∏∫ÔºåÊï∞ÁªÑÂíåÂàáÁâáÊòØÂ∑Æ‰∏çÂ§öÁöÑ‰∏úË•øÔºåÂÖ∂ÂÆû‰∏çÊòØÁöÑÔºåÂàáÁâáÊòØÊï∞ÁªÑÁöÑÂ∞ÅË£Ö„ÄÇ12345type slice struct &#123; array unsafe.Pointer len int cap int&#125; ‰∏äÈù¢Ëøô‰∏™Â∞±ÊòØsliceÁöÑÁªìÊûÑÔºåÈ°∫‰æøËØ¥‰∏Ä‰∏ãÔºösliceÁöÑÊ∫êÁ†Å‰ΩçÁΩÆÊòØÔºögo/src/runtime/slice.go ÂÖ∂‰∏≠arrayÊòØ‰∏Ä‰∏™ÊåáÈíàÔºåÊåáÂêëÂ∫ïÂ±ÇÁöÑÊï∞ÁªÑ len‰ª£Ë°®sliceÁöÑÈïøÂ∫¶ cap‰ª£Ë°®sliceÁöÑÂÆπÈáè ‰∏∫‰ªÄ‰πà‰ºöÊúâÈïøÂ∫¶ÂíåÂÆπÈáèËøô‰∏™Âå∫ÂàÜÂë¢ÔºåËøô‰∏§‰∏™‰∏úË•øÊòØÁî®Êù•Âπ≤‰ªÄ‰πàÁöÑÂë¢ÔºüÊàë‰ª¨ÂæÄ‰∏ãÁúã„ÄÇ sliceÁöÑÈïøÂ∫¶ÂíåÂÆπÈáèÊàë‰ª¨ÂÖàÊù•Áúã‰∏Ä‰∏™ÊúÄÁÆÄÂçïÁöÑÊ°à‰æã1234sli := make([]int, 2)fmt.Printf("len=%d cap=%d\n", len(sli), cap(sli))sli = append(sli, 1)fmt.Printf("len=%d cap=%d\n", len(sli), cap(sli)) Êàë‰ª¨ÂàõÂª∫‰∏Ä‰∏™ÈïøÂ∫¶‰∏∫2ÁöÑsliceÁÑ∂ÂêéÊâìÂç∞‰∏Ä‰∏ãÂÆÉÁöÑlenÂíåcap„ÄÇÁÑ∂ÂêéÊ∑ªÂä†‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÂÜçÊ¨°ÊâìÂç∞ÊúÄÂêéÁªìÊûú‰∏∫Ôºölen=2 cap=2len=3 cap=4 ‰ªé‰∏≠Êàë‰ª¨ÂèØ‰ª•Áü•ÈÅìlenÂíåcapÊòØ‰∏çÂêåÁöÑ‰∏úË•øÔºåÊòéÊòæÂòõ„ÄÇ‰ΩÜÊòØ‰∏∫‰ªÄ‰πàÂë¢Ôºü ÂÖ∂ÂÆûÂéüÂõ†ÂæàÁÆÄÂçïÔºåÂõ†‰∏∫Êï∞ÁªÑÂú®ÂàõÂª∫ÁöÑÊó∂ÂÄôÂè™ËÉΩÂàõÂª∫Âõ∫ÂÆöÂ§ßÂ∞èÁöÑÊï∞ÁªÑÔºåËÄåÂΩìsliceÂú®‰∏çÊñ≠ÂæÄÂÖ∂‰∏≠Ê∑ªÂä†ÂÖÉÁ¥†ÁöÑÊó∂ÂÄôÔºåÂäøÂøÖ‰ºöÈÅáÂà∞Â§ßÂ∞è‰∏çÂ§üÁöÑÊÉÖÂÜµÔºåÂ¶ÇÊûúÊØèÊ¨°Ê∑ªÂä†ÈÉΩ‰∏çÂ§üÔºåÈÇ£‰πàÊØèÊ¨°ÈÉΩË¶ÅÂàõÂª∫Êñ∞ÁöÑÊï∞ÁªÑÔºåÈÇ£‰ºöÁõ∏ÂΩìÊµ™Ë¥πÊó∂Èó¥ÂíåËµÑÊ∫êÔºåÊâÄ‰ª•ÂΩì‰∏çÂ§üÁöÑÊó∂ÂÄôÁ¥¢ÊÄß‰∏ÄÊ¨°Â∞±ÂàõÂª∫Â§ß‰∏Ä‰∫õÔºåÊâÄ‰ª•capÂÖ∂ÂÆûÂ∞±‰ª£Ë°®‰∫ÜÊï¥‰ΩìÁöÑ‰∏Ä‰∏™ÂÆπÈáèÔºåËÄålen‰ª£Ë°®ÂΩìÂâçÁî®Âà∞‰∫ÜÁ¨¨Âá†‰∏™„ÄÇ sliceÁöÑÊâ©ÂÆπÂàöÊâçÊèêÂà∞ÁöÑÊï¥‰∏™ËøáÁ®ãÂ∞±ÊòØÊâ©ÂÆπÁöÑÂéüÂõ†ÔºåÈÇ£‰πàsliceÁ©∂Á´üÊòØÂ¶Ç‰ΩïËøõË°åÊâ©ÂÆπÁöÑÂë¢ÔºüÁΩë‰∏äÊàëÁúãËßÅËøá‰∏§‰∏™ËØ¥Ê≥ïÔºö ÊØèÊ¨°2ÂÄç ÂΩìlen&lt;1024ÁöÑÊó∂ÂÄôÊØèÊ¨°2ÂÄçÔºåÂΩìlen&gt;1024ÁöÑÊó∂ÂÄôÊØèÊ¨°1.25ÂÄç ÊàëÊúÄÂêéÂæóÂà∞ÁöÑÁªìËÆ∫ÊòØÂÖ∂ÂÆû‰∏§‰∏™ÈÉΩ‰∏çÂÆåÂÖ®Ê≠£Á°Æ„ÄÇÊ≠£Á°ÆÁöÑÂ∫îËØ•ÁúãÁúãÊ∫êÁ†Å‰∏≠ÊòØÊÄé‰πàËØ¥ÁöÑ„ÄÇ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051func growslice(et *_type, old slice, cap int) slice &#123; ..... newcap := old.cap doublecap := newcap + newcap if cap &gt; doublecap &#123; newcap = cap &#125; else &#123; if old.len &lt; 1024 &#123; newcap = doublecap &#125; else &#123; // Check 0 &lt; newcap to detect overflow // and prevent an infinite loop. for 0 &lt; newcap &amp;&amp; newcap &lt; cap &#123; newcap += newcap / 4 &#125; // Set newcap to the requested cap when // the newcap calculation overflowed. if newcap &lt;= 0 &#123; newcap = cap &#125; &#125; &#125; var overflow bool var lenmem, newlenmem, capmem uintptr const ptrSize = unsafe.Sizeof((*byte)(nil)) switch et.size &#123; case 1: lenmem = uintptr(old.len) newlenmem = uintptr(cap) capmem = roundupsize(uintptr(newcap)) overflow = uintptr(newcap) &gt; _MaxMem newcap = int(capmem) case ptrSize: lenmem = uintptr(old.len) * ptrSize newlenmem = uintptr(cap) * ptrSize capmem = roundupsize(uintptr(newcap) * ptrSize) overflow = uintptr(newcap) &gt; _MaxMem/ptrSize newcap = int(capmem / ptrSize) default: lenmem = uintptr(old.len) * et.size newlenmem = uintptr(cap) * et.size capmem = roundupsize(uintptr(newcap) * et.size) overflow = uintptr(newcap) &gt; maxSliceCap(et.size) newcap = int(capmem / et.size) &#125; ...... return slice&#123;p, old.len, newcap&#125;&#125; Êàë‰ª¨ÁúÅÁï•ÂÖ∂‰∏≠ÈÉ®ÂàÜ‰ª£Á†ÅÁúãÂÖ≥ÈîÆÈÉ®ÂàÜÔºåÈ¶ñÂÖàËØ¥Êòé‰∏Ä‰∏ãgrowsliceËøô‰∏™ÊñπÊ≥ïÊòØÊâ©ÂÆπÁöÑÊñπÊ≥ïÔºåÂÖ∂‰∏≠ÁöÑÂÖ•ÂèÇet *_type, old slice, cap intÂàÜÂà´ÊòØÂÖÉÁ¥†ÁöÑÁ±ªÂûãÔºåËÄÅÁöÑsliceÔºåÊñ∞sliceË¶ÅÊ±ÇÁöÑÊúÄÂ∞èÂÆπÈáèÈíàÂØπÊúÄÂêéËøô‰∏™ÂèÇÊï∞‰∏æ‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠êÔºåÂΩìÂâçÂ¶ÇÊûúÊòØlen=2Ôºåcap=2ÁöÑ‰∏Ä‰∏™sliceÊ∑ªÂä†‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈÇ£‰πàËøô‰∏™ÂèÇÊï∞‰º†ÂÖ•ÁöÑÂ∞±ÊòØ3ÔºåÂõ†‰∏∫ÊúÄÂ∞èÈúÄË¶ÅÂÆπÈáè‰∏∫3„ÄÇ ÂÖ∂ÂÆû‰ªéÂâçÂçäÈÉ®ÂàÜÊù•ÁúãÔºåÁ¨¨‰∫åÁßçËØ¥Ê≥ïÊòØÊ≠£Á°ÆÁöÑÔºåÂΩìlen&lt;1024Á°ÆÂÆûÂ∞±ÊòØ‰∏§ÂÄçÔºåËÄåÂΩìlen&gt;1024ÁöÑÊó∂ÂÄôÔºåÊØèÊ¨°‰ª•ÂéüÊù•ÁöÑ25%Â¢ûÂä†Áõ¥Âà∞Êª°Ë∂≥Ë¶ÅÊ±Ç„ÄÇ ‰ΩÜÊòØÂÖ∂ÂÆû‰Ω†ÁúãÂêéÈù¢ÈÉ®ÂàÜÔºåÊúâ‰∏Ä‰∏™roundupsizeÁöÑÊñπÊ≥ïÔºåÂπ∂‰∏îÂèàÂØπnewcapËøõË°åËµãÂÄºÔºåÊâÄ‰ª•ËÇØÂÆö‰øÆÊîπ‰∫ÜcapÁöÑÂÄºÔºåÊâÄ‰ª•ÂÖ∂ÂÆûÊâ©ÂÆπÂπ∂Ê≤°ÊúâÊèèËø∞ÁöÑÈÇ£‰πàÁÆÄÂçïÔºåÂÆûÈôÖ‰∏≠‰ºöËøõË°åÂÜÖÂ≠òÂØπÈΩêÔºåÂÖ∑‰Ωì‰ªÄ‰πà‰∫ãÂÜÖÂ≠òÂØπÈΩêÂë¢ÔºüÁÆÄÂçïÁöÑÊèèËø∞ÊòØÔºåÂÜÖÂ≠ò‰∏≠ËÇØÂÆö‰∏çÊòØ‰Ω†ÊÉ≥ÊÄé‰πàÊîæÂ∞±ÊÄé‰πàÊîæÁöÑËÇØÂÆöË¶ÅÊª°Ë∂≥‰∏Ä‰∏™ËßÑÂàôÔºåÊúâÁöÑÂú∞ÊñπËôΩÁÑ∂‰Ω†Âè™Ë¶ÅËøô‰πàÁÇπÂú∞ÊñπÔºå‰ΩÜÊòØÁî±‰∫éÁæéËßÇÁöÑË¶ÅÊ±ÇÔºå‰ºöÂ§öÁªô‰Ω†‰∏ÄÁÇπÔºåÂáë‰∏™Êï¥Ôºå‰øùÊåÅÁªü‰∏ÄÊï¥ÈΩêÔºåËøôÂ∞±ÊòØÂÜÖÂ≠òÂØπÈΩê„ÄÇÔºàÊòØ‰∏çÊòØËä±ÈáåËÉ°Âì®ÁöÑÔºåÊàëÂ∞ΩÂèØËÉΩÂ∑≤ÁªèÁôΩËØù‰∫ÜÔºåÂÖ∑‰ΩìËøòÊòØË¶ÅÁúãhttps://blog.csdn.net/u011957758/article/details/85059117ÔºâÊÄª‰πãÔºåÊàë‰ª¨Áü•ÈÅìÔºåsliceÁöÑÊâ©ÂÆπÂπ∂‰∏çÊòØÈÇ£‰πàÁÆÄÂçïÁöÑ„ÄÇÊúÄÂêéÈôÑ‰∏ä‰∏Ä‰∏™‰æãÂ≠ê‰Ωú‰∏∫È™åËØÅÔºö123456789101112func main() &#123; sli := make([]int, 2) preCap := cap(sli) for i := 0; i &lt;= 2048; i++ &#123; sli = append(sli, i) if cap(sli) != preCap &#123; fmt.Printf("len=%4d \t cap=%d\n", len(sli)-1, cap(sli)) preCap = cap(sli) &#125; &#125;&#125; ËæìÂá∫123456789101112len= 2 cap=4len= 4 cap=8len= 8 cap=16len= 16 cap=32len= 32 cap=64len= 64 cap=128len= 128 cap=256len= 256 cap=512len= 512 cap=1024len=1024 cap=1280len=1280 cap=1696len=1696 cap=2304 1280 = 1024 1.251696 = 1280 1.325 sliceÁöÑÊìç‰ΩúÊôÆÈÄöÁöÑÂàõÂª∫Ê∑ªÂä†ÂÖÉÁ¥†ÊàëÂ∞±‰∏çÂ§öËØ¥‰∫ÜÔºå‰Ω†ËÇØÂÆöÁü•ÈÅìÔºå‰Ω†Ë¶ÅÊòØ‰∏çÁü•ÈÅìÂ∞±‰∏ç‰ºöÊù•ÁúãÊàëÁöÑÂçöÂÆ¢‰∫Ü„ÄÇËØ¥‰∏Ä‰∫õÁúãËµ∑Êù•È´òÁ´ØÁöÑÂæÆÊìç„ÄÇ ÂàõÂª∫slicemake([]int, 10, 32)makeÁöÑÊó∂ÂÄôÂèØ‰ª•ÊåáÂÆöÁ¨¨‰∏â‰∏™ÂèÇÊï∞‰πüÂ∞±ÊòØÂàùÂßãÁöÑcap sliceÂà†Èô§‰∏Ä‰∏™ÂÖÉÁ¥†sli = append(sli[:3], sli[4:]‚Ä¶)Âõ†‰∏∫Â∫ïÂ±ÇÊòØÊï∞ÁªÑÔºåÊâÄ‰ª•Âà†Èô§‰∏Ä‰∏™ÂÖÉÁ¥†ÁúãËµ∑Êù•‰ºöÊØîËæÉÈ∫ªÁÉ¶ reslice123456789101112func main() &#123; sli := make([]int, 0) for i := 1; i &lt;= 10; i++ &#123; sli = append(sli, i) &#125; fmt.Println(sli) sli = sli[1:3:5] fmt.Println(sli) fmt.Println(len(sli), cap(sli))&#125; sli = sli[1:3:5]resliceÁöÑÊó∂ÂÄô‰πüÂèØ‰ª•ÊåáÂÆöcapÔºå‰ΩÜÊòØÊ≥®ÊÑèÁöÑÊòØÔºåËøô‰∏™Êó∂ÂÄôÂπ∂‰∏çÊòØÊåáÂÆöÁöÑÊï¥‰ΩìÂÆπÈáè‰∏∫5ÔºåËÄåÊòØÂÆπÈáè‰∏∫ÂéüÊù•slice‰∏ãÊ†á‰∏∫5ÁöÑÂú∞Êñπ„ÄÇÂ¶ÇÊûúÂéüÊù•ÊòØ[1 2 3 4 5 6 7 8 9 10]ÊåâÁÖß‰∏äÈù¢ÁöÑÊìç‰ΩúÔºåÊåâÁÖßÊàëËá™Â∑±ÁöÑÂπ≥Â∏∏ËØ¥ÁöÑÂ∞±ÊòØÂàá‰∏§ÂàÄÔºåÁ¨¨‰∏ÄÂàÄÊòØÂàáÂà∞3ÔºåÁ¨¨‰∫åÂàÄÊòØÂàáÂà∞5sliceÊòØ[2,3]Ôºå‰ΩÜÊòØÂÆûÈôÖÂ∫ïÂ±ÇËøòÊúâ[4,5] capÂ∫îËØ•ÊòØ4ÔºåÊâÄ‰ª•ËæìÂá∫Â∫îËØ•ÊòØÔºö 123[1 2 3 4 5 6 7 8 9 10][2 3]2 4 sliceÁöÑÂùëÁÇπsliceÁöÑÂùëÂÖ∂ÂÆû‰∏ªË¶ÅÂú®‰∫é‰ΩøÁî®ËÄÖÈúÄË¶ÅÊ∏ÖÊ•öÂÄº‰º†ÈÄíÂºïÁî®‰º†ÈÄíÁöÑÂÖ≥Á≥ª„ÄÇÈ¶ñÂÖàÂú®golang‰∏≠Âè™ÊúâÂÄº‰º†ÈÄíÔºåÊ≤°ÊúâÂºïÁî®‰º†ÈÄí„ÄÇ resliceÁöÑÊó∂ÂÄôË¶ÅÊ≥®ÊÑèÔºåÂ¶ÇÊûúÂè™ÊòØresliceÈÇ£‰πàÂêéÁª≠Êìç‰ΩúÊòØ‰ºöÂØπÂéüÊù•ÁöÑsliceÈÄ†ÊàêÂΩ±ÂìçÁöÑ„ÄÇ ‰ΩÜÊòØÂ¶ÇÊûúÁªèËøáappend‰πãÂêéÔºåÈÇ£‰πàÁî±‰∫éÊâ©ÂÆπÁöÑÊó∂ÂÄôÂõûÈáçÊñ∞ÂàÜÈÖçÂÜÖÂ≠òÔºåÂ¶ÇÊûúÊ∂âÂèäÊâ©ÂÆπ‰πãÂêéÔºåÈÇ£‰πàÂ∞±‰∏ç‰ºöÂØπÂéüÊù•ÁöÑsliceÈÄ†ÊàêÂΩ±Âìç„ÄÇ Â¶ÇÊûú‰Ωú‰∏∫ÂáΩÊï∞ÁöÑÂèÇÊï∞‰º†ÈÄíÁöÑÊòØÊï∞ÁªÑÔºåÂõ†‰∏∫ÊòØÂÄº‰º†ÈÄíÔºåÊâÄ‰ª•ÂáΩÊï∞ÂÜÖÈÉ®ÁöÑ‰øÆÊîπ‰∏ç‰ºöÂØπÂ§ñÈÉ®ÁöÑÂèòÈáè‰∫ßÁîüÂΩ±ÂìçÔºå‰ΩÜÊòØÂ¶ÇÊûúÊòØslice‰º†ÈÄíÔºåÈÇ£‰πàÂõ†‰∏∫‰º†ÈÄíÁöÑÊòØÊåáÈíàÔºåÊâÄ‰ª•‰ºö‰øÆÊîπÂ§ñÈÉ®ÁöÑÂèòÈáè„ÄÇ ÂêåÊó∂Âõ†‰∏∫ÊòØÂÄº‰º†ÈÄíÔºåÂΩ¢ÂèÇÁöÑÈáçÊñ∞ËµãÂÄºÊòØ‰∏ç‰ºöÂØπÂ§ñÈÉ®ÁöÑÂèòÈáèÈÄ†ÊàêÂΩ±ÂìçÁöÑ„ÄÇ ‰∏ãÈù¢ÁöÑ‰ª£Á†ÅËØ¥Êòé‰∫Ü‰ª•‰∏äÂèØËÉΩÂá∫Áé∞ÁöÑÂùëÁÇπ1234567891011121314151617181920212223242526272829303132333435363738package mainimport "fmt"func main() &#123; a := [3]int&#123;1, 1, 1&#125; s := []int&#123;1, 1, 1&#125; modifyArray(a) fmt.Println(a) modifySlice(s) fmt.Println(s) reslice(s) fmt.Println(s) s1 := make([]int, 2, 3) s2 := append(s1, 1) s2[0] = 3 fmt.Println(s1) s3 := append(s1, 1, 1) s3[0] = 4 fmt.Println(s1)&#125;func modifyArray(a [3]int) &#123; a[0] = 2&#125;func modifySlice(s []int) &#123; s[0] = 2&#125;func reslice(s []int) &#123; s = s[:2]&#125; ÊÄªÁªìÊÄªÁªì‰∏Ä‰∏ãÔºåÂàõÂª∫sliceÁöÑÊó∂ÂÄôÂ¶ÇÊûúÂèØ‰ª•ÁöÑËØùÂ∞ΩÂèØËÉΩÂàùÂßãÂåñÂ•ΩË¶ÅÁî®ÂÆπÈáèÔºå‰ª•ÂÖçÁªèÂ∏∏Êâ©ÂÆπ„ÄÇslice‰Ωú‰∏∫ÂèÇÊï∞ËøõË°å‰º†ÈÄíÁöÑÊó∂ÂÄôÔºåËøòÊúâsliceËøõË°åappendÁöÑÊó∂ÂÄôÊ≥®ÊÑè‰∏Ä‰∏ãÔºåÂà´ÁöÑÂ∫îËØ•Ê≤°ÊúâÈóÆÈ¢ò„ÄÇÊÄªÁöÑÊù•ËØ¥sliceÁöÑÂÆûÁé∞ËøòÊòØÊØîËæÉÁÆÄÂçïÁöÑ„ÄÇ]]></content>
      <categories>
        <category>golangÊ∫êÁ†ÅËß£Êûê</category>
      </categories>
      <tags>
        <tag>slice</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊµÖÂÖ•Ê∑±Âá∫ETCD‰πã„ÄêÈõÜÁæ§ÈÉ®ÁΩ≤‰∏égolangÂÆ¢Êà∑Á´Ø‰ΩøÁî®„Äë]]></title>
    <url>%2F2019%2F06%2F14%2Fgolang%2Fopen-source-component%2Fetcd-cluster-client%2F</url>
    <content type="text"><![CDATA[‰πãÂâçËØ¥‰∫ÜetcdÁöÑÁÆÄ‰ªãÔºåÂëΩ‰ª§Ë°å‰ΩøÁî®Ôºå‰∏Ä‰∫õÂü∫Êú¨ÂéüÁêÜ„ÄÇËøôÊ¨°Êù•ËØ¥ËØ¥Áé∞ÂÆû‰∏ÄÁÇπÁöÑÈõÜÁæ§ÈÉ®ÁΩ≤ÂíågolangÁâàÊú¨ÁöÑÂÆ¢Êà∑Á´Ø‰ΩøÁî®„ÄÇÂõ†‰∏∫Âú®ÂÆûÈôÖ‰ΩøÁî®ËøáÁ®ã‰∏≠ÔºåetcdÁöÑËäÇÁÇπËÇØÂÆöÊòØÈúÄË¶Å2N+1‰∏™ËøõË°åÈÉ®ÁΩ≤ÁöÑÔºåÊâÄ‰ª•ÊúâÂøÖË¶ÅËØ¥Êòé‰∏Ä‰∏ãÈõÜÁæ§ÁöÑÈÉ®ÁΩ≤„ÄÇ ÈõÜÁæ§ÈÉ®ÁΩ≤ÁΩë‰∏äÊúâÂæàÂ§öÈõÜÁæ§ÈÉ®ÁΩ≤ÁöÑÊïôÁ®ãÔºåÊúâÁöÑÂæàÂ§çÊùÇÔºåÂÖ∂ÂÆûÂØπ‰∫éÊàë‰ª¨ÂÆûÈôÖ‰ΩøÁî®Êù•ËØ¥ÔºåÂÖ∂ÂÆûÈÖçÁΩÆÂπ∂‰∏çÂ§çÊùÇÔºå‰∏ãÈù¢‰∏æ‰æã‰∏ÄÁßçÊúÄÁÆÄÂçïÁöÑÈõÜÁæ§ÈÖçÁΩÆ„ÄÇÔºàÁÆÄÂçïÂà∞‰Ω†ÊÉ≥‰∏çÂà∞~Ôºâ ‰∏ãËΩΩhttps://github.com/etcd-io/etcd/releasesËøòÊòØÂú®github‰∏äÈù¢ÊâæÂà∞ÈúÄË¶Å‰∏ãËΩΩÁöÑÁâàÊú¨Êàë‰ΩøÁî®ÁöÑÊòØetcd-v3.3.13-linux-amd64.tar.gz‰ΩøÁî®wget‰∏ãËΩΩÂà∞linux‰Ω†ÂñúÊ¨¢ÁöÑÁõÆÂΩïÔºåÊàñËÄÖÊú¨Âú∞‰∏ãËΩΩÂÆåÊàê‰πãÂêé‰∏ä‰º†ÂùáÂèØ„ÄÇ ÈÉ®ÁΩ≤È¶ñÂÖàÊàëÊâæ‰∫Ü‰∏âÂè∞Êú∫Âô®ÔºåÂØπÂ∫îip‰∏∫192.168.4.224192.168.4.225192.168.4.226PSÔºöÊèêÈÜí‰∏Ä‰∏ãËÆ∞ÂæóÂºÄÂèëÂØπÂ∫îÈò≤ÁÅ´Â¢ôÁöÑÁ´ØÂè£ ÁÑ∂ÂêéÂ∞Ü‰∏ãËΩΩÁöÑÊñá‰ª∂Ëß£ÂéãÔºå‰πãÂêéËøõÂÖ•Ëß£ÂéãÂêéÁöÑÁõÆÂΩïÔºåÂàÜÂà´‰ΩøÁî®‰∏ãÈù¢ÁöÑÂëΩ‰ª§ÂêØÂä®„ÄÇ(Ê≥®ÊÑè‰∏ãÈù¢ÁöÑÂëΩ‰ª§ÂØπÂ∫îÁöÑÊòØ‰∏âÂè∞‰∏çÂêåÁöÑÊú∫Âô®Ôºå‰Ω†ÈúÄË¶Å‰øÆÊîπÂØπÂ∫î‰∏∫‰Ω†Ëá™Â∑±ÁöÑip) 1234567891011121314151617181920212223$ ./etcd --name infra0 --initial-advertise-peer-urls http://192.168.4.224:2380 \--listen-peer-urls http://192.168.4.224:2380 \--listen-client-urls http://192.168.4.224:2379,http://127.0.0.1:2379 \--advertise-client-urls http://192.168.4.224:2379 \--initial-cluster-token etcd-cluster-1 \--initial-cluster infra0=http://192.168.4.224:2380,infra1=http://192.168.4.225:2380,infra2=http://192.168.4.226:2380 \--initial-cluster-state new$ ./etcd --name infra1 --initial-advertise-peer-urls http://192.168.4.225:2380 \--listen-peer-urls http://192.168.4.225:2380 \--listen-client-urls http://192.168.4.225:2379,http://127.0.0.1:2379 \--advertise-client-urls http://192.168.4.225:2379 \--initial-cluster-token etcd-cluster-1 \--initial-cluster infra0=http://192.168.4.224:2380,infra1=http://192.168.4.225:2380,infra2=http://192.168.4.226:2380 \--initial-cluster-state new$ ./etcd --name infra2 --initial-advertise-peer-urls http://192.168.4.226:2380 \--listen-peer-urls http://192.168.4.226:2380 \--listen-client-urls http://192.168.4.226:2379,http://127.0.0.1:2379 \--advertise-client-urls http://192.168.4.226:2379 \--initial-cluster-token etcd-cluster-1 \--initial-cluster infra0=http://192.168.4.224:2380,infra1=http://192.168.4.225:2380,infra2=http://192.168.4.226:2380 \--initial-cluster-state new Ëá≥Ê≠§Ôºå‰∏â‰∏™ËäÇÁÇπÁöÑÈõÜÁæ§ÈÉ®ÁΩ≤ÂÆåÊàê„ÄÇüòÇüòÇüòÇÊ≤°ÈîôÂ∞±ÊòØËøô‰πàeasyÔºåÊ≤°ÊúâÁΩë‰∏äËØ¥ÁöÑÈÇ£‰πàÂ§çÊùÇ„ÄÇ ÈÖçÁΩÆÊñá‰ª∂Â¶ÇÊûú‰Ω†Â´åÂºÉÊØèÊ¨°‰ΩøÁî®Ëøô‰πàÈïøÁöÑÂëΩ‰ª§ËøõË°åÂêØÂä®Ôºå‰Ω†ÂèØ‰ª•Â∞ÜÂÆÉÂÜô‰∏∫ÈÖçÁΩÆÊñá‰ª∂Ôºö12345678910111213141516171819202122# ÂΩìÂâçËäÇÁÇπÂêçÁß∞name: infra1# etcdÊï∞ÊçÆ‰øùÂ≠òÁõÆÂΩïdata-dir: /usr/local/etcd# ‰æõÂ§ñÈÉ®ÂÆ¢Êà∑Á´Ø‰ΩøÁî®ÁöÑurllisten-client-urls: http://192.168.4.225:2379,http://127.0.0.1:2379# ÂπøÊí≠ÁªôÂ§ñÈÉ®ÂÆ¢Êà∑Á´Ø‰ΩøÁî®ÁöÑurladvertise-client-urls: http://192.168.4.225:2379# ÈõÜÁæ§ÂÜÖÈÉ®ÈÄö‰ø°‰ΩøÁî®ÁöÑURLlisten-peer-urls: http://192.168.4.225:2380# ÂπøÊí≠ÁªôÈõÜÁæ§ÂÜÖÂÖ∂‰ªñÊàêÂëòËÆøÈóÆÁöÑURLinitial-advertise-peer-urls: http://192.168.4.225:2380# ÈõÜÁæ§ÁöÑÂêçÁß∞initial-cluster-token: etcd-cluster-1# ÂàùÂßãÈõÜÁæ§ÊàêÂëòÂàóË°®initial-cluster: infra0=http://192.168.4.224:2380,infra1=http://192.168.4.225:2380,infra2=http://192.168.4.226:2380#ÂàùÂßãÈõÜÁæ§Áä∂ÊÄÅinitial-cluster-state: new ÁÑ∂ÂêéÊåáÂÆöÈÖçÁΩÆÊñá‰ª∂ÁöÑË∑ØÂæÑËøõË°åÂêØÂä®Â∞±ÂèØ‰ª•‰∫Ü1./etcd --config-file=conf.yml ÂÖ∂‰ªñÈÉ®ÁΩ≤Á≠ñÁï•‰ª•‰∏äÁöÑÈÉ®ÁΩ≤‰∏ÄÊñπÈù¢ÔºåÊàë‰∏™‰∫∫ÈÉ®ÁΩ≤Êó∂‰ΩøÁî®ÁöÑÊúÄÁÆÄÂçïÊñπÂºèÔºåÊõ¥ÁÆÄÂçïÁöÑÂèØËÉΩÊòØ‰ΩøÁî®yumËøõË°åetcdÁöÑ‰∏ãËΩΩ„ÄÇÂΩìÁÑ∂‰∏äËø∞ÊñπÂºè‰πüÂ≠òÂú®‰∏Ä‰∫õÈóÆÈ¢òÔºåÁé∞Âú®ÁöÑetcdÁõ∏ÂΩì‰∫éË£∏Â•îÁöÑÊÉÖÂÜµÔºö Ê≤°ÊúâÈâ¥ÊùÉÂ∞±ÊÉ≥Âà∞‰∫é‰ªª‰Ωï‰∫∫Áü•ÈÅìipÂíåÁ´ØÂè£Â∞±ÂèØ‰ª•ËøûÊé•‰∏ä‰Ω†ÁöÑetcdÔºåÊâÄ‰ª•ÂΩìÂâçÂèØËÉΩÂè™ÈÄÇÁî®‰∫éÂÜÖÁΩë‰ΩøÁî®ÔºåÊúçÂä°ÈÄöËøáÂÜÖÁΩëipËøõË°åËÆøÈóÆÔºàËøô‰∏™ÂèØ‰ª•ÈÄöËøáÊ∑ªÂä†ÊùÉÈôêÂíåÁî®Êà∑Êù•ÂÆåÊàêÔºâ ÂΩìÂâçÈÄö‰ø°ÊòØÊ≤°ÊúâÂä†ÂØÜÁöÑ ÂΩìÂâçetcdÊòØÂà©Áî®ÈùôÊÄÅipÊù•ËøõË°åÈÖçÁΩÆÁöÑÔºåÊàëËÆ§‰∏∫Ëøô‰πüÊòØÂÆûÈôÖ‰∏≠Áî®Âà∞ÊúÄÊôÆÈÄöÁöÑÊÉÖÂÜµÔºå‰ΩÜÊòØetcdËøòÊèê‰æõÂèëÁé∞Êú∫Âà∂Êù•ËøõË°åÈÉ®ÁΩ≤ÂíåÈÖçÁΩÆÔºåÊõ¥Âä†ÁÅµÊ¥ª Á≠âÁ≠âÔºåËøô‰∫õÈÉ®ÁΩ≤Á≠ñÁï•Êõ¥Â§öÈíàÂØπ‰∫éÁ∫ø‰∏äÔºåÂõ†‰∏∫ÂÆòÊñπÂÜôÁöÑÈùûÂ∏∏ËØ¶ÁªÜ‰∫ÜÔºåÊàëÊÑüËßâÂÜçÂÜô‰πüÂ∞±Áè≠Èó®ÂºÑÊñß‰∫Ü„ÄÇhttps://doczhcn.gitbook.io/etcd/index/index-1/clustering GolangÂÆ¢Êà∑Á´Ø‰ΩøÁî®ËøôÈáåÊù•ÂÆûÈôÖÁî®‰ª£Á†ÅÊìç‰Ωú‰∏Ä‰∏ãetcdÔºåËøòÊòØÂíå‰πãÂâç‰ΩøÁî®ÂëΩ‰ª§Ë°å‰∏ÄÊ†∑Ôºåget/put/del/watch/leaseÁî®‰∏Ä‰∏ãËøô‰∫õÊìç‰ΩúÔºåÂÖ∂‰ªñÊìç‰ΩúËØ∑Êü•Áúãdochttps://godoc.org/github.com/coreos/etcd/clientv3 ÂÆ¢Êà∑Á´Ø‰∏ãËΩΩËøôÈáå‰∏çÂª∫ËÆÆ‰ΩøÁî®go getËøõË°å‰∏ãËΩΩÔºåÁúüÁöÑÂ§™ÊÖ¢‰∫ÜÔºåÂèØ‰ª•Áõ¥Êé•‰ªégithub‰∏äÈù¢‰∏ãËΩΩ‰πãÂêéÊîæÂà∞ÂØπÂ∫îÁõÆÂΩïÂø´‰∏Ä‰∫õ„ÄÇhttps://github.com/etcd-io/etcd‰∏ãËΩΩËß£Âéã‰πãÂêéÊîæÂà∞gopath‰∏ãÂØπÂ∫îÔºögo/src/go.etcd.io/etcd ‰ª£Á†Å1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980package mainimport ( "context" "fmt" "go.etcd.io/etcd/clientv3" "go.etcd.io/etcd/mvcc/mvccpb" "time")func main() &#123; // ÈÖçÁΩÆÂÆ¢Êà∑Á´ØËøûÊé• client, err := clientv3.New(clientv3.Config&#123; // Endpoints: []string&#123;"127.0.0.1:2379"&#125;, Endpoints: []string&#123;"192.168.4.224:2379", "192.168.4.225:2379", "192.168.4.226:2379"&#125;, DialTimeout: 5 * time.Second, &#125;) if err != nil &#123; panic(err) &#125; defer client.Close() // ÂêØÂä®watchÁõëÂê¨ watch := client.Watch(context.TODO(), "aaa") go func() &#123; for &#123; watchResponse := &lt;- watch for _, ev := range watchResponse.Events &#123; switch ev.Type &#123; case mvccpb.DELETE: fmt.Printf("ÁõëÂê¨Âà∞delÔºö%s\n", ev.Kv.Key) case mvccpb.PUT: fmt.Printf("ÁõëÂê¨Âà∞putÔºö%s, %s\n", ev.Kv.Key, ev.Kv.Value) &#125; &#125; &#125; &#125;() // Êñ∞Â¢û putResponse, err := client.Put(context.TODO(), "aaa", "xxx") if err != nil &#123; fmt.Println(err) return &#125; fmt.Println(putResponse.Header.String()) // Êü•ËØ¢ getResponse, err := client.Get(context.TODO(), "aaa") if err != nil &#123; fmt.Println(err) return &#125; fmt.Println(getResponse.Kvs) // Âà†Èô§ deleteResponse, err := client.Delete(context.TODO(), "aaa") if err != nil &#123; fmt.Println(err) return &#125; fmt.Println(deleteResponse.Header.String()) // Áî≥ËØ∑ÁßüÁ∫¶ grantResponse, err := client.Grant(context.TODO(), 10) if err != nil &#123; fmt.Println(err) return &#125; // ‰ΩøÁî®ÁßüÁ∫¶ response, err := client.Put(context.TODO(), "aaa", "xxx", clientv3.WithLease(grantResponse.ID)) if err != nil &#123; fmt.Println(err) return &#125; fmt.Println(response.Header.String()) // Á≠âÂæÖÁßüÁ∫¶Ëá™Âä®ËøáÊúü time.Sleep(time.Second * 20)&#125; Â§ßËá¥ËÉΩÂæóÂà∞‰ª•‰∏ãËæìÂá∫ ÁõëÂê¨Âà∞putÔºöaaa, xxxcluster_id:14841639068965178418 member_id:10276657743932975437 revision:53 raft_term:4[key:‚Äùaaa‚Äù create_revision:53 mod_revision:53 version:1 value:‚Äùxxx‚Äù ]ÁõëÂê¨Âà∞delÔºöaaacluster_id:14841639068965178418 member_id:10276657743932975437 revision:54 raft_term:4ÁõëÂê¨Âà∞putÔºöaaa, xxxcluster_id:14841639068965178418 member_id:10276657743932975437 revision:55 raft_term:4ÁõëÂê¨Âà∞delÔºöaaa ÂÖ∂ÂÆû‰ΩøÁî®Ëµ∑Êù•ËøòÊòØÈùûÂ∏∏ÁÆÄÂçïÔºåÊàëÂ∞±‰∏çËøáÂ§öËµòËø∞‰∫Ü„ÄÇ]]></content>
      <categories>
        <category>etcd</category>
      </categories>
      <tags>
        <tag>etcd</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊµÖÂÖ•Ê∑±Âá∫ETCD‰πã„ÄêraftÂéüÁêÜ„Äë]]></title>
    <url>%2F2019%2F06%2F12%2Fgolang%2Fopen-source-component%2Fetcd-raft%2F</url>
    <content type="text"><![CDATA[ËøôÊ¨°Êàë‰ª¨Êù•ËØ¥ËØ¥ÔºåÊúâÂÖ≥‰∫éetcdÂéüÁêÜÁöÑ‰∏Ä‰∫õ‰∫ãÊÉÖ„ÄÇ‰πãÂâçÊàë‰ª¨Â∑≤Áªè‰∫ÜËß£Âà∞‰∫ÜetcdÊòØ‰∏Ä‰∏™ÂàÜÂ∏ÉÂºèÁöÑk-vÂ≠òÂÇ®ÔºåÈÇ£‰πàÂÆÉÁ©∂Á´üÊòØÂ¶Ç‰Ωï‰øùËØÅÊï∞ÊçÆÊòØÂ¶Ç‰ΩïÂ§çÂà∂Âà∞ÊØè‰∏™ËäÇÁÇπ‰∏äÈù¢ÂéªÁöÑÂë¢ÔºüÂèàÊòØÂ¶Ç‰Ωï‰øùËØÅÂú®ÁΩëÁªúÂàÜÂå∫ÁöÑÊÉÖÂÜµ‰∏ãËÉΩÊ≠£Â∏∏Â∑•‰Ωú‰∏ãÂéªÔºüraftÂçèËÆÆÂà∞Â∫ïÊòØ‰ªÄ‰πàÔºüÂ∏¶ÁùÄËøô‰∫õÈóÆÈ¢òÊàë‰ª¨ÁªßÁª≠ÂæÄ‰∏ãÁúã„ÄÇ raftÈÄâ‰∏æÁ≠ñÁï•Êàë‰ª¨Áü•ÈÅìetcd‰ΩøÁî®raftÂçèËÆÆÊù•‰øùËØÅÊï¥‰∏™ÂàÜÂ∏ÉÂºèÁöÑËäÇÁÇπÁΩëÁªúËÉΩÊ≠£Â∏∏ÁöÑËøêËΩ¨Âπ∂‰∏îËÉΩÊ≠£Á°ÆÁöÑÂ∞ÜÊï∞ÊçÆÂ§çÂà∂Âà∞ÊØè‰∏™ËäÇÁÇπ‰∏äÈù¢Âéª„ÄÇÈÇ£‰πà‰ªÄ‰πàÊòØraftÂçèËÆÆÂòûÔºü È¶ñÂÖàÊàë‰ª¨ÊúâËøôÊ†∑‰∏Ä‰∏™ËÉåÊôØÔºöraftÊòØÊÉ≥Áª¥Êä§Êï¥‰∏Ä‰∏™ÁΩëÁªúÔºåÂÖ∂‰∏≠Êúâ‰∏Ä‰∏™È¢ÜÂØº‰∫∫ÔºåËøô‰∏™È¢ÜÂØº‰∫∫Ë¥üË¥£Â∞ÜÊî∂Âà∞ÁöÑ‰ø°ÊÅØÂêåÊ≠•ÁªôÁΩëÁªú‰∏≠ÁöÑÂÖ∂‰ªñÊâÄÊúâËäÇÁÇπÔºå‰ªéËÄå‰øùËØÅÊï¥‰∏™ÁΩëÁªúÊï∞ÊçÆ‰∏ÄËá¥„ÄÇ Â¶ÇÊûú‰Ω†Êúâ‰∏ÄÂÆöÁöÑËã±ÊñáÂü∫Á°ÄÔºåÊàëÂª∫ËÆÆÁõ¥Êé•Êü•Áúã‰∏ãÈù¢Ëøô‰∏™ÁΩëÁ´ôÔºåÂÆÉÁî®Âä®ÁîªÈùûÂ∏∏Ê∏ÖÊ•öÁöÑÊèèËø∞‰∫ÜraftÈÄâ‰∏æÁöÑÊï¥‰∏™ËøáÁ®ãÔºöhttp://thesecretlivesofdata.com/raft/ Ëøô‰∏™ÂÖ∂ÂÆûÂ∑≤ÁªèËØ¥ÊòéÁöÑË∂ÖÁ∫ßÊ£í‰∫ÜÔºåÂ¶ÇÊûú‰Ω†ËøòÁúã‰∏çÊáÇÔºåÊàë‰∏ãÈù¢‰ºöÁî®ÊúÄÁÆÄÂçïÁöÑÂá†‰∏™Ë¶ÅÁÇπÊù•ËøõË°åÊúÄÁÆÄÂçïÁöÑËØ¥Êòé„ÄÇ Â§ßÂ§öÊï∞ÁêÜËÆ∫È¶ñÂÖàËØ¥Êòé‰∏Ä‰∏™ÁêÜËÆ∫ÔºåÂè´ÂÅöÂ§ßÂ§öÊï∞ÁêÜËÆ∫ÔºåÂæàÁÆÄÂçïÔºå‰∏æ‰∏™Ê†óÂ≠êÔºö Êúâ10‰∏™‰∫∫ÔºåÂ¶ÇÊûú‰Ω†Â∞ÜËãπÊûúÁªôÂÖ∂‰∏≠ÁöÑ6‰∏™‰∫∫ÔºàÂ§ßÂ§öÊï∞ÔºâÔºåÈÇ£‰πà‰Ω†ÈöèÊú∫ÈÄâÊã©5‰∏™‰∫∫Ôºå‰∏ÄÂÆöÊúâ‰∏Ä‰∏™‰∫∫‰ºöÊúâËãπÊûú„ÄÇ Âú®etcd‰∏≠ÁöÑÂ∫îÁî®Ôºö ÈÄâ‰∏æ‰∏≠Âè™Ë¶ÅÊúâÂ§ßÂ§öÊï∞ÔºàË∂ÖËøáÂçäÊï∞ÁöÑ‰∫∫Áªô‰Ω†ÊäïÁ•®Ôºâ‰Ω†ËÇØÂÆöÂ∞±ÊòØÁ•®Êï∞ÊúÄÂ§öÁöÑ‰∫ÜÔºå‰∏çÂèØËÉΩÊúâ‰∫∫ÊØî‰Ω†Êõ¥Â§ö„ÄÇ Âè™ÈúÄË¶ÅÂ∞ÜÊó•ÂøóÂ§çÂà∂ÁªôÂ§ßÂ§öÊï∞ÁöÑËäÇÁÇπÔºåÈÇ£‰πàÂè™Ë¶ÅÊúâ‰∏ÄÂçäÁöÑËäÇÁÇπÊ≠£Â∏∏Â∑•‰ΩúÂ∞±ËÉΩ‰øùËØÅÊï∞ÊçÆÊúÄÊñ∞ ÈÄâ‰∏æÁä∂ÊÄÅ‰∏ãÈù¢ÊòØ‰∏Ä‰∫õÈÄâ‰∏æËøáÁ®ã‰∏≠ËäÇÁÇπÁöÑÁä∂ÊÄÅleader Ë°®Á§∫ÈÄâ‰∏æÊúÄÁªà‰∫ßÁîüÁöÑÈ¢ÜÂØº‰∫∫candidate ÂÄôÈÄâÁä∂ÊÄÅÔºåË°®Á§∫ÂΩìÂâçÊ≠£Âú®ÂèÇ‰∏éÈÄâ‰∏æfollower Ë°®Á§∫ÈÄâ‰∏æÊúÄÁªàËá™Â∑±‰∏çÊòØÈ¢ÜÂØº‰∫∫ÔºåÈÇ£Ëá™Â∑±Â∞±ÊòØ‰ªéÂ±ûËäÇÁÇπ ÈÄâ‰∏æËøáÁ®ã‰∏éË¶ÅÁÇπ ÊâÄÊúâËäÇÁÇπ‰∏ÄÂºÄÂßãÈÉΩÊòØfollowerÁä∂ÊÄÅ ÂΩìËäÇÁÇπÂ§Ñ‰∫éfollowerÁä∂ÊÄÅÊó∂ÔºåÊØè‰∏™ËäÇÁÇπÈöèÊú∫ÁªèËøá‰∏ÄÊÆµÊó∂Èó¥ÔºåÂ¶ÇÊûúÊ≤°ÊúâÊî∂Âà∞leaderÁöÑÊ∂àÊÅØÂ∞±‰ºöËøõÂÖ•candidateÁä∂ÊÄÅÔºàËØÅÊòéÂΩìÂâçÊ≤°ÊúâleaderËäÇÁÇπÈúÄË¶ÅÈáçÊñ∞ËøõË°åÈÄâ‰∏æÔºâÔºåÂ¶ÇÊûúÊî∂Âà∞‰ø°ÊÅØÂ∞±‰ºöÁªßÁª≠‰øùÊåÅfollowerÁä∂ÊÄÅ ÂΩìËäÇÁÇπÂ§Ñ‰∫écandidateÂ∞±‰ºöË¶ÅÊ±ÇÂà´‰∫∫ÁªôËá™Â∑±ÊäïÁ•®ÔºåÊî∂Âà∞Â§ßÂ§öÊï∞ÁöÑËäÇÁÇπÁöÑÊäïÁ•®ÈÇ£Â∞±ËΩ¨Âèò‰∏∫leaderÁä∂ÊÄÅÔºåÂê¶ÂàôË¶Å‰πàÊòØÂà´ÁöÑËäÇÁÇπÊàê‰∏∫‰∫ÜleaderÔºåË¶Å‰πàÂ∞±ÊòØÂõ†‰∏∫ÁâπÊÆäÊÉÖÂÜµÂØºËá¥ËøôÊ¨°ÈÄâ‰∏æÂ§±Ë¥•ÈáçÊñ∞ËøõË°åÈÄâ‰∏æ ÊØèÊ¨°ÈÄâ‰∏æ‰∏æÂäûÁöÑÊó∂ÂÄôÊúâ‰∏Ä‰∏™termÔºåÂú®ÊØè‰∏Ä‰∏™term‰∏≠ÔºåÊØè‰∏™ËäÇÁÇπÂè™ËÉΩÊäïÁ•®‰∏ÄÊ¨° ÊäïÁ•®ÁöÑÊó∂ÂÄôÂøÖÈ°ªÊäïÁªôÂΩìÂâçÊï∞ÊçÆËá≥Â∞ëÂíåËá™Â∑±‰∏ÄÊ†∑ÁöÑËäÇÁÇπÔºåÂπ∂‰∏îtermÂ§ßÁöÑ‰ºòÂÖà Êó•ÂøóÂ§çÂà∂ËßÑÂàôetcdÊòØÈÄöËøáÊó•ÂøóÂ§çÂà∂Êù•ÂÆûÁé∞Êï∞ÊçÆÂêåÊ≠•ÁöÑËøô‰∏™ÂõæÁΩë‰∏ä‰πüÂæàÂ§öÔºåËØ¥ÊòéÁöÑÊòØÊó•ÂøóÂ§çÂà∂ÁöÑËßÑÂàôÊØè‰∏™ËäÇÁÇπÈÉΩÊúâ‰∏Ä‰ªΩËá™Â∑±ÁöÑÊó•ÂøóÔºåÊúâÁöÑËäÇÁÇπÂ§öÔºåÊúâÁöÑËäÇÁÇπÂ∞ëÔºåÊó•ÂøóÊúÄÂ§öÁöÑËÇØÂÆöÊòØleader„ÄÇ‰∏äÂõæËøòÊúâÂá†‰∏™Ë¶ÅÁÇπÔºåÊàëÁúãÂà´‰∫∫Ê≤°ÊèêÂà∞ÔºåÊàëÂ∞±Êèê‰∏Ä‰∏ãÔºö È¢úËâ≤‰ª£Ë°®term Á¨¨ÂõõË°åË°®Á§∫ÁöÑËøô‰∏™ËäÇÁÇπÔºåÁ¨¨‰∏Äterm‰∏ãÂ§çÂà∂‰∫Ü‰∏§‰∏™Êó•ÂøóÂ∞±ÂºÇÂ∏∏ÊåÇÊéâ‰∫Ü ÊúÄÁªàÂè™ÊúâÁ¨¨‰∏âË°åËøô‰∏™followerÂíåÁ¨¨‰∏ÄË°åÁöÑleader‰øùÊåÅ‰∫ÜÂêåÊ≠• ÂºÇÂ∏∏ÊÉÖÂÜµraft‰πãÊâÄ‰ª•ÂéâÂÆ≥Âõ†‰∏∫Âç≥‰ΩøÂá∫Áé∞‰∏Ä‰∫õÁâπÊÆäÊÉÖÂÜµÔºåÊï¥‰∏™ÁΩëÁªúÂú®‰∏ÄÂÆöÁöÑÊó∂Èó¥‰πãÂêé‰πüËÉΩËá™Âä®ÊÅ¢Â§çÂπ∂Ê≠£Â∏∏Â∑•‰Ωú„ÄÇ ‰∏Ä‰∏™ËäÇÁÇπÁöÑÂºÇÂ∏∏È¶ñÂÖàÊúÄÂ∏∏ËßÅÁöÑÊÉÖÂÜµÂ∞±ÊòØ‰∏Ä‰∏™ËäÇÁÇπÂá∫Áé∞ÂºÇÂ∏∏ÔºåÊúâÂèØËÉΩÊòØËøô‰∏™ËäÇÁÇπÁöÑÊúçÂä°Âô®ÊåÇ‰∫ÜÔºåÊàñËÄÖÂà´ÁöÑ‰ªÄ‰πàÂéüÂõ†„ÄÇ Â¶ÇÊûúÂá∫Áé∞ÈóÆÈ¢òÁöÑËøô‰∏™ËäÇÁÇπÊòØfollowerÔºåÈÇ£‰πàÊ≤°ÊúâÂÖ≥Á≥ªÔºåÊï¥‰∏™ÁΩëÁªú‰æùÊóßËÉΩÊ≠£Â∏∏ËøêË°åÔºåÂΩìËøô‰∏™ËäÇÁÇπÂÜçÊ¨°Âä†ÂÖ•ÁΩëÁªúÁöÑÊó∂ÂÄô‰πüÂè™ÈúÄË¶ÅÂêåÊ≠•ÂêéÈù¢ÁöÑÊï∞ÊçÆÂç≥ÂèØ„ÄÇ Â¶ÇÊûúÂá∫Áé∞ÈóÆÈ¢òÁöÑÊòØleaderÔºåÊúâ‰∏ÄÁÇπÈ∫ªÁÉ¶ÔºåÂõ†‰∏∫ÁΩëÁªú‰∏≠Ê≤°ÊúâleaderËäÇÁÇπ‰∫ÜÔºåÈÇ£‰πàÂ∞±‰ºöÈáçÊñ∞ËøõË°åÈÄâ‰∏æÔºåÈáçÊñ∞Êâæ‰∏Ä‰∏™leaderÔºåÂΩìËøô‰∏™ÂºÇÂ∏∏ËäÇÁÇπÊÅ¢Â§ç‰πãÂêéÂèëÁé∞ÂΩìÂâçÁΩëÁªú‰∏≠Êúâleader‰∫ÜÔºåËÄå‰∏îtermËøòÊØîËá™Â∑±Â§ßÔºåÈÇ£‰πàËá™Â∑±Â∞±ÈÄÄ‰ΩçÁß∞‰∏∫follower„ÄÇ ÁΩëÁªúÂàÜÂå∫ËøòÊúâ‰∏ÄÁßçÂºÇÂ∏∏ÊÉÖÂÜµÊòØÁî±‰∫éÁΩëÁªúÂØºËá¥ÁöÑÔºåÁΩëÁªúÂá∫Áé∞ÂºÇÂ∏∏ÔºåÂØºËá¥ËäÇÁÇπ‰πãÈó¥ÁöÑÈÄö‰ø°Â≠òÂú®ÂºÇÂ∏∏Ôºå‰∏ÄÈÉ®ÂàÜËäÇÁÇπ‰∏éÂè¶‰∏ÄÈÉ®ÂàÜ‰πãÈó¥Ê≤°ÊúâÂäûÊ≥ïËÆøÈóÆ‰∫Ü„ÄÇÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö ‰∏äÈù¢‰∏â‰∏™followerÊ≤°ÊúâÂäûÊ≥ï‰∏é‰∏ãÈù¢ÁöÑËäÇÁÇπËøõË°åÈÄö‰ø°„ÄÇ ÂΩìÂÆ¢Êà∑Á´ØÂÜçÊ¨°ËØ∑Ê±ÇleaderÂèëÈÄÅÊï∞ÊçÆÁöÑÊó∂ÂÄôÔºåleaderÂèëÁé∞Ê≤°ÊúâÂäûÊ≥ïÂ∞ÜÊï∞ÊçÆÂêåÊ≠•ÁªôÁªôÂ§ßÂ§öÊï∞ËäÇÁÇπÔºåÂÆÉÂè™ËÉΩÁªôËá™Â∑±ÂíåÊóÅËæπÁöÑ‰∏Ä‰∏™ÔºåÊ≠§Êó∂leaderÊ≤°ÊúâÂäûÊ≥ïÁªôÂÆ¢Êà∑Á´ØÂèçÈ¶à„ÄÇ ‰∏äÈù¢‰∏â‰∏™ËäÇÁÇπÁî±‰∫éÊî∂‰∏çÂà∞leaderÁöÑÊ∂àÊÅØÔºåÈÇ£‰πà‰ºöËÆ§‰∏∫ÁΩëÁªú‰∏≠Ê≤°ÊúâleaderÂ≠òÂú®Ôºå‰ºöÈáçÊñ∞ËøõË°åÈÄâ‰∏æÊìç‰ΩúÔºåÂõ†‰∏∫ÂΩìÂâç‰∏äÈù¢Êúâ‰∏â‰∏™ËäÇÁÇπÂ≠òÂú®ÔºàÂè™Ë¶ÅÊúâË∂ÖËøáÂçäÊï∞ÁöÑËäÇÁÇπÂèÇ‰∏éÈÄâ‰∏æÂ∞±Ë°åÔºâÔºåÊâÄ‰ª•ÂèØ‰ª•ÈáçÊñ∞ÈÄâ‰∏æÊàêÂäüÔºåÈÄâÂá∫Êñ∞ÁöÑleaderÂëäËØâÂÆ¢Êà∑Á´ØÔºåÂÆ¢Êà∑Á´ØÂ∞±‰ºöÈáçÊñ∞ÂèëÈÄÅÊï∞ÊçÆÂà∞Êñ∞ÁöÑleader„ÄÇ ÂΩìÁΩëÁªúÊÅ¢Â§ç‰πãÂêéÂèà‰ºöÊâæÂà∞ÊúÄÊñ∞ÁöÑleader‰ªéËÄåÂ∞ÜÊï∞ÊçÆÂêåÊ≠•Ëá≥ÊúÄÊñ∞ÁöÑÁä∂ÊÄÅ„ÄÇ ÊÄªÁªìÊÄªÁöÑÊù•ËØ¥ÔºåÂè™Ë¶ÅÊï¥‰∏™ÁΩëÁªú‰∏≠Â≠òÂú®Â§ßÂ§öÊï∞ËäÇÁÇπÊ≠£Â∏∏ËøêË°åÔºåÈÇ£‰πàetcdÂ∞±ÊòØÂèØÁî®ÁöÑÔºåÂπ∂‰∏îËÉΩÂ§ü‰øùËØÅÊï∞ÊçÆÊ≠£Á°Æ„ÄÇÂΩìÁΩëÁªúÊÅ¢Â§ç‰πãÂêé‰πüËÉΩÂ∞ÜÊï∞ÊçÆË∞ÉÊï¥Âà∞ÊúÄÊñ∞ÁöÑÁä∂ÊÄÅ„ÄÇraftÂº∫Â§ßÁöÑÂú∞ÊñπÂú®‰∫éÂÆÉËÉΩËá™Âä®ÁöÑËøõË°åÁä∂ÊÄÅÁöÑÂèòÂåñÔºåËá™Âä®ËøõË°åÈÄâ‰∏æÔºåÂπ∂‰∏îÈÄâ‰∏æÈÅµÂæ™‰∏ÄÂÆöÁöÑÁ≠ñÁï•ÔºåËøõËÄå‰øùËØÅÊï¥‰∏™ÁΩëÁªúÁöÑÊ≠£Â∏∏ËøêËΩ¨„ÄÇÂêåÊó∂‰øùËØÅÊï∞ÊçÆÁöÑ‰∏ÄËá¥ÊÄß„ÄÇ‰∫ÜËß£etcdÁöÑËøô‰∏™ÂéüÁêÜÊúâÂä©‰∫éÊàë‰ª¨ÂêéÁª≠ÁöÑ‰ΩøÁî®‰ª•ÂèäÊ∫êÁ†ÅÁöÑÈòÖËØª„ÄÇ]]></content>
      <categories>
        <category>etcd</category>
      </categories>
      <tags>
        <tag>etcd</tag>
        <tag>raft</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊµÖÂÖ•Ê∑±Âá∫ETCD‰πã„ÄêÁÆÄ‰ªã‰∏éÂëΩ‰ª§Ë°å‰ΩøÁî®„Äë]]></title>
    <url>%2F2019%2F06%2F10%2Fgolang%2Fopen-source-component%2Fetcd-brief%2F</url>
    <content type="text"><![CDATA[‰Ω†Áü•ÈÅìetcdÂêóÔºüÈöèÁùÄk8sÁöÑ‰ΩøÁî®ÂπøÊ≥õ‰πãÂêéÔºåetcdË¢´ÈùûÂ∏∏Â§öÁöÑ‰∫∫ÊâÄÁü•ÈÅìÔºåÂêåÊó∂ÂèàÂõ†‰∏∫ÂÆÉÂèØÈù†ÁöÑÂàÜÂ∏ÉÂºèÁâπÊÄßË¢´ÂæàÂ§ö‰∫∫ÂñúÊ¨¢„ÄÇÊâÄ‰ª•ÔºåÊàëÂáÜÂ§áÊúâÂá†ÁØáÂçöÊñáÊù•ËÆ∞ÂΩï‰∏Ä‰∏ãÔºå‰ªéÂü∫Êú¨‰ΩøÁî®Âà∞Á∫ø‰∏äÈÉ®ÁΩ≤ÂÜçÂà∞ÂéüÁêÜÂàÜÊûêÔºåÂÅö‰∏Ä‰∏™Á≥ªÂàó„ÄÇÈÇ£‰πàÔºå‰ªäÂ§©ÂÖàÊù•ËØ¥ËØ¥ÂÆÉÁöÑÁÆÄ‰ªã‰∏éÂëΩ‰ª§Ë°åÁöÑ‰ΩøÁî®„ÄÇ ÁÆÄ‰ªãETCDÊòØ‰ªÄ‰πàÊàë‰∏™‰∫∫ÊÄªÁªì‰∏∫‰∏ãÈù¢Áî®Âá†‰∏™Ë¶ÅÁÇπÔºö È´òÂèØÁî®K-VÂ≠òÂÇ®ÔºåÂ∞±Á±ª‰ºº‰∫éredis‰∏ÄÊ†∑ÁöÑÈîÆÂÄºÂØπÂ≠òÂÇ®„ÄÇ ÂÖÅËÆ∏Â∫îÁî®ÂÆûÊó∂ÁõëÂê¨Â≠òÂÇ®‰∏≠ÁöÑK-VÂèòÂåñ„ÄÇ ËÉΩÂ§üÂÆπÂøçÂçïÁÇπÊïÖÈöúÔºåËÉΩÂ§üÂ∫îÂØπÁΩëÁªúÂàÜÂå∫„ÄÇ etcdÂà©Áî®raftÂú®ÈõÜÁæ§‰∏≠ÂêåÊ≠•K-V‰ø°ÊÅØÔºåraftÊòØÂº∫‰∏ÄËá¥ÁöÑÈõÜÁæ§Êó•ÂøóÂêåÊ≠•ÁÆóÊ≥ï„ÄÇ ÊÄªÁªìÔºöetcdÊòØ‰∏Ä‰∏™ÂàÜÂ∏ÉÂºèÈ´òÂèØÁî®k-vÂ≠òÂÇ®ÔºåÈÄöËøáÂ§çÂà∂ËææÂà∞ÊØè‰∏™ËäÇÁÇπÂ≠òÂÇ®ÁöÑ‰ø°ÊÅØ‰∏ÄËá¥Ôºå‰ªéËÄå‰øùËØÅÈ´òÂèØÁî®„ÄÇ Êï∞ÊçÆÂ§çÂà∂ËøôÈáåÁÆÄÂçïËØ¥‰∏Ä‰∏ãÂ§çÂà∂ÁöÑÂÖ∑‰ΩìÊµÅÁ®ãÔºö Ôºàclient‰∏∫Êàë‰ª¨ÁöÑÂÆ¢Êà∑Á´ØÔºåÁî®Êù•ÂèëÂá∫Â≠òÂÇ®ËØ∑Ê±ÇÔºåleaderÂíåfollowerÈÉΩÊòØetcdÁöÑËäÇÁÇπÔºâÂ∞±Â¶ÇÂõæ‰∏äÊâÄÁúãÂà∞ÁöÑÔºåÊàëÂè´ÂÆÉ‰∏§ÊÆµÂºèÊèê‰∫§Ôºö ÂÆ¢Êà∑Á´ØËØ∑Ê±ÇleaderÂèëÈÄÅÂ≠òÂÇ®ÁöÑÊï∞ÊçÆÔºåÁÑ∂ÂêéleaderËäÇÁÇπË¶ÅÂ∞Ü‰ø°ÊÅØÈÄöËøáÊó•ÂøóÂ§çÂà∂ÁªôÂ§ßÂ§öÊï∞ÁöÑfollowerËäÇÁÇπÔºåÂ¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåÂè™ÈúÄË¶ÅÂ§çÂà∂Áªô‰∏§‰∏™ÔºàÂä†‰∏äÂÆÉËá™Â∑±ÊòØ‰∏â‰∏™ÔºâÈÇ£‰πàÂ∞±ÊòØÂ§ßÂ§öÊï∞ËäÇÁÇπ„ÄÇ leaderÂΩìÂ§çÂà∂ÂÆåÊàê‰πãÂêéÊâç‰ºöÊú¨Âú∞Êèê‰∫§ÔºåÁÑ∂ÂêéËøîÂõûÁªôÂÆ¢Êà∑Á´ØÊàêÂäüÔºåÔºàÂ¶ÇÊûúÊ≤°ÊúâÊàñËÄÖ‰∏çËÉΩÂ§çÂà∂ÁªôÂ§ßÂ§öÊï∞ËäÇÁÇπÔºåÈÇ£‰πàÂàôÂ≠òÂÇ®Â§±Ë¥•ÔºâÊ≠§Êó∂ÂÜçÂêåÊó∂ÂÖ∂‰ªñfollowerÂéª‰ªñ‰ª¨Ëá™Â∑±Êú¨Âú∞Êèê‰∫§„ÄÇÊòØ‰∏çÊòØÊúâ‰∏ÄÁßçÂàÜÂ∏ÉÂºè‰∫ãÂä°ÁöÑÊÑüËßâÔºüÂàÜÂ∏ÉÂºèÁöÑËß£ÂÜ≥ÈÄöÂ∏∏ÈÉΩÊòØËøôÁßçÊÑüËßâ„ÄÇ Êàë‰ª¨‰πüÂèØ‰ª•ÁúãÂà∞ÔºåetcdÈÄöËøáÂÖàÂ∞ÜÊï∞ÊçÆÂ≠òÊîæÂú®Â§ßÂ§öÊï∞ËäÇÁÇπ‰∏äÈù¢‰ªéËÄå‰øùËØÅÊï∞ÊçÆ‰∏ç‰ºöÂá∫ÈîôÂπ∂‰∏îÊïàÁéáËæÉÈ´òÔºåÊúÄÁªàÊâÄÊúâËäÇÁÇπÊï∞ÊçÆËøòÊòØ‰ºöÂêåÊ≠•‰∏ÄËá¥ÁöÑ„ÄÇ ÂÆòÊñπÁªôÂá∫ÂÜôÂÖ•ÁöÑÊÄßËÉΩÔºö1000/s PS:ËøôÈáåÂõ†‰∏∫ÊòØÁÆÄ‰ªãÔºåÊâÄ‰ª•Â∞±ÁÆÄÂçïÊèê‰∏Ä‰∏ãÔºåÊúâÂÖ≥Â¶Ç‰ΩïÈÄâ‰∏æÂá∫leaderËøòÊúâraftÂçèËÆÆÁöÑ‰∏Ä‰∫õÂÖ∑‰ΩìÁªÜËäÇÔºå‰ª•ÂèäÂΩìÂá∫Áé∞ÁΩëÁªúÂàÜÂå∫ÊàñËÄÖËäÇÁÇπÂºÇÂ∏∏ÈóÆÈ¢òÁöÑÊÅ¢Â§ç‰ºöÂú®‰πãÂêéÁöÑÂçöÂÆ¢‰∏≠ÁªôÂá∫„ÄÇ Â≠òÂÇ®ÁªìÊûÑÂ∫ïÂ±ÇÂ≠òÂÇ®keyÊòØÊúâÂ∫èÊéíÂàóÁöÑ‚Äòkey‚Äô -&gt; ‚Äòvalue‚Äô aaa/bbb -&gt; 111aaa/bbc -&gt; 3333bbb/aaa -&gt; 1321ccc -&gt; 24Â∞±ÊòØÊåâÁÖßkeyÁöÑÈ°∫Â∫è‰æùÊ¨°ÊéíÂàóÔºåÁõ∏ÂêåÂâçÁºÄÁöÑkey‰ºöË¢´ÊîæÂú®‰∏ÄËµ∑ÔºåËøôÊ†∑Âà∞Â≠òÂÇ®ÁªìÊûÑÔºåÂΩìÊü•ËØ¢Êó∂ÂèØ‰ª•ÈÄöËøákeyÁöÑÂâçÁºÄÂ∞Ü‰∏ÄÁ≥ªÂàóÁöÑvalueÈÉΩÂèñÂá∫Êù• watchÊú∫Âà∂ÂíåleaseÁßüÁ∫¶etcdÊúâ‰∏Ä‰∏™ÂæàÊ£íÁöÑÊú∫Âà∂Ë¶ÅÂçïÁã¨Êèê‰∏ÄÂè•ÔºåÂ∞±ÊòØwatchÔºåÂÆÉÂÖÅËÆ∏‰Ω†ÂéªÁõëÊéß‰∏Ä‰∏™keyÁöÑÂèòÂåñ„ÄÇÂΩì‰Ω†ÁõëÊéß‰∫Ü‰πãÂêéÔºåËøô‰∏™keyÁöÑÊ∑ªÂä†‰øÆÊîπÂà†Èô§ÈÉΩ‰ºöË¢´ÁõëÊéßÂà∞„ÄÇleaseÁßüÁ∫¶ÔºåËøô‰∏™Êú∫Âà∂Âíåredis‰∏≠ÁöÑkeyËøáÊúüÊú∫Âà∂‰∏ÄÊ†∑ÔºåÂèØ‰ª•Áî≥ËØ∑‰∏Ä‰∏™ÁßüÁ∫¶ÔºåËøô‰∏™ÁßüÁ∫¶Êúâ‰∏Ä‰∏™Êó∂Èó¥ÈôêÂà∂ÔºåÊØîÂ¶Ç60ÁßíÔºå‰Ω†ÂèØ‰ª•Â∞ÜËøô‰∏™ÁßüÁ∫¶ËÆæÁΩÆÂà∞‰∏Ä‰∏™key‰∏äÔºåÈÇ£‰πàËøô‰∏™keyËøá60ÁßíÂ∞±‰ºöË¢´Ëá™Âä®Âà†Èô§„ÄÇÂΩìÁÑ∂‰πüÂèØ‰ª•ËøõË°åÁª≠Áßü„ÄÇ ÂÖ∑‰Ωì‰ΩøÁî®ÊÉÖÂÜµÔºåÂèØ‰ª•‰ªéÂêéÈù¢ÁöÑÂëΩ‰ª§Ë°åÊìç‰Ωú‰∏≠ÁúãÂà∞„ÄÇ ËøòÊúâ‰∏Ä‰∫õÂ∞èÁÇπ etcd‰ΩøÁî®grpcÔºåÊâÄ‰ª•ÁΩëÁªúÊÄßËÉΩ‰ºöÈ´ò ÈÉ®ÁΩ≤ËäÇÁÇπÊï∞ÈáèË¶ÅÊ±ÇÊòØ2N+1‰∏™ ÈÄâ‰∏æleaderÈúÄË¶ÅÂçäÊï∞‰ª•‰∏äÁöÑËäÇÁÇπÂèÇ‰∏é etcdÊòØÊîØÊåÅ‰∫ãÂä°Êìç‰ΩúÁöÑÔºåÂèØ‰ª•ifÁ¨¨‰∏ÄÊ¨°aÊèê‰∫§Ê≠£Â∏∏ÔºåthenÊèê‰∫§bÔºåelse‰∏çÊèê‰∫§b Êú¨Âú∞ÂçïËäÇÁÇπÈÉ®ÁΩ≤Êàë‰ª¨‰∏ÄÂºÄÂßãÂ≠¶‰π†ÂíåÊµãËØïÁöÑÊó∂ÂÄôÂè™ÈúÄË¶ÅÂú®Êú¨Âú∞ÈÉ®ÁΩ≤‰∏Ä‰∏™ÂçïËäÇÁÇπÂ∞±ÂèØ‰ª•‰∫ÜÔºåÂçïËäÇÁÇπÁöÑÈÉ®ÁΩ≤ÊØîËæÉÊñπ‰æøËøôËæπÁÆÄÂçïËØ¥Êòé‰∏Ä‰∏ã„ÄÇÈ¶ñÂÖà‰∏ãËΩΩÂØπÂ∫îÁöÑÁâàÊú¨Ôºöhttps://github.com/etcd-io/etcd/releasesÊàëËøôËæπ‰ΩøÁî®ÁöÑmacÂØπÂ∫îÁöÑdarwin-amd64ÁöÑÁâàÊú¨ÔºåÂÖ∂‰ªñÁâàÊú¨Â∫îËØ•Á±ª‰ºº„ÄÇ‰∏ãËΩΩËß£Âéã‰πãÂêéÊúâ‰∏§‰∏™Êñá‰ª∂ÊØîËæÉÈáçË¶ÅÔºö etcd Ëøô‰∏™ÊòØËäÇÁÇπ etcdctl Ëøô‰∏™ÊòØÂÆ¢Êà∑Á´ØËøõÂÖ•ÊâÄÂú®ÁõÆÂΩï‰ΩøÁî®ÂëΩ‰ª§ËøõË°åÂêØÂä®Âíå‰ΩøÁî® ‰ΩøÁî®ËäÇÁÇπÂëΩ‰ª§1‚ûú ./etcd ‰ΩøÁî®ÂÆ¢Êà∑Á´ØÂëΩ‰ª§1234567‚ûú ./etcdctlNAME: etcdctl - A simple command line client for etcd.WARNING: Environment variable ETCDCTL_API is not set; defaults to etcdctl v2. Set environment variable ETCDCTL_API=3 to use v3 API or ETCDCTL_API=2 to use v2 API. ‰πãÂêé‰ºöÂá∫Áé∞‰∏äËø∞Á±ª‰ººË≠¶ÂëäÔºåÂëäËØâ‰Ω†ÔºåÈªòËÆ§‰ΩøÁî®ÁöÑÊòØv2ÁâàÊú¨ÁöÑAPIÔºå‰Ω†ÈúÄË¶ÅËÆæÁΩÆÁéØÂ¢ÉÂèòÈáèETCDCTL_API=3Â∞±ËÉΩ‰ΩøÁî®v3ÁâàÊú¨ÁöÑAPI‰∫ÜÔºåËøôÈáåÊàë‰ª¨‰ΩøÁî®ÂëΩ‰ª§export ETCDCTL_API=3 ÊàñËÄÖ‰Ω†ÂèØ‰ª•ÊâãÂä®‰øÆÊîπÁéØÂ¢ÉÂèòÈáèÊ∑ªÂä†export ETCDCTL_API=3Â∞±ÂèØ‰ª•‰∫ÜÔºåÂΩì‰∏çÂá∫Áé∞Ë≠¶ÂëäÁöÑÊó∂ÂÄôËØÅÊòéÁéØÂ¢ÉÂèòÈáèËÆæÁΩÆÊ≠£Á°Æ„ÄÇ ÁÆÄÂçïÂëΩ‰ª§Ë°åÊìç‰Ωú‰∏ãÈù¢‰ªãÁªçÂá†‰∏™ÊúÄÂü∫Êú¨ÁöÑetcdÁöÑÊìç‰ΩúÔºåÂÖ∂ÂÆûÈùûÂ∏∏ÁÆÄÂçï„ÄÇ‰∏ªË¶Å‰∏éredis‰∏çÂêåÁöÑÊòØÊã•ÊúâÁã¨ÁâπÁöÑwatchÊú∫Âà∂ÔºåËøô‰∏™Êú∫Âà∂ÈùûÂ∏∏Ê£í„ÄÇ put1234‚ûú ./etcdctl put /aaa/a 1OK‚ûú ./etcdctl put /aaa/b 2OK get12345678‚ûú ./etcdctl get /aaa/a/aaa/a1‚ûú ./etcdctl get --prefix /aaa/aaa/a1/aaa/b2 ‚ÄìprefixÊÑèÊÄùÊòØÂèñÂá∫ÊâÄÊúâÂâçÁºÄ‰∏∫/aaaÁöÑkey watchÊñ∞ÂºÄ‰∏Ä‰∏™Á™óÂè£‰ΩøÁî®ÂëΩ‰ª§watchËøõË°åÁõëÂê¨1‚ûú ./etcdctl watch /aaa/a ÁÑ∂ÂêéÂØπ/aaa/aËøô‰∏™keyÁöÑÊìç‰ΩúÂÖ®ÈÉ®ÈÉΩ‰ºöË¢´ÁõëÂê¨Âà∞1234‚ûú ./etcdctl put /aaa/a 123OK‚ûú ./etcdctl del /aaa/a1 123456‚ûú ./etcdctl watch /aaa/aPUT/aaa/a123DELETE/aaa/a leaseÂàõÂª∫‰∏Ä‰∏™60sÁöÑÁßüÁ∫¶12‚ûú ./etcdctl lease grant 60lease 694d6b2b7d7e6a0c granted with TTL(60s) 12‚ûú ./etcdctl put /aaa/a 123 --lease=694d6b2b7d7e6a0cOK putÁöÑÊó∂ÂÄô‰ΩøÁî®ÁßüÁ∫¶Ê≥®ÊÑèÔºåËøôÈáåÈúÄË¶ÅËæìÂÖ•‰∏äÈù¢ÁßüÁ∫¶ÁöÑ16ËøõÂà∂Ê†áËØÜÁ¨¶ÁÑ∂ÂêéÁõëÂê¨ÁöÑÂú∞Êñπ‰ºöÂèëÁé∞Ôºå60ÁßíÂêéÔºå/aaa/aËøô‰∏™keyË¢´Ëá™Âä®Âà†Èô§‰∫Ü ÂΩìÁÑ∂‰Ω†ÂèØ‰ª•‰ΩøÁî®keep-aliveËøõË°åÁª≠ÁßüÔºåÂ¶ÇÔºö1‚ûú ./etcdctl lease keep-alive 694d6b2ac4a35625 ÊÄªÁªì‰ª•‰∏äÁÆÄÂçïËØ¥Êòé‰∫ÜetcdÁöÑ‰∏Ä‰∫õÂü∫Êú¨‰ø°ÊÅØÔºåÂçïËäÇÁÇπÈÉ®ÁΩ≤Ôºå‰ª•Âèä‰∏Ä‰∫õÂü∫Êú¨Áî®Ê≥ïÔºå‰ªé‰∏äËø∞‰ø°ÊÅØÊàë‰ª¨ÊÄªÁªìÂèØÁü•Ôºö etcdÊòØÂàÜÂ∏ÉÂºèÁöÑÔºåËÉΩ‰øùËØÅÂú®ÂçïÁÇπÊïÖÈöú‰∏ã‰πüËÉΩÊ≠£Â∏∏‰ΩøÁî® ÂàÜÂ∏ÉÂºè‰πü‰ºöÂØºËá¥ÈóÆÈ¢òÔºåetcdÂÜôÂÖ•ÊÄßËÉΩÁõ∏ËæÉredisËÇØÂÆöÊúâÊâÄ‰∏çÂèä etcdÁã¨ÁâπÁöÑwatchÊú∫Âà∂ÂèØ‰ª•Áî®‰∫éÂæàÂ§öÂú∫ÊôØÔºåÂ¶ÇÈÖçÁΩÆÊõ¥Êñ∞ÂàÜÂèëÁ≠â ÈÇ£ËøôÈáåÂ∞±ËØ¥Ëøô‰πàÂ§öÔºåÁúãÂÆå‰Ω†Â∞±Â∫îËØ•Â§ßËá¥Áü•ÈÅìetcdÊòØ‰∏™Âï•Áé©ÊÑè‰∫ÜÔºå‰ªéÁé∞Âú®ÁúãÊù•‰Ω†ÂèØËÉΩËøòÊ≤°ÊúâÊÑüËßâÂÆÉÊúâ‰ªÄ‰πàÂéâÂÆ≥ÁöÑÂú∞ÊñπÔºåÂêéÈù¢Êàë‰ª¨ÁªìÂêàÂÆûÈôÖÁöÑÂú∫ÊôØ‰ΩøÁî®Â∞±ËÉΩÊõ¥Âä†ÊòéÁôΩ‰∫Ü„ÄÇ]]></content>
      <categories>
        <category>etcd</category>
      </categories>
      <tags>
        <tag>etcd</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[GolangÊåáÈíà‰∏éunsafe]]></title>
    <url>%2F2019%2F06%2F06%2Fgolang%2Fsource-code%2Fpoint-unsafe%2F</url>
    <content type="text"><![CDATA[Êàë‰ª¨Áü•ÈÅìÂú®golang‰∏≠ÊòØÂ≠òÂú®ÊåáÈíàËøô‰∏™Ê¶ÇÂøµÁöÑ„ÄÇÂØπ‰∫éÊåáÈíàÂæàÂ§ö‰∫∫ÊúâÁÇπÂøåÊÉÆÔºàÂèØËÉΩÊòØÂõ†‰∏∫‰πãÂâçÂ≠¶‰π†ËøáCËØ≠Ë®ÄÔºâÔºåÂõ†‰∏∫ÂÆÉ‰ºöÂØºËá¥ÂæàÂ§öÂºÇÂ∏∏ÁöÑÈóÆÈ¢ò„ÄÇ‰ΩÜÊòØÂæàÂ§ö‰∫∫Â≠¶‰π†‰πãÂêéÂèëÁé∞Ôºågolang‰∏≠ÁöÑÊåáÈíàÂæàÁÆÄÂçïÔºåÊ≤°ÊúâCÈÇ£‰πàÂ§çÊùÇ„ÄÇÊâÄ‰ª•‰ªäÂ§©Â∞±ËØ¶ÁªÜÊù•ËØ¥ËØ¥ÊåáÈíà„ÄÇ ÊåáÈíàÁöÑ‰ΩøÁî®123a := 1p := &amp;afmt.Println(p) ËæìÂá∫Ôºö0xc42001c070 ÂèØ‰ª•ÁúãÂà∞pÂ∞±ÊòØ‰∏Ä‰∏™ÊåáÈíàÔºå‰πüÂèØ‰ª•ËØ¥ÊòØaÁöÑÂú∞ÂùÄ„ÄÇ 1234a := 1var p *intp = &amp;afmt.Println(p) ÊàñËÄÖ‰πüÂèØ‰ª•ÂÜôÊàêËøôÊ†∑ÔºåÂõ†‰∏∫ÊàëÁü•ÈÅìÔºåÂú®ÂæàÂ§ö‰∫∫ÁúãÊù•ÔºåÁúãÂà∞*Âè∑ÊâçÊòØÊåáÈíàÔºàÊâãÂä®ÊªëÁ®ΩÔºâ 123a := 1p := &amp;afmt.Println(*p) ËæìÂá∫Ôºö1 ÁÑ∂Âêé‰ΩøÁî®Â∞±Áõ¥Êé•ÈÄöËøá*Âè∑Â∞±ËÉΩÂéªÂà∞ÂØπÂ∫îÁöÑÂÄº‰∫ÜÔºåÂ∞±Ëøô‰πàÁÆÄÂçï ÊåáÈíàÁöÑÈôêÂà∂Golang‰∏≠ÊåáÈíà‰πãÊâÄ‰ª•ÁúãËµ∑Êù•ÂæàÁÆÄÂçïÔºåÊòØÂõ†‰∏∫ÊåáÈíàÁöÑÂäüËÉΩ‰∏çÂ§ö„ÄÇÊàë‰ª¨ËÉΩÁúãÂà∞ÁöÑÂäüËÉΩÂ∞±ÊòØÊåáÈíàÁöÑÊåáÂêë‰∏Ä‰∏™Âú∞ÂùÄËÄåÂ∑≤ÔºåÁÑ∂ÂêéÂØπ‰∫éËøô‰∏™Âú∞ÂùÄ‰πüÂè™ËÉΩËøõË°å‰º†ÈÄíÔºåÊàñËÄÖÈÄöËøáËøô‰∏™ÁöÑÂú∞ÂùÄÂéªËÆøÈóÆÂÄº„ÄÇ ‰∏çËÉΩÂÉèCËØ≠Ë®Ä‰∏≠‰∏ÄÊ†∑p++ÔºåËøôÊ†∑ÁßªÂä®Êìç‰ΩúÊåáÈíàÔºåÂõ†‰∏∫ÂÖ∂ÂÆûËøôÊ†∑Êìç‰ΩúÁ°ÆÂÆû‰∏çÂÆâÂÖ®ÔºåÂæàÂÆπÊòìËÆøÈóÆÂà∞Â•áÊÄ™ÁöÑÂå∫Âüü„ÄÇ ‰∏çÂêåÁ±ªÂûãÁöÑÊåáÈíà‰∏çËÉΩÁõ∏‰∫íËµãÂÄº„ÄÅËΩ¨Êç¢„ÄÅÊØîËæÉ„ÄÇ‰ºöÂá∫Áé∞cannot use &amp;a (type int) as type float32 in assignmentÁ±ª‰ººËøôÊ†∑ÁöÑÈîôËØØ Â¶ÇÊûúÂè™ÊòØÂçïÁ∫ØËØ¥go‰∏≠ÊåáÈíàÁöÑÂäüËÉΩÔºå‰∏äÈù¢Â∞±Â∑≤ÁªèËØ¥ÂÆå‰∫ÜÔºåÊ≤°ÂøÖË¶ÅÂÜôÂçöÂÆ¢Ôºå‰ΩÜÊòØÂÖ∂ÂÆûgo‰∏≠ËøòÊúâ‰∏Ä‰∏™ÂåÖÂè´unsafeÔºåÊúâ‰∫ÜÂÆÉÔºåÊåáÈíàÂ∞±ÂèØ‰ª•ÂÉèC‰∏ÄÊ†∑ÊÉ≥Âπ≤ÂòõÂπ≤Âòõ‰∫Ü„ÄÇ unsafe‰∏â‰∏™Á±ªÂûãÂÖ∂ÂÆûÊåáÈíàÊúâ‰∏âÁßçÔºö‰∏ÄÁßçÊòØÊàë‰ª¨Â∏∏ËßÅÁöÑ*ÔºåÁî®*ÂéªË°®Á§∫ÁöÑÊåáÈíàÔºõ‰∏ÄÁßçÊòØunsafe.PointerÔºåPointerÊòØunsafeÂåÖ‰∏ãÁöÑ‰∏Ä‰∏™Á±ªÂûãÔºõÊúÄÂêé‰∏ÄÁßçÊòØuintptrÔºåuintptrÂ∞±ÂéâÂÆ≥‰∫ÜÔºåËøôÁé©ÊÑèÊòØÂèØ‰ª•ËøõË°åËøêÁÆóÁöÑ‰πüÂ∞±ÊòØÂèØ‰ª•++‚ÄìÔºõ ‰ªñ‰ª¨‰πãÈó¥ÊúâËøôÊ†∑ÁöÑËΩ¨Êç¢ÂÖ≥Á≥ªÔºö* &lt;=&gt; unsafe.Pointer &lt;=&gt; uintptr Êúâ‰∏ÄÁÇπË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåuintptr Âπ∂Ê≤°ÊúâÊåáÈíàÁöÑËØ≠‰πâÔºåÊÑèÊÄùÂ∞±ÊòØ uintptr ÊâÄÊåáÂêëÁöÑÂØπË±°‰ºöË¢´ gc Êó†ÊÉÖÂú∞ÂõûÊî∂„ÄÇËÄå unsafe.Pointer ÊúâÊåáÈíàËØ≠‰πâÔºåÂèØ‰ª•‰øùÊä§ÂÆÉÊâÄÊåáÂêëÁöÑÂØπË±°Âú®‚ÄúÊúâÁî®‚ÄùÁöÑÊó∂ÂÄô‰∏ç‰ºöË¢´ÂûÉÂúæÂõûÊî∂„ÄÇ ‰ªéËøôÊ†∑ÁöÑÂÖ≥Á≥ª‰Ω†Â§ßÊ¶ÇÂ∞±ÂèØ‰ª•ÁåúÂà∞ÔºåÊàë‰ª¨‰ΩøÁî®ÁöÑÊåáÈíà*pËΩ¨Êç¢ÊàêPointerÁÑ∂ÂêéËΩ¨Êç¢uintptrËøõË°åËøêÁÆó‰πãÂêéÂÜçÂéüË∑ØËøîÂõûÔºåÁêÜËÆ∫‰∏äÂ∞±ËÉΩÁ≠âÂêå‰∫éËøõË°å‰∫ÜÊåáÈíàÁöÑËøêÁÆó„ÄÇÊàë‰ª¨‰∏ãÈù¢Â∞±Êù•ÂÆûË∑µ‰∏Ä‰∏ã„ÄÇ unsafeÊìç‰Ωúslice12345678910111213func main() &#123; s := make([]int, 10) s[1] = 2 p := &amp;s[0] fmt.Println(*p) up := uintptr(unsafe.Pointer(p)) up += unsafe.Sizeof(int(0)) // ËøôÈáåÂèØ‰∏çÊòØup++Âì¶ p2 := (*int)(unsafe.Pointer(up)) fmt.Println(*p2)&#125; ËæìÂá∫Ôºö02 ‰ªé‰ª£Á†Å‰∏≠Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ÔºåÊàë‰ª¨È¶ñÂÖàÂ∞ÜÊåáÈíàÊåáÂêëÂàáÁâáÁöÑÁ¨¨‰∏Ä‰∏™‰ΩçÁΩÆÔºåÁÑ∂ÂêéÈÄöËøáËΩ¨Êç¢ÂæóÂà∞uintptrÔºåÊìç‰Ωúuintptr + ‰∏ä8‰ΩçÔºàÊ≥®ÊÑèËøôÈáå‰∏çËÉΩ++Âõ†‰∏∫Â≠òÊîæÁöÑÊòØintÔºå‰∏ã‰∏Ä‰∏™ÂÖÉÁ¥†‰ΩçÁΩÆÁõ∏Èöî‰∏æ‰æãint‰∏™Â≠óËäÇÔºâÔºåÊúÄÂêéËΩ¨Êç¢ÂõûÊù•ÂæóÂà∞ÊåáÈíàÔºåÂèñÂÄºÔºåÂ∞±ËÉΩÂèñÂà∞ÂàáÁâáÁöÑÁ¨¨‰∫å‰∏™‰ΩçÁΩÆ‰∫Ü„ÄÇ unsafeÊìç‰ΩústructÂΩìÁÑ∂Êúâ‰∫∫ËÇØÂÆöË¶ÅËØ¥‰∫ÜÔºå‰∏äÈù¢ÈÇ£‰∏™‰∏ÄÈ°øÊìç‰ΩúÁåõÂ¶ÇËôéÔºå‰∏çÂ∞±ÊòØËÆøÈóÆ‰∏ã‰∏Ä‰∏™‰ΩçÁΩÆÂòõÔºåÊàëÁõ¥Êé•ËÆøÈóÆÂ∞±Ë°å‰∫Ü„ÄÇÈÇ£‰∏ãÈù¢Â∞±ÊòØÂéâÂÆ≥ÁöÑÊù•‰∫ÜÔºåÊàë‰ª¨Áü•ÈÅìÂ¶ÇÊûú‰∏Ä‰∏™ÁªìÊûÑ‰ΩìÈáåÈù¢ÂÆö‰πâÁöÑÂ±ûÊÄßÊòØÁßÅÊúâÁöÑÔºåÈÇ£‰πàËøô‰∏™Â±ûÊÄßÊòØ‰∏çËÉΩË¢´Â§ñÁïåËÆøÈóÆÂà∞ÁöÑ„ÄÇÊàë‰ª¨Êù•ÁúãÁúã‰∏ãÈù¢Ëøô‰∏™Êìç‰ΩúÔºö 123456package basictype User struct &#123; age int name string&#125; 12345678910111213141516package mainfunc main() &#123; user := &amp;basic.User&#123;&#125; fmt.Println(user) s := (*int)(unsafe.Pointer(user)) *s = 10 up := uintptr(unsafe.Pointer(user)) + unsafe.Sizeof(int(0)) namep := (*string)(unsafe.Pointer(up)) *namep = "xxx" fmt.Println(user)&#125; UserÊòØÂè¶Â§ñ‰∏Ä‰∏™basicÂåÖ‰∏≠ÁöÑÁªìÊûÑ‰ΩìÔºåÂÖ∂‰∏≠ÁöÑageÊòØÂ∞èÂÜôÂºÄÂ§¥ÁöÑÔºåÁêÜËÆ∫‰∏äÊù•ËØ¥ÔºåÊàë‰ª¨Âú®Â§ñÈÉ®Ê≤°ÊúâÂäûÊ≥ï‰øÆÊîπageÁöÑÂÄºÔºå‰ΩÜÊòØÁªèËøá‰∏äÈù¢ËøôÊ≥¢Êìç‰Ωú‰πãÂêéÔºåËæìÂá∫‰ø°ÊÅØÊòØÔºö&amp;{0 }&amp;{10 xxx}‰πüÂ∞±ÊòØËØ¥ÊàêÂäüÊìç‰ΩúÂà∞‰∫ÜÁªìÊûÑ‰ΩìÁöÑÁßÅÊúâÂ±ûÊÄß„ÄÇ È°∫‰æøÊèê‰∏ÄÂè•ÔºöÂàõÂª∫ÁªìÊûÑ‰Ωì‰ºöË¢´ÂàÜÈÖç‰∏ÄÂùóËøûÁª≠ÁöÑÂÜÖÂ≠òÔºåÁªìÊûÑ‰ΩìÁöÑÂú∞ÂùÄ‰πü‰ª£Ë°®‰∫ÜÁ¨¨‰∏Ä‰∏™ÊàêÂëòÁöÑÂú∞ÂùÄ„ÄÇ ‰∏ãÈù¢Êàë‰ª¨Êù•È™åËØÅ‰∏Ä‰∏ã‰Ω†ÊòØÂê¶Â∑≤ÁªèÂ≠¶‰ºö‰∫ÜunsafeÁöÑÊìç‰ΩúÔºåÂ∞ùËØï‰∏çÁúã‰∏Ä‰∏™Â∞èÁªìÔºåËá™Â∑±Â∞ùËØï‰∏Ä‰∏ãÔºöÂ¶Ç‰ΩïÂÆåÊàêÂ≠óÁ¨¶‰∏≤Âà∞[]byteÁöÑËΩ¨Êç¢ÔºåÂπ∂‰∏î‰∏çÂºÄËæüÊñ∞ÁöÑÁ©∫Èó¥Ôºü Â≠óÁ¨¶‰∏≤ÂíåbyteÊï∞ÁªÑËΩ¨Êç¢inplaceÊàë‰ª¨Áü•ÈÅìÂ¶ÇÊûúÂ∞ÜÂ≠óÁ¨¶‰∏≤ËΩ¨Êç¢Êàê[]byteÈùûÂ∏∏Êñπ‰æø12s := "123"a := []byte(s) ‰ΩÜÊòØËøôÊ†∑ÈúÄË¶ÅÂºÄËæüÈ¢ùÂ§ñÁöÑÁ©∫Èó¥ÔºåÈÇ£‰πàÂ¶Ç‰ΩïÂÆûÁé∞ÂéüÂú∞ÁöÑÔºå‰∏çÈúÄË¶ÅÊã∑Ë¥ùÊï∞ÊçÆÁöÑËΩ¨Êç¢Âë¢ÔºüÊàë‰ª¨ÊÉ≥‰∏Ä‰∏ãÔºåÂÖ∂ÂÆû‰ªéÂ∫ïÂ±ÇÁöÑÂ≠òÂÇ®ËßíÂ∫¶Êù•ËØ¥ÔºåstringÁöÑÂ≠òÂÇ®ËßÑÂàôÂíå[]byteÊòØ‰∏ÄÊ†∑ÁöÑÔºå‰πüÂ∞±ÊòØËØ¥ÔºåÂÖ∂ÂÆûÊåáÈíàÈÉΩÊòØ‰ªéÊüê‰∏™‰ΩçÁΩÆÂºÄÂßãÂà∞‰∏ÄÊÆµÁ©∫Èó¥Ôºå‰∏≠Èó¥‰∏ÄÊ†º‰∏ÄÊ†º„ÄÇÊâÄ‰ª•Âà©Áî®unsafeÂ∞±ÂèØ‰ª•ÂÅöÂà∞„ÄÇ 123456789101112func main() &#123; s := "123" a := []byte(s) print("s = " , &amp;s, "\n") print("a = " , &amp;a, "\n") a2 := (*[]byte)(unsafe.Pointer(&amp;s)) print("a2 = " , a2, "\n") fmt.Println(*a2)&#125; ËæìÂá∫ÁªìÊûúÔºös = 0xc420055f40a = 0xc420055f60a2 = 0xc420055f40[49 50 51] Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞sÂíåaÁöÑÂú∞ÂùÄÊòØ‰∏ç‰∏ÄÊ†∑ÁöÑÔºå‰ΩÜÊòØsÂíåa2ÁöÑÂú∞ÂùÄÊòØ‰∏ÄÊ†∑ÁöÑÔºåÂπ∂‰∏îa2Â∑≤ÁªèÊòØ‰∏Ä‰∏™[]byte‰∫Ü„ÄÇÂòøÂòøÂòø~‰Ω†‰ª•‰∏∫ËøôÊ†∑Â∞±ÁªìÊùü‰∫ÜÔºüÔºüÔºü Â≠òÂú®ÁöÑÈóÆÈ¢òÂÖ∂ÂÆûËøô‰∏™ËΩ¨Êç¢ÊòØÂ≠òÂú®ÈóÆÈ¢òÁöÑÔºåÈóÆÈ¢òÂ∞±Âú®Êñ∞ÁöÑ[]byteÁöÑCapÊ≤°ÊúâÊ≠£Á°ÆÁöÑÂàùÂßãÂåñ„ÄÇÊàë‰ª¨ÊâìÂç∞‰∏Ä‰∏ãcapÁúã‰∏Ä‰∏ãfmt.Println(‚Äúcap a =‚Äù, cap(a))fmt.Println(‚Äúcap a2 =‚Äù, cap(*a2))ÁªìÊûúÊòØÔºöcap a = 32cap a2 = 17418400Ëøô‰πàÂ§ßÁöÑÂÆπÈáèÊòØË¶Å‰∏äÂ§©Âë¢ÔºüÔºüÔºü ÈóÆÈ¢òÁöÑÂéüÂõ†Âú®src/reflect/value.go‰∏ãÁúã12345678910type StringHeader struct &#123; Data uintptr Len int&#125;type SliceHeader struct &#123; Data uintptr Len int Cap int&#125; ÁúãÂà∞ÂÖ∂ÂÆûstringÊ≤°ÊúâcapËÄå[]byteÊúâÔºåÊâÄ‰ª•ÂØºËá¥ÈóÆÈ¢òÂá∫Áé∞Ôºå‰πüÂÆπÊòìÁêÜËß£ÔºåstringÊòØÊ≤°ÊúâÂÆπÈáèÊâ©ÂÆπËøô‰∏™ËØ¥Ê≥ïÁöÑÔºåÊâÄ‰ª•Êñ∞ÁöÑ[]byteÊ≤°ÊúâËµãÂÄºcapÊâÄ‰ª•‰ΩøÁî®‰∫ÜÈªòËÆ§ÂÄº„ÄÇ ÈóÆÈ¢òËß£ÂÜ≥123456789stringHeader := (*reflect.StringHeader)(unsafe.Pointer(&amp;s))bh := reflect.SliceHeader&#123; Data: stringHeader.Data, Len: stringHeader.Len, Cap: stringHeader.Len,&#125;return *(*[]byte)(unsafe.Pointer(&amp;bh)) ÈÄöËøáÈáçÊñ∞ËÆæÁΩÆSliceHeaderÂ∞±ÂèØ‰ª•ÂÆåÊàê ÊÄªÁªì‰ª•‰∏äÂ∞±ÊòØÊâÄÊúâgolangÊåáÈíàÂíåunsafeÁöÑÁõ∏ÂÖ≥ÁªÜËäÇÂíå‰ΩøÁî®„ÄÇÈÇ£‰πàËÇØÂÆöÊúâ‰∫∫‰ºöÈóÆËøô‰∏™Êúâ‰ªÄ‰πàÁî®‰∫ÜÔºü 1„ÄÅÊ≤°Âï•‰∫ã‰Ω†Â∞±Âà´‰π±Áî®‰∫ÜÔºåÂà´‰∫∫ÈÉΩËØ¥unsafe‰∏çÂÆâÂÖ®‰∫Ü„ÄÇ 2„ÄÅÊ∫êÁ†Å‰∏≠ÂæàÂ§öÂ§ßÈáèÁöÑ‰ΩøÁî®‰∫ÜÊåáÈíàÁßªÂä®ÁöÑÊìç‰Ωú„ÄÇ Â¶Çmap‰∏≠ÈÄöËøákeyËé∑ÂèñvalueÁöÑÊó∂ÂÄôÔºö v := add(unsafe.Pointer(b), dataOffset+bucketCnt uintptr(t.keysize)+i uintptr(t.valuesize)) ÈÄöËøáÊ°∂ÁöÑÊåáÈíàÁöÑÂÅèÁßªÊãøÂà∞ÂÄºÔºåÂÖ∑‰ΩìÊàëÂ∞±‰∏çÂ§ö‰ªãÁªç‰∫Ü„ÄÇÊÄª‰πãÂØπ‰∫é‰Ω†ÁúãgolangÊ∫êÁ†ÅÁöÑÊó∂ÂÄô‰ºöÊúâÂæàÂ§ßÂ∏ÆÂä©ÁöÑ„ÄÇÂèØËÉΩÂøÖË¶ÅÁöÑÊó∂ÂÄô‰Ω†‰πüËÉΩÁî®Âà∞ÂÆÉÔºåËøòÊòØÈÇ£Âè•ËØùÔºåÈô§Èùû‰Ω†Áü•ÈÅìÂÆÉÂú®Âπ≤‰ªÄ‰πàÔºåÂê¶Âàô‰∏çË¶ÅÁî®„ÄÇ]]></content>
      <categories>
        <category>golangÊ∫êÁ†ÅËß£Êûê</category>
      </categories>
      <tags>
        <tag>unsafe</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Â§ßËØùÂõæËß£golang mapÊ∫êÁ†ÅËØ¶Ëß£]]></title>
    <url>%2F2019%2F06%2F03%2Fgolang%2Fsource-code%2Fgraphic-golang-map%2F</url>
    <content type="text"><![CDATA[ÁΩë‰∏äÂàÜÊûêgolang‰∏≠mapÁöÑÊ∫êÁ†ÅÁöÑÂçöÂÆ¢Â∑≤ÁªèÈùûÂ∏∏Â§ö‰∫ÜÔºåÈöè‰æø‰∏ÄÊêúÂ∞±ÊúâÔºåËÄå‰∏î‰πüÈùûÂ∏∏ËØ¶ÁªÜÔºåÊâÄ‰ª•Â¶ÇÊûúÊàëÂÜçÊù•ÂÜôÂ∞±ÊúâÁÇπÁîªËõáÊ∑ªË∂≥‰∫ÜÔºàËÄå‰∏îÊàë‰πüÂÜô‰∏çÂ•ΩÔºåÊâãÂä®ÊªëÁ®ΩÔºâ„ÄÇ‰ΩÜÊòØÊàëËøòÊòØË¶ÅÂÜôÔºåÁï•Áï•Áï•ÔºåËøôÁØáÂçöÂÆ¢ÁöÑÊÑè‰πâÂú®‰∫éËÉΩ‰ªéÂá†Âº†ÂõæÁâáÔºåÁÑ∂ÂêéÁî®ÊàëÊúÄÈÄö‰øóÁöÑÊñáÂ≠óÔºåËÆ©Ê≤°ÁúãËøáÊ∫êÁ†ÅÁöÑ‰∫∫ÊúÄÂø´Á®ãÂ∫¶‰∏ä‰∫ÜËß£golang‰∏≠mapÊòØÊÄé‰πàÊ†∑ÁöÑ„ÄÇ ÂΩìÁÑ∂ÔºåÂõ†‰∏∫ÁÆÄÂçïÔºåÊâÄ‰ª•‰∏çÂÆåÁæé„ÄÇÊúâÂæàÂ§öÂú∞ÊñπÁúÅÁï•‰∫ÜÁªÜËäÇÈóÆÈ¢òÔºåÂ¶ÇÊûú‰Ω†ËßâÂæóÊ≤°ÁúãÂ§üÔºåÊàñËÄÖÊú¨Êù•Â∞±ÊÉ≥‰∫ÜËß£ËØ¶ÁªÜÊÉÖÂÜµÁöÑËØùÂú®ÊñáÊú´ÁªôÂá∫‰∫Ü‰∏Ä‰∫õÈùûÂ∏∏‰∏çÈîôÁöÑÂçöÂÆ¢ÔºåÂΩìÁÑ∂ÊúâËÉΩÂäõËøòÊòØËá™Â∑±ÂéªÈòÖËØªÊ∫êÁ†ÅÊØîËæÉÈù†Ë∞±„ÄÇ ÈÇ£‰πà‰∏ãÈù¢ÊàëÂ∞Ü‰ªéËøôÂá†‰∏™ÊñπÈù¢Êù•ËØ¥ÊòéÔºå‰Ω†ÂÖàËÆ∞‰ΩèÊúâ‰∏ãÈù¢Âá†‰∏™ÊñπÂêëÔºåËøôÊ†∑ÂèØ‰ª•Êúâ‰∏Ä‰∏™Â§ßËá¥ÁöÑÊÄùË∑ØÔºö Âü∫Á°ÄÁªìÊûÑÔºögolang‰∏≠ÁöÑmapÊòØ‰ªÄ‰πàÊ†∑Â≠êÁöÑÔºåÊòØÁî±‰ªÄ‰πàÊï∞ÊçÆÁªìÊûÑÁªÑÊàêÁöÑÔºü ÂàùÂßãÂåñÔºöÂàùÂßãÂåñ‰πãÂêémapÊòØÊÄé‰πàÊ†∑ÁöÑÔºü getÔºöÂ¶Ç‰ΩïËé∑Âèñ‰∏Ä‰∏™ÂÖÉÁ¥†Ôºü putÔºöÂ¶Ç‰ΩïÂ≠òÊîæ‰∏Ä‰∏™ÂÖÉÁ¥†Ôºü Êâ©ÂÆπÔºöÂΩìÂ≠òÊîæÁ©∫Èó¥‰∏çÂ§üÁöÑÊó∂ÂÄôÊâ©ÂÆπÊòØÊÄé‰πàÊâ©ÁöÑÔºü Âü∫Á°ÄÁªìÊûÑÂõæËß£Ëøô‰∏™Â∞±ÊòØgolang‰∏≠mapÁöÑÁªìÊûÑÔºåÂÖ∂ÂÆûÁúüÁöÑ‰∏çÂ§çÊùÇÔºåÊàëÁúÅÁï•‰∫ÜÂÖ∂‰∏≠‰∏Ä‰∫õÂíåÁªìÊûÑÂÖ≥Á≥ª‰∏çÂ§ßÁöÑÂ≠óÊÆµÔºåÂ∞±Âè™Ââ©‰∏ãËøô‰∫õ‰∫Ü„ÄÇ Â§ßËØùÂ§ßËØùÊù•ÊèèËø∞‰∏Ä‰∫õË¶ÅÁÇπÔºö ÊúÄÂ§ñÈù¢ÊòØhmapÁªìÊûÑ‰ΩìÔºåÁî®bucketsÂ≠òÊîæ‰∏Ä‰∫õÂêçÂ≠óÂè´bmapÁöÑÊ°∂ÔºàÊï∞Èáè‰∏çÂÆöÔºåÊòØ2ÁöÑÊåáÊï∞ÂÄçÔºâ bmapÊòØ‰∏ÄÁßçÊúâ8‰∏™Ê†ºÂ≠êÁöÑÊ°∂Ôºà‰∏ÄÂÆöÂè™Êúâ8‰∏™Ê†ºÂ≠êÔºâÔºåÊØè‰∏™Ê†ºÂ≠êÂ≠òÊîæ‰∏ÄÂØπkey-value bmapÊúâ‰∏Ä‰∏™overflowÔºåÁî®‰∫éËøûÊé•‰∏ã‰∏Ä‰∏™bmapÔºàÊ∫¢Âá∫Ê°∂Ôºâ hmapËøòÊúâoldbucketsÔºåÁî®‰∫éÂ≠òÊîæËÄÅÊï∞ÊçÆÔºàÁî®‰∫éÊâ©ÂÆπÊó∂Ôºâ mapextraÁî®‰∫éÂ≠òÊîæÈùûÊåáÈíàÊï∞ÊçÆÔºàÁî®‰∫é‰ºòÂåñÂ≠òÂÇ®ÂíåËÆøÈóÆÔºâÔºåÂÜÖÈÉ®ÁöÑoverflowÂíåoldoverflowÂÆûÈôÖËøòÊòØbmapÁöÑÊï∞ÁªÑ„ÄÇ ËøôÂ∞±ÊòØmapÁöÑÁªìÊûÑÔºåÁÑ∂ÂêéÊàë‰ª¨Á®çÂæÆÂØπÊØîÊÄªÁªì‰∏Ä‰∏ã„ÄÇ Êàë‰ª¨Â∏∏ËßÅÁöÑmapÂ¶Çjava‰∏≠ÁöÑmapÊòØÁõ¥Êé•ÊãøÊï∞ÁªÑÔºåÊï∞ÁªÑ‰∏≠Áõ¥Êé•ÂØπÂ∫îÂá∫‰∫Ükey-valueÔºåËÄåÂú®golang‰∏≠ÔºåÂÅö‰∫ÜÂ§öÂä†‰∏≠Èó¥‰∏ÄÂ±ÇÔºåbucketsÔºõjava‰∏≠Â¶ÇÊûúkeyÁöÑÂìàÂ∏åÁõ∏Âêå‰ºöÈááÁî®ÈìæË°®ÁöÑÊñπÂºèËøûÊé•‰∏ãÂéªÔºåÂΩìËææÂà∞‰∏ÄÂÆöÁ®ãÂ∫¶‰ºöËΩ¨Êç¢Á∫¢ÈªëÊ†ëÔºågolang‰∏≠Áõ¥Êé•Á±ª‰ººÈìæË°®ËøûÊé•‰∏ãÂéªÔºåÂè™‰∏çËøáËøûÊé•‰∏ãÂéªÁöÑÊòØbuckets„ÄÇ Ê∫êÁ†Å‰∏ÄÁû• ‰∏ãÈù¢ÈôÑ‰∏äÊ∫êÁ†Å‰∏≠ÂÆÉ‰ª¨ÁöÑÊ†∑Â≠êÔºåÊñπ‰æø‰πãÂêé‰Ω†Ëá™Â∑±ÈòÖËØªÁöÑÊó∂ÂÄôÊúâ‰∏™Âç∞Ë±°ÔºàÊ≥®ÊÑèÊ∫êÁ†Å‰∏≠ÁöÑÊ†∑Â≠êÂíåÁºñËØë‰πãÂêéÊòØ‰∏çÂêåÁöÑÂìüÔºågolang‰ºöÊ†πÊçÆmapÂ≠òÊîæÁöÑÁ±ªÂûã‰∏çÂêåÊù•ÊêûÂÆöÂÆÉ‰ª¨ÂÆûÈôÖÁöÑÊ†∑Â≠êÔºâ ÈÇ£‰πàÁúãÂÆåÁªìÊûÑ‰Ω†ËÇØÂÆö‰ºöÊúâÁñëÈóÆÔºü‰∏∫‰ªÄ‰πàË¶ÅÂ§ö‰∏ÄÂ±Ç8‰∏™Ê†ºÂ≠êÁöÑbucketÂë¢ÔºüÊàë‰ª¨ÊÄé‰πàÁ°ÆÂÆöÊîæÂú®8‰∏™Ê†ºÂ≠êÂÖ∂‰∏≠ÁöÑÂì™‰∏™Âë¢ÔºüÂ∏¶ÁùÄÈóÆÈ¢òÂæÄ‰∏ãÁúã„ÄÇ ÂàùÂßãÂåñÊ∫êÁ†Å‰∏ÄÁû•ÂàùÂßãÂåñÂ∞±‰∏çÈúÄË¶ÅÂõæÂéªËØ¥Êòé‰∫ÜÔºåÂõ†‰∏∫ÂàùÂßãÂåñ‰πãÂêéÂ∞±ÊòØ‰∫ßÁîüÂü∫Á°ÄÁöÑ‰∏Ä‰∏™ÁªìÊûÑÔºåÊ†πÊçÆmap‰∏≠Â≠òÊîæÁöÑÁ±ªÂûã‰∏çÂêå„ÄÇËøôÈáå‰∏ªË¶ÅËØ¥Êòé‰∏Ä‰∏ãÔºåÂàùÂßãÂåñÁöÑ‰ª£Á†ÅÊîæÂú®‰ªÄ‰πà‰ΩçÁΩÆ„ÄÇÊàë‰πüÂà†Èô§‰∫ÜÂÖ∂‰∏≠‰∏Ä‰∫õ‰ª£Á†ÅÔºåÂ§ßËá¥ÁúãÁúãÂ∞±Â•Ω„ÄÇ 123456789101112131415161718192021222324252627282930313233// makehmap_small implements Go map creation for make(map[k]v) and// make(map[k]v, hint) when hint is known to be at most bucketCnt// at compile time and the map needs to be allocated on the heap.func makemap_small() *hmap &#123; h := new(hmap) h.hash0 = fastrand() return h&#125;// makemap implements Go map creation for make(map[k]v, hint).// If the compiler has determined that the map or the first bucket// can be created on the stack, h and/or bucket may be non-nil.// If h != nil, the map can be created directly in h.// If h.buckets != nil, bucket pointed to can be used as the first bucket.func makemap(t *maptype, hint int, h *hmap) *hmap &#123; ..... // initialize Hmap if h == nil &#123; h = (*hmap)(newobject(t.hmap)) &#125; h.hash0 = fastrand() // find size parameter which will hold the requested # of elements B := uint8(0) for overLoadFactor(hint, B) &#123; B++ &#125; h.B = B ...... return h&#125; ÂÖ∂‰∏≠ÈúÄË¶ÅÊ≥®ÊÑè‰∏Ä‰∏™ÁÇπÔºö‚ÄúB‚ÄùÔºåËøòËÆ∞ÂæóÂàöÊâçËØ¥ÂêçÂ≠óÂè´bmapÁöÑÊ°∂Êï∞ÈáèÊòØ‰∏çÁ°ÆÂÆöÁöÑÂêóÔºüËøô‰∏™B‰∏ÄÂÆöÁ®ãÂ∫¶‰∏äË°®Á§∫ÁöÑÂ∞±ÊòØÊ°∂ÁöÑÊï∞ÈáèÔºåÂΩìÁÑ∂‰∏çÊòØËØ¥BÊòØ3Ê°∂ÁöÑÊï∞ÈáèÂ∞±ÊòØ3ÔºåËÄåÊòØ2ÁöÑ3Ê¨°ÊñπÔºå‰πüÂ∞±ÊòØ8ÔºõÂΩìB‰∏∫5ÔºåÊ°∂ÁöÑÊï∞ÈáèÂ∞±ÊòØ32ÔºõËÆ∞‰ΩèËøô‰∏™BÔºåÂêéÈù¢‰ºöÁî®Âà∞ÂÆÉ„ÄÇ ÂÖ∂ÂÆû‰Ω†ÊÉ≥ÂòõÔºåÂàùÂßãÂåñËøòËÉΩÂπ≤‰ªÄ‰πàÔºåÊúÄÈáçË¶ÅÁöÑËÇØÂÆöÂ∞±ÊòØÁ°ÆÂÆö‰∏ÄÂºÄÂßãË¶ÅÊúâÂ§öÂ∞ë‰∏™Ê°∂ÔºåÂàùÂßãÁöÑÂ§ßÂ∞èËøòÊòØÂæàÈáçË¶ÅÁöÑÔºåËøòÊúâ‰∏Ä‰∫õÂà´ÁöÑÂàùÂßãÂåñÂìàÂ∏åÁßçÂ≠êÁ≠âÁ≠âÔºåÈóÆÈ¢ò‰∏çÂ§ß„ÄÇÊàë‰ª¨ÁöÑÈáçÁÇπËøòÊòØË¶ÅÊîæÂú®Â≠ò/Âèñ‰∏äÈù¢„ÄÇ GETÂõæËß£ÂÖ∂ÂÆû‰ªéÁªìÊûÑ‰∏äÈù¢Êù•ÁúãÔºåÊàë‰ª¨Â∑≤ÁªèÂèØ‰ª•Êë∏Âà∞‰∏Ä‰∫õÈó®ÈÅì‰∫Ü„ÄÇÂÖàËá™Â∑±ÊÉ≥‰∏Ä‰∏ãÔºåË¶Å‰ªé‰∏Ä‰∏™hashmap‰∏≠Ëé∑Âèñ‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈÇ£‰πà‰∏ÄÂÆöÊòØÈÄöËøákeyÁöÑÂìàÂ∏åÂÄºÂéªÂÆö‰ΩçÂà∞Ëøô‰∏™ÂÖÉÁ¥†ÔºåÈÇ£‰πàÊÉ≥ÁùÄËøô‰∏™Â§ßËá¥ÊñπÂêëÔºåÁúã‰∏ãÈù¢‰∏ÄÂº†ÊµÅÁ®ãÂõæÊù•ËØ¶ÁªÜÁêÜËß£golang‰∏≠ÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÁöÑ„ÄÇ Â§ßËØù‰∏ãÈù¢ËØ¥ÊòéË¶ÅÁÇπÔºö ËÆ°ÁÆóÂá∫keyÁöÑhash Áî®ÊúÄÂêéÁöÑ‚ÄúB‚Äù‰ΩçÊù•Á°ÆÂÆöÂú®Âì™‰∏™Ê°∂Ôºà‚ÄúB‚ÄùÂ∞±ÊòØÂâçÈù¢ËØ¥ÁöÑÈÇ£‰∏™ÔºåB‰∏∫4ÔºåÂ∞±Êúâ16‰∏™Ê°∂Ôºå0101Áî®ÂçÅËøõÂà∂Ë°®Á§∫‰∏∫5ÔºåÊâÄ‰ª•Âú®5Âè∑Ê°∂Ôºâ Ê†πÊçÆkeyÁöÑÂâç8‰ΩçÂø´ÈÄüÁ°ÆÂÆöÊòØÂú®Âì™‰∏™Ê†ºÂ≠êÔºàÈ¢ùÂ§ñËØ¥Êòé‰∏Ä‰∏ãÔºåÂú®bmap‰∏≠Â≠òÊîæ‰∫ÜÊØè‰∏™keyÂØπÂ∫îÁöÑtophashÔºåÊòØkeyÁöÑÂâç8‰ΩçÔºâ ÊúÄÁªàËøòÊòØÈúÄË¶ÅÊØîÂØπkeyÂÆåÊï¥ÁöÑhashÊòØÂê¶ÂåπÈÖçÔºåÂ¶ÇÊûúÂåπÈÖçÂàôËé∑ÂèñÂØπÂ∫îvalue Â¶ÇÊûúÈÉΩÊ≤°ÊúâÊâæÂà∞ÔºåÂ∞±Âéª‰∏ã‰∏Ä‰∏™overflowÊâæ ÊÄªÁªì‰∏Ä‰∏ãÔºöÈÄöËøáÂêéB‰ΩçÁ°ÆÂÆöÊ°∂ÔºåÈÄöËøáÂâç8‰ΩçÁ°ÆÂÆöÊ†ºÂ≠êÔºåÂæ™ÁéØÈÅçÂéÜËøûÁùÄÁöÑÊâÄÊúâÊ°∂ÂÖ®ÈÉ®ÊâæÂÆå‰∏∫Ê≠¢„ÄÇÈÇ£‰πà‰∏∫‰ªÄ‰πàË¶ÅÊúâËøô‰∏™tophashÂë¢ÔºüÂõ†‰∏∫tophashÂèØ‰ª•Âø´ÈÄüÁ°ÆÂÆökeyÊòØÂê¶Ê≠£Á°ÆÔºå‰Ω†ÂèØ‰ª•ÊääÂÆÉÁêÜËß£Êàê‰∏ÄÁßçÁºìÂ≠òÊé™ÊñΩÔºåÂ¶ÇÊûúÂâç8‰ΩçÈÉΩ‰∏çÂØπ‰∫ÜÔºåÂêéÈù¢Â∞±Ê≤°ÊúâÂøÖË¶ÅÊØîËæÉ‰∫Ü„ÄÇ Ê∫êÁ†Å‰∏ÄÁû•ÂÖ∂‰∏≠Á∫¢Ëâ≤ÁöÑÂ≠óÊ†áÂá∫ÁöÑÂú∞ÊñπËØ¥Êòé‰∫Ü‰∏äÈù¢ÁöÑÂÖ≥ÈîÆÁÇπÔºåÊúÄÂêéÊúâÂÖ≥keyÂíåvalueÂÖ∑‰ΩìÁöÑÂ≠òÊîæÊñπÂºèÂíåÂèñÂá∫ÁöÑÂÆö‰Ωç‰∏çÂÅöÊ∑±Á©∂ÔºåÊúâÂÖ¥Ë∂£ÂèØ‰ª•ÁúãÊúÄÂêéÁöÑÂèÇËÄÉÂçöÂÆ¢„ÄÇ PUTÂÖ∂ÂÆûÂΩì‰Ω†Áü•ÈÅì‰∫ÜÂ¶Ç‰ΩïGETÔºåÈÇ£‰πàPUTÂ∞±Ê≤°Êúâ‰ªÄ‰πàÈöæÂ∫¶‰∫ÜÔºåÂõ†‰∏∫Êú¨Ë¥®ÊòØ‰∏ÄÊ†∑ÁöÑ„ÄÇPUTÁöÑÊó∂ÂÄô‰∏ÄÊ†∑ÁöÑÊñπÂºèÂéªÂÆö‰ΩçkeyÁöÑ‰ΩçÁΩÆÔºö ÈÄöËøákeyÁöÑÂêé‚ÄúB‚Äù‰ΩçÁ°ÆÂÆöÊòØÂì™‰∏Ä‰∏™Ê°∂ ÈÄöËøákeyÁöÑÂâç8‰ΩçÂø´ÈÄüÁ°ÆÂÆöÊòØÂê¶Â∑≤ÁªèÂ≠òÂú® ÊúÄÁªàÁ°ÆÂÆöÂ≠òÊîæ‰ΩçÁΩÆÔºåÂ¶ÇÊûú8‰∏™Ê†ºÂ≠êÂ∑≤ÁªèÊª°‰∫ÜÔºåÊ≤°Âú∞ÊñπÊîæ‰∫ÜÔºåÈÇ£‰πàÂ∞±ÈáçÊñ∞ÂàõÂª∫‰∏Ä‰∏™bmap‰Ωú‰∏∫Ê∫¢Âá∫Ê°∂ËøûÊé•Âú®overflow ÂõæËß£ËøôÈáå‰∏ªË¶ÅÂõæËß£ËØ¥Êòé‰∏Ä‰∏ãÔºåÂ¶ÇÊûúÊñ∞Êù•ÁöÑkeyÂèëÁé∞ÂâçÈù¢Êúâ‰∏Ä‰∏™Ê†ºÂ≠êÁ©∫ÁùÄÔºàËøô‰∏™ÊÉÖÂÜµÊòØÂà†Èô§ÈÄ†ÊàêÁöÑÔºâÔºåÂ∞±‰ºöËÆ∞ÂΩïËøô‰∏™‰ΩçÁΩÆÔºåÂΩìÂÖ®ÈÉ®Êâ´ÊèèÂÆåÊàê‰πãÂêéÂèëÁé∞Ëá™Â∑±Á°ÆÂÆûÊòØÊñ∞Êù•ÁöÑÔºåÈÇ£‰πàÂ∞±‰ºöÊîæÂâçÈù¢ÈÇ£‰∏™Á©∫ÁùÄÁöÑÔºåËÄå‰∏ç‰ºöÊîæÊúÄÂêéÔºàÊàëÊääËøô‰∏™Áß∞‰∏∫Á¥ßÂáëÂéüÂàôÔºåÂ∞ΩÂèØËÉΩ‰øùËØÅÊï∞ÊçÆÂ≠òÊîæÁ¥ßÂáëÔºåËøôÊ†∑‰∏ãÊ¨°Êâ´Êèè‰ºöÂø´Ôºâ ‰ª£Á†Å‰ΩçÁΩÆgo/src/runtime/hashmap.goÁöÑmapassignÂáΩÊï∞Â∞±ÊòØmapÁöÑputÊñπÊ≥ïÔºåÂõ†‰∏∫‰ª£Á†ÅÂæàÈïøËøôÈáåÂ∞±‰∏çÂ§öËµòËø∞‰∫Ü„ÄÇ Êâ©ÂÆπËøô‰∏™Â∞±ÊòØÊúÄÂ§çÊùÇÁöÑÂú∞Êñπ‰∫ÜÔºå‰ΩÜÊòØÂë¢ÔºüDon‚Äôt worryÊàëËøôÈáåËøòÊòØ‰ºöÁúÅÁï•ÂÖ∂‰∏≠Êüê‰∫õÈÉ®ÂàÜÔºåÂ∞ÜÊúÄÈáçË¶ÅÁöÑÂú∞ÊñπÊãéÂá∫Êù•„ÄÇ Êâ©ÂÆπÁöÑÊñπÂºè Áõ∏ÂêåÂÆπÈáèÊâ©ÂÆπ 2ÂÄçÂÆπÈáèÊâ©ÂÆπÂï•ÊÑèÊÄùÂë¢ÔºüÁ¨¨‰∏ÄÁßçÂá∫Áé∞ÁöÑÊÉÖÂÜµÊòØÔºöÂõ†‰∏∫map‰∏çÊñ≠ÁöÑputÂíådeleteÔºåÂá∫Áé∞‰∫ÜÂæàÂ§öÁ©∫Ê†ºÔºåËøô‰∫õÁ©∫Ê†º‰ºöÂØºËá¥bmapÂæàÈïøÔºå‰ΩÜÊòØ‰∏≠Èó¥ÊúâÂæàÂ§öÁ©∫ÁöÑÂú∞ÊñπÔºåÊâ´ÊèèÊó∂Èó¥ÂèòÈïø„ÄÇÊâÄ‰ª•Á¨¨‰∏ÄÁßçÊâ©ÂÆπÂÆûÈôÖÊòØ‰∏ÄÁßçÊï¥ÁêÜÔºåÂ∞ÜÊï∞ÊçÆÊï¥ÁêÜÂà∞ÂâçÈù¢‰∏ÄËµ∑„ÄÇÁ¨¨‰∫åÁßçÂë¢ÔºöÂ∞±ÊòØÁúüÁöÑ‰∏çÂ§üÁî®‰∫ÜÔºåÊâ©ÂÆπ‰∏§ÂÄç„ÄÇ Êâ©ÂÆπÁöÑÊù°‰ª∂Ë£ÖËΩΩÂõ†Â≠êÂ¶ÇÊûú‰Ω†ÁúãËøáJavaÁöÑHashMapÂÆûÁé∞ÔºåÂ∞±Áü•ÈÅìÊúâ‰∏™Ë£ÖËΩΩÂõ†Â≠êÔºåÂêåÊ†∑ÁöÑÂú®golang‰∏≠‰πüÊúâÔºå‰ΩÜÊòØ‰∏ç‰∏ÄÊ†∑Âì¶„ÄÇË£ÖËΩΩÂõ†Â≠êÁöÑÂÆö‰πâÊòØËøô‰∏™Ê†∑Â≠êÔºöloadFactor := count / (2^B)ÂÖ∂‰∏≠count‰∏∫map‰∏≠ÂÖÉÁ¥†ÁöÑ‰∏™Êï∞ÔºåBÂ∞±ÊòØ‰πãÂâç‰∏™ÈÇ£‰∏™‚ÄúB‚ÄùÁøªËØë‰∏Ä‰∏ãÂ∞±ÊòØË£ÖËΩΩÂõ†Â≠ê = Ôºàmap‰∏≠ÂÖÉÁ¥†ÁöÑ‰∏™Êï∞Ôºâ/ÔºàmapÂΩìÂâçÊ°∂ÁöÑ‰∏™Êï∞Ôºâ Êâ©ÂÆπÊù°‰ª∂1Ë£ÖËΩΩÂõ†Â≠ê &gt; 6.5ÔºàËøô‰∏™ÂÄºÊòØÊ∫êÁ†Å‰∏≠ÂÜôÁöÑÔºâÂÖ∂ÂÆûÊÑèÊÄùÂ∞±ÊòØÔºåÊ°∂Âè™ÊúâÈÇ£‰πàÂá†‰∏™Ôºå‰ΩÜÊòØÂÖÉÁ¥†ÂæàÂ§öÔºåËØÅÊòéÊúâÂæàÂ§öÊ∫¢Âá∫Ê°∂ÁöÑÂ≠òÂú®ÔºàÂèØ‰ª•ÊÉ≥ÊàêÈìæË°®ÊãâÁöÑÂ§™Èïø‰∫ÜÔºâÔºåÈÇ£‰πàÊâ´ÊèèÈÄüÂ∫¶‰ºöÂæàÊÖ¢ÔºåÂ∞±Ë¶ÅÊâ©ÂÆπ„ÄÇ Êâ©ÂÆπÊù°‰ª∂2overflow ÁöÑ bucket Êï∞ÈáèËøáÂ§öÔºöÂΩì B Â∞è‰∫é 15ÔºåÂ¶ÇÊûú overflow ÁöÑ bucket Êï∞ÈáèË∂ÖËøá 2^B ÔºõÂΩì B &gt;= 15ÔºåÂ¶ÇÊûú overflow ÁöÑ bucket Êï∞ÈáèË∂ÖËøá 2^15 „ÄÇÂÖ∂ÂÆûÊÑèÊÄùÂ∞±ÊòØÔºåÂèØËÉΩÊúâ‰∏Ä‰∏™ÂçïÁã¨ÁöÑ‰∏ÄÊù°ÈìæÊãâÁöÑÂæàÈïøÔºåÊ∫¢Âá∫Ê°∂Â§™Â§ö‰∫ÜÔºåËØ¥ÁôΩ‰∫ÜÂ∞±ÊòØÔºåÂä†ÂÖ•ÁöÑkey‰∏çÂ∑ßÔºåÂêéB‰ΩçÈÉΩ‰∏ÄÊ†∑Ôºå‰∏ÄÁõ¥ËêΩÂú®Âêå‰∏Ä‰∏™Ê°∂ÈáåÈù¢ÔºåËøô‰∏™Ê°∂‰∏ÄÁõ¥ÊîæÔºåËôΩÁÑ∂Ë£ÖËΩΩÂõ†Â≠ê‰∏çÈ´òÔºå‰ΩÜÊòØÊâ´ÊèèÈÄüÂ∫¶Â∞±ÂæàÊÖ¢„ÄÇ Êâ©ÂÆπÊù°‰ª∂3ÂΩìÂâç‰∏çËÉΩÊ≠£Âú®Êâ©ÂÆπ ÂõæËß£ËøôÂº†ÂõæË°®Á§∫ÁöÑÂ∞±ÊòØÁõ∏ÂêåÂÆπÈáèÁöÑÊâ©ÂÆπÔºåÂÆûÈôÖ‰∏äÂ∞±ÊòØ‰∏ÄÁßçÊï¥ÁêÜÔºåÂ∞ÜÂàÜÊï£ÁöÑÊï∞ÊçÆÈõÜÂêàÂà∞‰∏ÄËµ∑ÔºåÊèêÈ´òÊâ´ÊèèÊïàÁéá„ÄÇÔºà‰∏äÈù¢Ë°®Á§∫Êâ©ÂÆπ‰πãÂâçÔºå‰∏ãÈù¢Ë°®Á§∫Êâ©ÂÆπ‰πãÂêéÔºâ ËøôÂº†ÂõæË°®Á§∫ÁöÑÊòØÂ∞±ÊòØ2ÂÄçÁöÑÊâ©ÂÆπÔºà‰∏äÈù¢Ë°®Á§∫Êâ©ÂÆπ‰πãÂâçÔºå‰∏ãÈù¢Ë°®Á§∫Êâ©ÂÆπ‰πãÂêéÔºâÔºåÂ¶ÇÊûúÊúâ‰∏§‰∏™keyÂêé‰∏â‰ΩçÂàÜÂà´ÊòØ001Âíå101ÔºåÂΩìB=2Êó∂ÔºåÂè™Êúâ4‰∏™Ê°∂ÔºåÂè™ÁúãÊúÄÂêé‰∏§‰ΩçÔºåËøô‰∏§‰∏™keyÂêé‰∏§‰ΩçÈÉΩÊòØ01ÊâÄ‰ª•Âú®‰∏Ä‰∏™Ê°∂ÈáåÈù¢ÔºõÊâ©ÂÆπ‰πãÂêéB=3ÔºåÂ∞±‰ºöÊúâ8‰∏™Ê°∂ÔºåÁúãÂêéÈù¢‰∏â‰ΩçÔºå‰∫éÊòØÂÆÉ‰ª¨Â∞±ÂàÜÂà∞‰∫Ü‰∏çÂêåÁöÑÊ°∂ÈáåÈù¢„ÄÇ Â§ßËØù‰∏ãÈù¢ËØ¥‰∏Ä‰∫õÊâ©ÂÆπÊó∂ÁöÑÁªÜËäÇÔºö Êâ©ÂÆπ‰∏çÊòØ‰∏ÄÊ¨°ÊÄßÂÆåÊàêÁöÑÔºåËøòËÆ∞ÁöÑÊàë‰ª¨hmap‰∏ÄÂºÄÂßãÊúâ‰∏Ä‰∏™oldbucketsÂêóÔºüÊòØÂÖàÂ∞ÜËÄÅÊï∞ÊçÆÂ≠òÂà∞Ëøô‰∏™ÈáåÈù¢ ÊØèÊ¨°Êê¨Ëøê1Âà∞2‰∏™bucketÔºåÂΩìÊèíÂÖ•Êàñ‰øÆÊîπ„ÄÅÂà†Èô§keyËß¶Âèë Êâ©ÂÆπ‰πãÂêéËÇØÂÆö‰ºöÂΩ±ÂìçÂà∞getÂíåputÔºåÈÅçÂéÜÁöÑÊó∂ÂÄôËÇØÂÆö‰ºöÂÖà‰ªéoldbucketsÊãøÔºåputËÇØÂÆö‰πüË¶ÅËÄÉËôëÊòØÂê¶Ë¶ÅÊîæÂà∞Êñ∞‰∫ßÁîüÁöÑÊ°∂ÈáåÈù¢Âéª Ê∫êÁ†Å‰∏ÄÁû•Êâ©ÂÆπÁöÑ‰∏â‰∏™Êù°‰ª∂ÔºåÁúãÂà∞‰∫ÜÂêóÔºüËøô‰∏™Âú∞ÊñπÂú®mapassignÊñπÊ≥ï‰∏≠„ÄÇ ËøôÈáåÂèØ‰ª•ÁúãÂà∞ÔºåÊ≥®Èáä‰πüÂÜôÁöÑÂæàÊ∏ÖÊ•öÔºåÂ¶ÇÊûúÊòØÂä†ËΩΩÂõ†Â≠êË∂ÖÂá∫‰∫ÜÔºåÈÇ£‰πàÂ∞±2ÂÄçÊâ©ÂÆπÔºåÂ¶ÇÊûú‰∏çÊòØÈÇ£‰πàÂ∞±ÊòØÂõ†‰∏∫Â§™Â§öÊ∫¢Âá∫Ê°∂‰∫ÜÔºåsameSizeGrowË°®Á§∫Â∞±ÊòØÁõ∏ÂêåÂÆπÈáèÊâ©ÂÆπ evacuateÊòØÊê¨ËøêÊñπÊ≥ïÔºåËøôËæπÂèØ‰ª•ÁúãÂà∞ÔºåÊØèÊ¨°Êê¨ËøêÊòØ1Âà∞2‰∏™ evacuateÂÆûÂú®ÊòØÂ§™Èïø‰∫ÜÔºå‰πüÈùûÂ∏∏Â§çÊùÇÔºå‰ΩÜÊòØÊÉÖÂÜµÂ∞±ÊòØÂõæ‰∏äÊèèËø∞ÁöÑÈÇ£Ê†∑ÔºåÊúâÂÖ¥Ë∂£ÁöÑÂèØ‰ª•ËØ¶ÁªÜÂéªÁúãÔºåËøôÈáå‰∏çÊà™ÂõæËØ¥Êòé‰∫Ü„ÄÇ ÊÄªÁªìÂíåÂ∞èÈóÆÈ¢òËá≥Ê≠§‰Ω†Â∫îËØ•ÂØπ‰∫égolang‰∏≠ÁöÑmapÊúâ‰∏Ä‰∏™Âü∫Êú¨ÁöÑËÆ§ËØÜ‰∫ÜÔºå‰Ω†ËøòÂèØ‰ª•ÂéªÁúãÁúãÂà†Èô§Ôºå‰Ω†ËøòÂèØ‰ª•ÂéªÁúãÁúãÈÅçÂéÜÁ≠âÁ≠âÔºåÁõ∏‰ø°Êúâ‰∫Ü‰∏äÈù¢ÁöÑÂü∫Êú¨ËÆ§ËØÜÈÇ£‰πàÂ∫îËØ•‰∏ç‰ºöÈöæÂà∞‰Ω†„ÄÇ‰∏ãÈù¢ÊúâÂá†‰∏™Â∞èÈóÆÈ¢òÔºö ÊòØÂê¶Á∫øÁ®ãÂÆâÂÖ®ÔºüÂê¶ÔºåËÄå‰∏îÂπ∂ÂèëÊìç‰Ωú‰ºöÊäõÂá∫ÂºÇÂ∏∏„ÄÇ Ê∫êÁ†Å‰ΩçÁΩÆÔºösrc/runtime/hashmap.go ÊØèÊ¨°ÈÅçÂéÜmapÈ°∫Â∫èÊòØÂê¶‰∏ÄËá¥Ôºü‰∏ç‰∏ÄËá¥ÔºåÊØèÊ¨°ÈÅçÂéÜ‰ºöÈöèÊú∫‰∏™Êï∞ÔºåÈÄöËøáÈöèÊú∫Êï∞Êù•ÂÜ≥ÂÆö‰ªéÂì™‰∏™ÂÖÉÁ¥†ÂºÄÂßã„ÄÇ ÂÜôÁöÑ‰ªì‰øÉÔºåÈöæÂÖçÁñèÊºèÔºåÊúâÈóÆÈ¢òÁöÑÂú∞ÊñπËøòËØ∑ÊâπËØÑÊåáÊ≠£„ÄÇ ÂèÇËÄÉËµÑÊñôÂ¶ÇÊûú‰Ω†Â∏åÊúõÁúãÂà∞Ê∫êÁ†ÅÁöÑÂêÑÁßçÁªÜËäÇËÆ≤Ëß£Ôºå‰∏ãÈù¢ËøôÂá†ÁØáÊòØÊàëÂ≠¶‰π†ÁöÑÊó∂ÂÄôÁúãÁöÑÔºå‰æõ‰Ω†ÂèÇËÄÉÔºåÂ∏åÊúõÂØπ‰Ω†ÊúâÂ∏ÆÂä©https://github.com/qcrao/Go-Questions/tree/master/maphttps://github.com/cch123/golang-notes/blob/master/map.mdhttps://draveness.me/golang-hashmaphttps://lukechampine.com/hackmap.html]]></content>
      <categories>
        <category>golangÊ∫êÁ†ÅËß£Êûê</category>
      </categories>
      <tags>
        <tag>hashmap</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Golang ËØªÂÜôÈîÅRWMutex ‰∫íÊñ•ÈîÅMutex Ê∫êÁ†ÅËØ¶Ëß£]]></title>
    <url>%2F2019%2F06%2F01%2Fgolang%2Fsource-code%2Frwmutex-mutex-source-code-review%2F</url>
    <content type="text"><![CDATA[Golang‰∏≠Êúâ‰∏§ÁßçÁ±ªÂûãÁöÑÈîÅÔºåMutex Ôºà‰∫íÊñ•ÈîÅÔºâÂíåRWMutexÔºàËØªÂÜôÈîÅÔºâÂØπ‰∫éËøô‰∏§ÁßçÈîÅÁöÑ‰ΩøÁî®ËøôÈáåÂ∞±‰∏çÂ§öËØ¥‰∫ÜÔºåÊú¨Êñá‰∏ªË¶Å‰æßÈáç‰∫é‰ªéÊ∫êÁ†ÅÁöÑËßíÂ∫¶ÂàÜÊûêËøô‰∏§ÁßçÈîÅÁöÑÂÖ∑‰ΩìÂÆûÁé∞„ÄÇ ÂºïÂ≠êÈóÆÈ¢òÊàë‰∏ÄËà¨ÂñúÊ¨¢Â∏¶ÁùÄÈóÆÈ¢òÂéªÁúãÊ∫êÁ†Å„ÄÇÈÇ£‰πàÂØπ‰∫éËØªÂÜôÈîÅÔºå‰Ω†ÊòØÂê¶ÊúâËøôÊ†∑ÁöÑÈóÆÈ¢òÔºå‰∏∫‰ªÄ‰πàÂèØ‰ª•ÊúâÂ§ö‰∏™ËØªÈîÅÔºüÊúâÊ≤°ÊúâÂèØËÉΩÂá∫Áé∞ÊúâÂçèÁ®ã‰∏ÄÁõ¥Êó†Ê≥ïËé∑ÂèñÂà∞ÂÜôÈîÅÁöÑÊÉÖÂÜµÔºüÂ∏¶ÁùÄ‰Ω†ÁöÑÁñëÈóÆÊù•ÂæÄ‰∏ãÁúãÁúãÔºåÂÖ∑‰ΩìËøô‰∏™ÈîÅÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÁöÑ„ÄÇ Â¶ÇÊûú‰Ω†Ëá™Â∑±ÊÉ≥ÁúãÔºåÊàëÁªôÂá∫ÈòÖËØªÁöÑ‰∏Ä‰∏™ÊÄùË∑ØÔºåÂèØ‰ª•ÂÖàÁúãËØªÂÜôÈîÅÔºåÂõ†‰∏∫ËØªÂÜôÈîÅÁöÑÂÆûÁé∞‰æùËµñ‰∫é‰∫íÊñ•ÈîÅÔºåÂπ∂‰∏îËØªÂÜôÈîÅÊØîËæÉÁÆÄÂçï‰∏Ä‰∫õÔºåÁÑ∂ÂêéÊï¥ÁêÜÊÄùË∑Ø‰πãÂêéÂÜçÂéªÊÉ≥‰∏Ä‰∏ãÂÆûÈôÖÁöÑÂ∫îÁî®Âú∫ÊôØÔºåÁÑ∂ÂêéÂÜçÂéªÁúã‰∫íÊñ•ÈîÅ„ÄÇ ‰∏ãÈù¢ÊàëÂ∞±‰ºöÊåâÁÖßËøô‰∏™ÊÄùË∑Ø‰∏ÄÊ≠•Ê≠•ÂæÄ‰∏ãËµ∞„ÄÇ Âü∫Á°ÄÁü•ËØÜÁÇπ Áü•ËØÜÁÇπ1Ôºö‰ø°Âè∑Èáè‰ø°Âè∑ÈáèÊòØ Edsger Dijkstra ÂèëÊòéÁöÑÊï∞ÊçÆÁªìÊûÑÔºàÊ≤°ÈîôÂ∞±ÊòØÈÇ£‰∏™ÊúÄÁü≠Ë∑ØÂæÑÁÆóÊ≥ïÈÇ£‰∏™Áâõ‰∫∫ÔºâÔºåÂú®Ëß£ÂÜ≥Â§öÁßçÂêåÊ≠•ÈóÆÈ¢òÊó∂ÂæàÊúâÁî®„ÄÇÂÖ∂Êú¨Ë¥®ÊòØ‰∏Ä‰∏™Êï¥Êï∞ÔºåÂπ∂ÂÖ≥ËÅî‰∏§‰∏™Êìç‰ΩúÔºö Áî≥ËØ∑acquireÔºà‰πüÁß∞‰∏∫ wait„ÄÅdecrement Êàñ P Êìç‰ΩúÔºâÈáäÊîæreleaseÔºà‰πüÁß∞ signal„ÄÅincrement Êàñ V Êìç‰ΩúÔºâ acquireÊìç‰ΩúÂ∞Ü‰ø°Âè∑ÈáèÂáè 1ÔºåÂ¶ÇÊûúÁªìÊûúÂÄº‰∏∫Ë¥üÂàôÁ∫øÁ®ãÈòªÂ°ûÔºå‰∏îÁõ¥Âà∞ÂÖ∂‰ªñÁ∫øÁ®ãËøõË°å‰∫Ü‰ø°Âè∑ÈáèÁ¥ØÂä†‰∏∫Ê≠£Êï∞ÊâçËÉΩÊÅ¢Â§ç„ÄÇÂ¶ÇÁªìÊûú‰∏∫Ê≠£Êï∞ÔºåÁ∫øÁ®ãÂàôÁªßÁª≠ÊâßË°å„ÄÇreleaseÊìç‰ΩúÂ∞Ü‰ø°Âè∑ÈáèÂä† 1ÔºåÂ¶ÇÂ≠òÂú®Ë¢´ÈòªÂ°ûÁöÑÁ∫øÁ®ãÔºåÊ≠§Êó∂‰ªñ‰ª¨‰∏≠ÁöÑ‰∏Ä‰∏™Á∫øÁ®ãÂ∞ÜËß£Èô§ÈòªÂ°û„ÄÇ Áü•ËØÜÁÇπ2ÔºöÈîÅÁöÑÂÆö‰πâÂú®goalng‰∏≠Â¶ÇÊûúÂÆûÁé∞‰∫ÜLockÂíåUnlockÊñπÊ≥ïÔºåÈÇ£‰πàÂÆÉÂ∞±ÂèØ‰ª•Ë¢´Áß∞‰∏∫ÈîÅ„ÄÇ Áü•ËØÜÁÇπ3ÔºöÈîÅÁöÑËá™ÊóãÔºöÔºàËØ¶ËßÅÁôæÂ∫¶Ôºâ Áü•ËØÜÁÇπ4ÔºöcasÁÆóÊ≥ïÔºöÔºàÊúÄÂ•ΩÊúâÊâÄ‰∫ÜËß£Ôºå‰∏çÁü•ÈÅìÈóÆÈ¢ò‰πü‰∏çÂ§ßÔºâ ËØªÂÜôÈîÅRWMutexÈ¶ñÂÖàÊàë‰ª¨Êù•ÁúãÁúãRWMutexÂ§ß‰ΩìÁªìÊûÑÁúãÂà∞ÁªìÊûÑÂèëÁé∞ËØªÂÜôÈîÅÂÜÖÈÉ®ÂåÖÂê´‰∫Ü‰∏Ä‰∏™w Mutex‰∫íÊñ•ÈîÅÊ≥®Èáä‰πüÂæàÊòéÁ°ÆÔºåËøô‰∏™ÈîÅÁöÑÁõÆÁöÑÂ∞±ÊòØÊéßÂà∂Â§ö‰∏™ÂÜôÂÖ•Êìç‰ΩúÁöÑÂπ∂ÂèëÊâßË°åwriterSemÊòØÂÜôÂÖ•Êìç‰ΩúÁöÑ‰ø°Âè∑ÈáèreaderSemÊòØËØªÊìç‰ΩúÁöÑ‰ø°Âè∑ÈáèreaderCountÊòØÂΩìÂâçËØªÊìç‰ΩúÁöÑ‰∏™Êï∞readerWaitÂΩìÂâçÂÜôÂÖ•Êìç‰ΩúÈúÄË¶ÅÁ≠âÂæÖËØªÊìç‰ΩúËß£ÈîÅÁöÑ‰∏™Êï∞ËøôÂá†‰∏™Áé∞Âú®Áúã‰∏çÊáÇÊ≤°ÂÖ≥Á≥ªÔºåÂêéÈù¢Á≠âÁî®Âà∞‰∫Ü‰Ω†ÂÜçÂõûÊù•ÁúãÂ∞±Â•Ω‰∫Ü„ÄÇ ÁÑ∂ÂêéÊàë‰ª¨ÁúãÁúãÊñπÊ≥ï‰∏ÄÂÖ±Êúâ5‰∏™ÊñπÊ≥ïÔºåÁúãËµ∑Êù•Â∞±‰∏çÂ§çÊùÇÔºåÊàë‰ª¨‰∏Ä‰∏™‰∏™Êù•Áúã„ÄÇ Ëøô‰∏™ÊúÄÁÆÄÂçïÔºåÂ∞±ÊòØËøîÂõû‰∏Ä‰∏™lockerÂØπË±°Ê≤°Âï•Â•ΩËØ¥ÁöÑ ÈóÆÈ¢òÁöÑÂÖ≥ÈîÆÂ∞±Âú®‰∫éÈîÅÂíåËß£ÈîÅÁöÑÂá†‰∏™ÊñπÊ≥ïÔºåÂõ†‰∏∫ÊàëÂ∑≤ÁªèÁúãËøáÔºåÊâÄ‰ª•Êé®ËçêËøôÂá†‰∏™ÊñπÊ≥ïÁöÑÈòÖËØªÈ°∫Â∫èÊòØRLock Lock RUnlock Unlock RLockÔºàËé∑ÂèñËØªÈîÅÔºâÂÖà‰∏çÁúãÁ´ûÊÄÅÊ£ÄÊµãÁöÑÈÉ®ÂàÜÔºåÂÖàÈáçÁÇπÁúãÁ∫¢Ëâ≤Ê°Ü‰∏≠ÁöÑÈÉ®ÂàÜÂèØ‰ª•ÁúãÂà∞ÔºåÂÖ∂ÂÆûÂæàÁÆÄÂçïÔºåÊØèÂΩìÊúâÂçèÁ®ãÈúÄË¶ÅËé∑ÂèñËØªÈîÅÁöÑÊó∂ÂÄôÔºåÂ∞±Â∞ÜreaderCount + 1‰ΩÜÊòØÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåËøôÈáåÊúâ‰∏Ä‰∏™Êù°‰ª∂ÔºåÂΩìreaderCount + 1‰πãÂêéÁöÑÂÄº &lt; 0ÁöÑÊó∂ÂÄôÔºåÈÇ£‰πàÂ∞Ü‰ºöË∞ÉÁî®runtime_SemacquireÊñπÊ≥ïËøô‰∏™ÊñπÊ≥ïÊòØ‰∏Ä‰∏™runtimeÁöÑÊñπÊ≥ïÔºå‰ºö‰∏ÄÁõ¥Á≠âÂæÖ‰º†ÂÖ•ÁöÑsÂá∫Áé∞&gt;0ÁöÑÊó∂ÂÄôÁÑ∂ÂêéÊàë‰ª¨ÂèØ‰ª•ËÆ∞ÂæóÔºåËøôÈáåÊúâËøôÊ†∑‰∏Ä‰∏™ÊÉÖÂÜµÔºåÂΩìÂá∫ÂÖàreaderCount + 1‰∏∫Ë¥üÊï∞ÁöÑÊÉÖÂÜµÈÇ£‰πàÂ∞±‰ºöË¢´Á≠âÂæÖÔºåÁúãÊ≥®ÈáäÊàë‰ª¨ÂèØ‰ª•ÁåúÂà∞ÔºåÊòØÂΩìÊúâÂÜôÂÖ•Êìç‰ΩúÂá∫Áé∞ÁöÑÊó∂ÂÄôÔºåÈÇ£‰πàËØªÊìç‰ΩúÂ∞±‰ºöË¢´Á≠âÂæÖ„ÄÇ LockÔºàËé∑ÂèñÂÜôÈîÅÔºâÂÜôÈîÅÁ®çÂæÆÂ§çÊùÇ‰∏Ä‰∫õÔºå‰ΩÜÊòØÊ†∑Â≠ê‰πüÂ∑Æ‰∏çÂ§öÔºåÊàë‰ª¨ËøòÊòØÂÖàÊù•ÁúãÁ∫¢Ëâ≤Ê°Ü‰∏≠ÁöÑÈÉ®ÂàÜ„ÄÇÈ¶ñÂÖàÊìç‰ΩúÊúÄÂâçÈù¢ËØ¥ÁöÑ‰∫íÊñ•ÈîÅÔºåÁõÆÁöÑÂ∞±ÊòØÂ§ÑÁêÜÂ§ö‰∏™ÂÜôÈîÅÂπ∂ÂèëÁöÑÊÉÖÂÜµÔºåÂõ†‰∏∫Êàë‰ª¨Áü•ÈÅìÂÜôÈîÅÂè™Êúâ‰∏ÄÊää„ÄÇËøôÈáå‰∏çÈúÄË¶ÅÊ∑±ÂÖ•‰∫íÊñ•ÈîÅÔºåÂè™ÈúÄË¶ÅÁü•ÈÅìÔºå‰∫íÊñ•ÈîÅÂè™Êúâ‰∏Ä‰∏™‰∫∫ËÉΩÊãøÂà∞ÔºåÊâÄ‰ª•ÂÜôÈîÅÂè™Êúâ‰∏Ä‰∏™‰∫∫ËÉΩÊãøÂà∞„ÄÇ ÁÑ∂ÂêéÈáçÁÇπÊù•‰∫ÜÔºåËøôÈáåÁöÑËøô‰∏™Êìç‰ΩúÁªÜÁªÜ‰Ωì‰ºö‰∏Ä‰∏ãÔºåatomic.AddInt32(&amp;rw.readerCount, -rwmutexMaxReaders)ÊòØÂ∞ÜÂΩìÂâçÁöÑreaderCountÂáèÂéª‰∏Ä‰∏™ÈùûÂ∏∏Â§ßÁöÑÂÄºrwmutexMaxReaders‰∏∫1 &lt;&lt; 30Â§ßÊ¶ÇÊòØ1073741823Ëøô‰πàÂ§ßÂêß ÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•‰ªéÊ∫êÁ†Å‰∏≠ÁúãÂá∫ÔºåreaderCountÁî±‰∫éÊØèÊúâ‰∏Ä‰∏™ÂçèÁ®ãËé∑ÂèñËØªÈîÅÂ∞±+1Ôºå‰∏ÄÁõ¥ÈÉΩÊòØÊ≠£Êï∞ÔºåËÄåÂΩìÊúâÂÜôÈîÅËøáÊù•ÁöÑÊó∂ÂÄôÔºåÂ∞±Áû¨Èó¥Âáè‰∏∫ÂæàÂ§ßÁöÑË¥üÊï∞„ÄÇÁÑ∂ÂêéÂÅöÂÆå‰∏äÈù¢ÁöÑÊìç‰Ωú‰ª•ÂêéÁöÑrÂÖ∂ÂÆûÂ∞±ÊòØÂéüÊù•ÁöÑreaderCount„ÄÇÂêéÈù¢ËøõË°åÂà§Êñ≠ÔºåÂ¶ÇÊûúÂéüÊù•ÁöÑreaderCount‰∏ç‰∏∫0ÔºàÂéüÊù•ÊúâÂçèÁ®ãÂ∑≤ÁªèËé∑ÂèñÂà∞‰∫ÜËØªÈîÅÔºâÂπ∂‰∏îÂ∞ÜreaderWaitÂä†‰∏äreaderCountÔºàË°®Á§∫ÈúÄË¶ÅÁ≠âÂæÖreaderCountËøô‰πàÂ§ö‰∏™ËØªÈîÅËøõË°åËß£ÈîÅÔºâÔºåÂ¶ÇÊûúÊª°Ë∂≥‰∏äËø∞Êù°‰ª∂ËØÅÊòéÂéüÊù•ÊúâËØªÈîÅÔºåÊâÄ‰ª•ÊöÇÊó∂Ê≤°ÊúâÂäûÊ≥ïËé∑ÂèñÂà∞ÂÜôÈîÅÔºåÊâÄ‰ª•Ë∞ÉÁî®runtime_SemacquireËøõË°åÁ≠âÂæÖÔºåÁ≠âÂæÖÁöÑ‰ø°Âè∑Èáè‰∏∫writerSem RUnlockÔºàÈáäÊîæËØªÈîÅÔºâÂ¶ÇÊûúÊòØÊàë‰ª¨Êù•ÂÜôÁöÑËØùÔºåÂèØËÉΩÂ∞±ÊòØÂ∞Ü‰πãÂâç+1ÁöÑreaderCountÔºå-1Â∞±ÂÆå‰∫ã‰∫ÜÔºå‰ΩÜÊòØÂÖ∂ÂÆûËøòÊúâ‰∏Ä‰∫õÊìç‰ΩúÈúÄË¶ÅÊ≥®ÊÑè„ÄÇÂ¶ÇÊûú-1‰πãÂêé+1==0ÊòØÂï•ÊÉÖÂÜµÔºüÊ≤°ÈîôÂ∞±ÊòØÊàë‰ª¨Â∏∏ËßÅÁöÑÔºåÊñ∞ÊâãÁ®ãÂ∫èÂëòÔºåÊ≤°ÊúâËé∑ÂèñËØªÈîÅÂ∞±ÊÉ≥ÂéªÈáäÊîæËØªÈîÅÔºå‰∫éÊòØÂºÇÂ∏∏‰∫Ü„ÄÇÂΩìÁÑ∂+1‰πãÂêéÂàöÂ•ΩÊòØrwmutexMaxReadersÔºåÂ∞±ËØÅËé∑Âèñ‰∫ÜÂÜôÈîÅËÄåÂéªÈáäÊîæ‰∫ÜËØªÈîÅÔºåÂØºËá¥ÂºÇÂ∏∏„ÄÇÈô§ÂéªÂºÇÂ∏∏ÊÉÖÂÜµÔºåÂâ©‰∏ãÁöÑÂ∞±ÊòØrËøòÊòØ&lt;0ÁöÑÊÉÖÂÜµÔºåÈÇ£‰πàËØÅÊòéÁ°ÆÂÆûÊúâÂçèÁ®ãÊ≠£Âú®ÊÉ≥Ë¶ÅËé∑ÂèñÂÜôÈîÅÔºåÈÇ£‰πàÂ∞±ÈúÄË¶ÅÊìç‰ΩúÊàë‰ª¨ÂâçÈù¢ÁúãÂà∞ÁöÑreaderWaitÔºåÂΩìreaderWaitÂáèÂà∞0ÁöÑÊó∂ÂÄôÂ∞±ËØÅÊòéÊ≤°Êúâ‰∫∫Ê≠£Âú®ÊåÅÊúâÂÜôÈîÅ‰∫ÜÔºåÂ∞±ÈÄöËøá‰ø°Âè∑ÈáèwriterSemÁöÑÂèòÂåñÂëäÁü•ÂàöÊâçÁ≠âÂæÖÁöÑÂçèÁ®ãÔºàÊÉ≥Ë¶ÅËé∑ÂèñÂÜôÈîÅÁöÑÂçèÁ®ãÔºâÔºö‰Ω†ÂèØ‰ª•ËøõË°åËé∑Âèñ‰∫Ü„ÄÇ Âà∞ËøôÈáå‰Ω†ÂèØ‰ª•ÊääÊÄùË∑ØÂ§ßËá¥‰∏≤Ëµ∑Êù•‰∫ÜÔºåÁÑ∂ÂêéÊáÇ‰∫ÜÂÜçÂæÄ‰∏ãÁúã„ÄÇ UnlockÔºàÈáäÊîæÂÜôÈîÅÔºâÂÜôÈîÅÈáäÊîæÈúÄË¶ÅÊÅ¢Â§çreaderCountÔºåËøòËÆ∞Âæó‰∏äÈîÅÁöÑÊó∂ÂÄôÂáè‰∫Ü‰∏Ä‰∏™ÂæàÂ§ßÁöÑÊï∞ÔºåËøô‰∏™Êó∂ÂÄôË¶ÅÂä†ÂõûÊù•‰∫Ü„ÄÇÂΩìÁÑ∂Âä†ÂÆå‰πãÂêéÂ¶ÇÊûú&gt;=rwmutexMaxReadersÊú¨Ë∫´ÔºåÈÇ£‰πàËøòÊòØÊñ∞ÊâãÁ®ãÂ∫èÂëòÁöÑÈóÆÈ¢òÔºåÂΩìÊ≤°ÊúâËé∑ÂèñÂÜôÈîÅÁöÑÊó∂ÂÄôÂ∞±ÂºÄÂßãÊÉ≥ÁùÄÈáäÊîæÂÜôÈîÅ‰∫Ü„ÄÇÁÑ∂ÂêéforÂæ™ÁéØÂ∞±ÊòØ‰∏∫‰∫ÜÈÄöÁü•ÊâÄÊúâÂú®Êàë‰ª¨RLockÊñπÊ≥ï‰∏≠ÁúãÂà∞ÁöÑÔºåÂΩìÊúâÂõ†‰∏∫ÊåÅÊúâÂÜôÈîÅÊâÄ‰ª•Á≠âÂæÖÁöÑÈÇ£‰∫õÂçèÁ®ãÔºåÈÄöËøá‰ø°Âè∑ÈáèreaderSemÂëäËØâ‰ªñ‰ª¨ÂèØ‰ª•Âä®‰∫Ü„ÄÇÊúÄÂêéÂà´ÂøòËÆ∞ËøòÊúâ‰∏Ä‰∏™‰∫íÊñ•ÈîÅÈúÄË¶ÅÈáäÊîæÔºåËÆ©Âà´ÁöÑÂçèÁ®ã‰πüÂèØ‰ª•ÂºÄÂßãÊä¢ÂÜôÈîÅ‰∫Ü„ÄÇ Ëá≥Ê≠§ÔºåËØªÂÜôÈîÅÁöÑÂàÜÊûêÂü∫Êú¨‰∏äÂëä‰∏ÄÊÆµËêΩ‰∫Ü„ÄÇÈíàÂØπ‰∫éÂÖ∂‰∏≠ÂÖ≥‰∫éÁ´ûÊÄÅÂàÜÊûêÁöÑ‰ª£Á†ÅÔºåÊúâÂÖ¥Ë∂£ÁöÑÂ∞è‰ºô‰º¥ÂèØ‰ª•Âéª‰∫ÜËß£‰∏Ä‰∏ã„ÄÇ ‰∫íÊñ•ÈîÅMutex‰∫íÊñ•ÈîÅÊØîËØªÂÜôÈîÅÂ§çÊùÇÔºå‰ΩÜÊòØÂ•ΩÂú®golangÁªôÁöÑÊ≥®ÈáäÂæàËØ¶ÁªÜÔºåÊâÄ‰ª•‰πü‰∏çÂõ∞ÈöæÔºàÊ≥®ÈáäÁúüÁöÑÂæàÈáçË¶ÅÔºâ„ÄÇÊàë‰ª¨ÂÖàÊù•ÁúãÁúãÈáåÈù¢ÁöÑ‰∏ÄÊÆµÊ≥®ÈáäÔºöÂæàÈïøÁöÑ‰∏ÄÊÆµËã±ÊñáÔºåÊàëÁî®Ëã±ËØ≠ÂõõÁ∫ßÁöÑÁøªËØëËÉΩÂäõÁªô‰Ω†ÁøªËØë‰∏Ä‰∏ãÔºåÂèØ‰ª•Â∞ÜÂ∞±ÁúãÁúãÔºåÂ¶ÇÊûúÂèØ‰ª•Âª∫ËÆÆ‰Ω†‰ªîÁªÜÁúãËã±ÊñáÁúãÊáÇÂÆÉÔºåÂõ†‰∏∫ËøôÂØπ‰∫éÂêéÈù¢ÁöÑÊ∫êÁ†ÅÈòÖËØªÈùûÂ∏∏ÈáçË¶Å„ÄÇ///Ëøô‰∏™‰∫íÊñ•ÈîÅÊòØÂÖ¨Âπ≥ÈîÅ ‰∫íÊñ•ÈîÅÊúâ‰∏§ÁßçÊìç‰ΩúÊ®°ÂºèÔºöÊ≠£Â∏∏Ê®°ÂºèÂíåÈ••È•øÊ®°Âºè„ÄÇÂú®Ê≠£Â∏∏Ê®°Âºè‰∏ãÁ≠âÂæÖËé∑ÂèñÈîÅÁöÑgoroutine‰ºö‰ª•‰∏Ä‰∏™ÂÖàËøõÂÖàÂá∫ÁöÑÊñπÂºèËøõË°åÊéíÈòüÔºå‰ΩÜÊòØË¢´Âî§ÈÜíÁöÑÁ≠âÂæÖËÄÖÂπ∂‰∏çËÉΩ‰ª£Ë°®ÂÆÉÂ∑≤ÁªèÊã•Êúâ‰∫ÜËøô‰∏™mutexÈîÅÔºåÂÆÉÈúÄË¶Å‰∏éÊñ∞Âà∞ËææÁöÑgoroutine‰∫âÂ§∫mutexÈîÅ„ÄÇÊñ∞Êù•ÁöÑgoroutineÊúâ‰∏Ä‰∏™‰ºòÂäø ‚Äî‚Äî ‰ªñ‰ª¨Â∑≤ÁªèÂú®CPU‰∏äËøêË°å‰∫ÜÂπ∂‰∏î‰ªñ‰ª¨ÔºåÊâÄ‰ª•Êä¢Âà∞ÁöÑÂèØËÉΩÊÄßÂ§ß‰∏Ä‰∫õÔºåÊâÄ‰ª•‰∏Ä‰∏™Ë¢´Âî§ÈÜíÁöÑÁ≠âÂæÖËÄÖÊúâÂæàÂ§ßÂèØËÉΩÊä¢‰∏çËøá„ÄÇÂú®ËøôÊ†∑ÁöÑÊÉÖÂÜµ‰∏ãÔºåË¢´Âî§ÈÜíÁöÑÁ≠âÂæÖËÄÖÂú®ÈòüÂàóÁöÑÂ§¥ÈÉ®„ÄÇÂ¶ÇÊûú‰∏Ä‰∏™Á≠âÂæÖËÄÖÊä¢ÈîÅË∂ÖËøá1msÂ§±Ë¥•‰∫ÜÔºåÂ∞±‰ºöÂàáÊç¢‰∏∫È••È•øÊ®°Âºè„ÄÇ Âú®È••È•øÊ®°Âºè‰∏ãÔºåmutexÈîÅ‰ºöÁõ¥Êé•Áî±Ëß£ÈîÅÁöÑgoroutine‰∫§ÁªôÈòüÂàóÂ§¥ÈÉ®ÁöÑÁ≠âÂæÖËÄÖ„ÄÇÊñ∞Êù•ÁöÑgoroutine‰∏çËÉΩÂ∞ùËØïÂéªËé∑ÂèñÈîÅÔºåÂç≥‰ΩøÂèØËÉΩÊ†πÊú¨Â∞±Ê≤°goroutineÂú®ÊåÅÊúâÈîÅÔºåÂπ∂‰∏î‰∏çËÉΩÂ∞ùËØïËá™Êóã„ÄÇÂèñËÄå‰ª£‰πãÁöÑÊòØ‰ªñ‰ª¨Âè™ËÉΩÊéíÂà∞Èòü‰ºçÂ∞æÂ∑¥‰∏ä‰πñ‰πñÁ≠âÁùÄ„ÄÇ Â¶ÇÊûú‰∏Ä‰∏™Á≠âÂæÖËÄÖËé∑ÂèñÂà∞‰∫ÜÈîÅÔºåÂπ∂‰∏îÈÅáÂà∞‰∫Ü‰∏ãÈù¢‰∏§ÁßçÊÉÖÂÜµ‰πã‰∏ÄÔºåÂ∞±ÊÅ¢Â§çÊàêÊ≠£Â∏∏Â∑•‰ΩúÊ®°Âºè„ÄÇÊÉÖÂÜµ1ÔºöÂÆÉÊòØÊúÄÂêé‰∏Ä‰∏™ÈòüÂàó‰∏≠ÁöÑÁ≠âÂæÖËÄÖ„ÄÇÊÉÖÂÜµ2ÔºöÂÆÉÁ≠âÂæÖÁöÑÊó∂Èó¥Â∞è‰∫é1ms Ê≠£Â∏∏Ê®°Âºè‰∏ãÔºåÂç≥‰ΩøÊúâÂæàÂ§öÈòªÂ°ûÁöÑÁ≠âÂæÖËÄÖÔºåÊúâÊõ¥Â•ΩÁöÑË°®Áé∞ÔºåÂõ†‰∏∫‰∏ÄËΩÆËÉΩÂ§öÊ¨°Ëé∑ÂæóÈîÅÁöÑÊú∫‰ºö„ÄÇÈ••È•øÊ®°ÂºèÊòØ‰∏∫‰∫ÜÈÅøÂÖçÈÇ£‰∫õ‰∏ÄÁõ¥Âú®ÈòüÂ∞æÁöÑÂÄíÈúâËõã„ÄÇ/// ÊàëÁöÑËØùÁÆÄÂçïÊÄªÁªìÂ∞±ÊòØÔºå‰∫íÊñ•ÈîÅÊúâ‰∏§ÁßçÂ∑•‰ΩúÊ®°ÂºèÔºåÁ´û‰∫âÊ®°ÂºèÂíåÈòüÂàóÊ®°ÂºèÔºåÁ´û‰∫âÂ∞±ÊòØÂ§ßÂÆ∂‰∏ÄËµ∑Êä¢ÔºåÈòüÂàóÂ∞±ÊòØËÄÅËÄÅÂÆûÂÆûÊéíÈòüÔºåËøô‰∏§ÁßçÂ∑•‰ΩúÊ®°Âºè‰ºöÈÄöËøá‰∏Ä‰∫õÊÉÖÂÜµËøõË°åÂàáÊç¢„ÄÇ È¶ñÂÖàËøòÊòØÊù•ÁúãÁúãÂ§ß‰ΩìÁªìÊûÑÂèØ‰ª•ÁúãÂà∞ÔºåÁõ∏ÂØπËØªÂÜôÈîÅÔºåÁªìÊûÑ‰∏äÈù¢ÂæàÁÆÄÂçïÔºåÂè™Êúâ‰∏§‰∏™ÂÄºÔºå‰ΩÜÊòØÂçÉ‰∏á‰∏çË¶ÅÂ∞èÁûßÂÆÉÔºåÂáèÂ∞ë‰∫ÜÂ≠óÊÆµÂ∞±Â¢ûÂä†‰∫ÜÁêÜËß£ÈöæÂ∫¶„ÄÇstateÔºöÂ∞Ü‰∏Ä‰∏™32‰ΩçÊï¥Êï∞ÊãÜÂàÜ‰∏∫ÔºöÂΩìÂâçÈòªÂ°ûÁöÑgoroutineÊï∞(29‰Ωç)È••È•øÁä∂ÊÄÅ(1‰ΩçÔºå0‰∏∫Ê≠£Â∏∏Ê®°ÂºèÔºõ1‰∏∫È••È•øÊ®°Âºè)Âî§ÈÜíÁä∂ÊÄÅ(1‰ΩçÔºå0Êú™Âî§ÈÜíÔºõ1Â∑≤Âî§ÈÜí)ÈîÅÁä∂ÊÄÅ(1‰ΩçÔºå0ÂèØÁî®Ôºõ1Âç†Áî®) semaÔºö‰ø°Âè∑Èáè ÊñπÊ≥ï‰πüÂæàÁÆÄÂçïÔºåÂ∞±ÊòØLockÂíåUnlock‰∏§‰∏™ÊñπÊ≥ïÔºå‰∏Ä‰∏™‰∏äÈîÅÔºå‰∏Ä‰∏™Ëß£ÈîÅÔºåÊ≤°Âï•Â•ΩËØ¥ÁöÑ„ÄÇ ‰∏Ä‰∏™ÊñπÊ≥ïÊàë‰ª¨ÂÖàÊù•Áúã‰∏Ä‰∏™ÁöÑË¶ÅÁî®Âà∞ÁöÑÊñπÊ≥ï func CompareAndSwapInt32(addr *int32, old, new int32) (swapped bool)Ëøô‰∏™ÂáΩÊï∞Ôºå‰ºöÂÖàÂà§Êñ≠ÂèÇÊï∞addrÊåáÂêëÁöÑË¢´Êìç‰ΩúÂÄº‰∏éÂèÇÊï∞oldÁöÑÂÄºÊòØÂê¶Áõ∏Á≠âÔºåÂ¶ÇÊûúÁõ∏Á≠â‰ºöÂ∞ÜÂèÇÊï∞newÊõøÊç¢ÂèÇÊï∞addrÊâÄÊåáÂêëÁöÑÂÄºÔºå‰∏çÁÑ∂ÁöÑËØùÂ∞±Âï•‰πü‰∏çÂÅö„ÄÇÈúÄË¶ÅÁâπÂà´ËØ¥ÊòéÁöÑÊòØÔºåËøô‰∏™ÊñπÊ≥ïÂπ∂‰∏ç‰ºöÈòªÂ°û„ÄÇ Âá†‰∏™Â∏∏ÈáèËøôÊòØÂÆö‰πâÁöÑÂá†‰∏™Â∏∏ÈáèÔºåÊàë‰ª¨Âú®‰∏ÄÂºÄÂßãÁöÑÊ≥®ÈáäÂë®Âõ¥ÂèØ‰ª•ÁúãÂà∞ÔºåÂêéÈù¢ÈúÄË¶ÅÁî®Âà∞ÔºåÊöÇÊó∂ËÆ∞‰ΩèÂÆÉ‰ª¨ÁöÑÂàùÂßãÂÄºÂ∞±Â•Ω„ÄÇ mutexLocked = 1 &lt;&lt; iota // 1Â∑¶Áßª0‰ΩçÔºåÊòØ1Ôºå‰∫åËøõÂà∂ÊòØ1ÔºåÔºà1Ë°®Á§∫Â∑≤Áªè‰∏äÈîÅÔºâmutexWoken // 1Â∑¶Áßª1‰ΩçÔºåÊòØ2Ôºå‰∫åËøõÂà∂ÊòØ10mutexStarving // 1Â∑¶Áßª2‰ΩçÔºåÊòØ4Ôºå‰∫åËøõÂà∂ÊòØ100mutexWaiterShift = iota // Â∞±ÊòØ3Ôºå ‰∫åËøõÂà∂ÊòØ11 starvationThresholdNs = 1e6 // Ëøô‰∏™Â∞±ÊòØÊàë‰ª¨‰∏ÄÂºÄÂßãÂú®Ê≥®ÈáäÈáåÈù¢ÁúãÂà∞ÁöÑ1msÔºå‰∏ÄÂÆöË∂ÖËøáËøô‰∏™Èó®ÈôêÂÄºÂ∞±‰ºöÊõ¥Êç¢Ê®°Âºè LockËé∑ÂèñÈîÅÂõ†‰∏∫LockÊñπÊ≥ïÊØîËæÉÈïøÔºåÊâÄ‰ª•ÊàëÂàáÂàÜ‰∏ÄÊÆµÊÆµÁúãÔºåÈúÄË¶ÅÂÆåÊï¥ÁöÑËØ∑Ëá™Â∑±ÁøªÁúãÊ∫êÁ†Å„ÄÇË¶ÅÊ≥®ÊÑèÁöÑ‰∏ÄÁÇπÊòØÔºå‰∏ÄÂÆöË¶ÅÊó∂ÂàªËÆ∞‰ΩèÔºåLockÊñπÊ≥ïÊòØÂÅö‰ªÄ‰πàÁöÑÔºåÂæàÁÆÄÂçïÔºåÂ∞±ÊòØË¶ÅÊä¢ÈîÅ„ÄÇÁúã‰∏çÊáÇÁöÑÊó∂ÂÄôÊÉ≥ÊÉ≥Ëøô‰∏™ÁõÆÊ†á„ÄÇÁ¨¨‰∏ÄÊ≠•ÔºåÂà§Êñ≠stateÁä∂ÊÄÅÊòØÂê¶‰∏∫0ÔºåÂ¶ÇÊûú‰∏∫0ÔºåËØÅÊòéÊ≤°ÊúâÂçèÁ®ãÊåÅÊúâÈîÅÔºåÈÇ£‰πàÂ∞±ÂæàÁÆÄÂçï‰∫ÜÔºåÁõ¥Êé•Ëé∑ÂèñÂà∞ÈîÅÔºåÂ∞ÜmutexLockedÔºà‰∏∫1ÔºâËµãÂÄºÂà∞stateÂ∞±ÂèØ‰ª•‰∫Ü„ÄÇ ÁúãÂêéÈù¢ÁöÑÊñπÊ≥ïÊó∂ÔºåÂëäËØâÈúÄË¶ÅÂëäËØâ‰Ω†‰ª¨‰∏Ä‰∏™Â∞èÊäÄÂ∑ßÔºåÂΩìÈÅáÂà∞ËøôÁßç‰ΩçÊìç‰ΩúÂæàÂ§öÁöÑÊÉÖÂÜµÔºåÊúâ‰∏§‰∏™ÊñπÊ≥ïÊå∫Â•ΩÁî®ÔºåÂØπ‰∫é‰Ω†ÁúãÊ∫êÁ†Å‰ºöÊúâÂ∏ÆÂä©ÔºöÁ¨¨‰∏Ä‰∏™ÊòØÂ∞ÜÊâÄÊúâÂÆöÂÄºÂÖàËÆ°ÁÆóÔºåÁÑ∂ÂêéÂà§Êñ≠ÈùûÂÆöÂÄºÁöÑÊÉÖÂÜµÔºõÁ¨¨‰∫å‰∏™ÊòØÂ∞ÜÊâÄÊúâÁöÑËÆ°ÁÆóÂÜô‰∏ãÊù•ÔºåËá™Â∑±Áî®Á¨îÂéªËÆ°ÁÆóÔºå‰∏çË¶ÅÊâßÁùÄ‰∫éÊâìÂ≠ó„ÄÇ ÁÑ∂ÂêéÊàë‰ª¨‰ª•‰∏ãÈù¢Ëøô‰∏™ÊÆµ‰∏æ‰æãÔºöÈ¶ñÂÖàÔºåÁúãÊ≥®ÈáäÂ∫îËØ•ËÉΩÊòéÁôΩËøô‰∏ÄÊÆµÂ§ßËá¥ÊÑèÊÄùÊòØÔºåÂ¶ÇÊûú‰∏çÊòØÈ••È•øÊ®°ÂºèÔºåÂ∞±‰ºöËøõË°åËá™ÊóãÊìç‰ΩúÔºåÁÑ∂Âêé‰∏çÊñ≠Âæ™ÁéØ„ÄÇ ÁÑ∂ÂêéÊ†πÊçÆ‰∏äÈù¢ÁöÑÊäÄÂ∑ßÔºåold&amp;(mutexLocked|mutexStarving) == mutexLockedÔºà‰∏ãÈù¢Âùá‰∏∫‰∫åËøõÂà∂ÔºâmutexLocked = 1mutexStarving = 11mutexLocked = 1Ëøô‰∏â‰∏™ÊòØÂÆöÂÄºÔºåÊâÄ‰ª•Êàë‰ª¨ÂÆπÊòìÂæóÂà∞ÔºåÊª°Ë∂≥ÊÉÖÂÜµÁöÑÁªìÊûú‰∏∫ÔºåÂΩìold‰∏∫xxxx0xxÔºà‰∫åËøõÂà∂Á¨¨‰∏â‰Ωç‰∏∫0ÔºâÁ≠âÂºèÊàêÁ´ã„ÄÇ‰πüÂ∞±ÊòØÊàë‰ª¨‰∏ÄÂºÄÂßãËØ¥ÁöÑÔºåstateÁöÑÁ¨¨‰∏â‰ΩçÊòØË°®Á§∫Ëøô‰∏™ÈîÅÂΩìÂâçÁöÑÊ®°ÂºèÔºå0‰∏∫Ê≠£Â∏∏Ê®°ÂºèÔºå1‰∏∫È••È•øÊ®°Âºè„ÄÇ ÈÇ£‰πàÁ¨¨‰∏Ä‰∏™ifÂ∞±Ë°®Á§∫ÔºåÂ¶ÇÊûúÂΩìÂâçÊ®°Âºè‰∏∫Ê≠£Â∏∏Ê®°ÂºèÔºå‰∏îÂèØ‰ª•Ëá™ÊóãÔºåÂ∞±ËøõÂÖ•ifÊù°‰ª∂ÂÜÖÈÉ®„ÄÇif !awoke &amp;&amp; old&amp;mutexWoken == 0 &amp;&amp; old&gt;&gt;mutexWaiterShift != 0 &amp;&amp; ÂêåÊ†∑ÁöÑÂàÜÊûêÔºåawokeË°®Á§∫ÊòØÂê¶Âî§ÈÜíÔºåold&amp;mutexWokenÊòØÂèñÁ¨¨‰∫å‰ΩçÔºå0Ë°®Á§∫ÂΩìÂâçÂçèÁ®ãÊú™Ë¢´Âî§ÈÜíÔºåold&gt;&gt;mutexWaiterShiftË°®Á§∫Âè≥Áßª3‰ΩçÔºå‰πüÂ∞±ÊòØÂâç29‰ΩçÔºå‰∏ç‰∏∫0ËØÅÊòéÊúâÂçèÁ®ãÂú®Á≠âÂæÖÔºåÂπ∂‰∏îÂ∞ùËØïÂéªÂØπÊØîÂΩìÂâçm.state‰∏éÂèñÂá∫Êó∂ÁöÑoldÁä∂ÊÄÅÔºåÂ∞ùËØïÂéªÂî§ÈÜíËá™Â∑±„ÄÇÁÑ∂ÂêéËá™ÊóãÔºåÂπ∂‰∏îÂ¢ûÂä†Ëá™ÊóãÊ¨°Êï∞Ë°®Á§∫iterÔºåÁÑ∂ÂêéÈáçÊñ∞ËµãÂÄºold„ÄÇÂÜçÂæ™ÁéØ‰∏ã‰∏ÄÊ¨°„ÄÇ Ôºà‰Ω†Ëá™Â∑±ÁêÜ‰∏ÄÁêÜÔºåÁ°ÆÂÆûÊúâÁÇπÁªïÔºå‰ªîÁªÜÊÉ≥ÊÉ≥Â∞±ÊÉ≥ÈÄö‰∫ÜÂ∞±ÂØπ‰∫Ü„ÄÇÔºâ ‰ª•‰∏äÊòØ‰ΩøÁî®Ëá™ÊóãÁöÑÊÉÖÂÜµÔºåÂ∞±ÊòØcanSpinÁöÑ„ÄÇ ÁÑ∂ÂêéËøõË°åÂà§Êñ≠old&amp;mutexStarving == 0Â∞±ÊòØÁ¨¨‰∏â‰Ωç‰∏∫0ÁöÑÊÉÖÂÜµÔºåËøòÊòØÊâÄËØ¥ÁöÑÊ≠£Â∏∏Ê®°Âºè„ÄÇnewÂ∞±È©¨‰∏äÊãøÂà∞ÈîÅ‰∫ÜÔºånew |= mutexLockedÔºåË°®Á§∫Êàñ1ÔºåÂ∞±ÊòØÁ¨¨‰∏Ä‰ΩçÊó†ËÆ∫ÊòØÂï•ÈÉΩËµãÂÄº‰∏∫1 old&amp;(mutexLocked|mutexStarving)Ôºå‰πüÂ∞±ÊòØold &amp; 0101ÂøÖÈ°ªÂΩìoldÁöÑ1Âíå3‰∏§‰∏™‰ΩçÁΩÆ‰∏∫1ÁöÑÊó∂ÂÄôÊâçÊòØtrueÔºå‰πüÂ∞±ÊòØËØ¥ÂΩìÂâçÂ§Ñ‰∫éÈ••È•øÊ®°ÂºèÔºåÂπ∂‰∏îÈîÅÂ∑≤ÁªèË¢´Âç†Áî®ÁöÑÊÉÖÂÜµÔºåÈÇ£‰πàÂ∞±ÈúÄË¶ÅÊéíÈòüÂéª„ÄÇÊéíÈòü‰πüÂæàÁ≤æÂ¶ôÔºånew += 1 &lt;&lt; mutexWaiterShiftËøôËæπÊ≥®ÊÑèÊòØÂÖàËÆ°ÁÆó1 &lt;&lt; mutexWaiterShift‰πüÂ∞±ÊòØÂ∞ÜnewÁöÑÂâç29‰Ωç+1ÔºåÂ∞±ÊòØË°®Á§∫Êúâ‰∏Ä‰∏™ÂçèÁ®ãÂú®Á≠âÂæÖ‰∫Ü„ÄÇ Â•Ω‰∫ÜÂà∞ËøôÈáå‰Ω†ÁöÑ‰ΩçÊìç‰ΩúÂ∫îËØ•Â∞±‰π†ÊÉØÁöÑÂ∑Æ‰∏çÂ§ö‰∫ÜÔºå‰πãÂêéÊàëÂ∞±Áõ¥Êé•ËØ¥ÁªìËÆ∫Ôºå‰∏ç‰ªîÁªÜÁöÑÂ∏Æ‰Ω†01Ë°®Á§∫‰∫ÜÔºå‰Ω†Â∑≤ÁªèÈïøÂ§ß‰∫ÜÔºåË¶ÅÂ≠¶‰ºöËá™Â∑±Âä®Êâã‰∫Ü„ÄÇ Â¶ÇÊûúÂΩìÂâçÂ∑≤ÁªèÊ†áËÆ∞‰∏∫È••È•øÊ®°ÂºèÔºåÂπ∂‰∏îÊ≤°ÊúâÈîÅ‰ΩèÔºåÈÇ£‰πàËÆæÁΩÆnew‰∏∫È••È•øÊ®°Âºèif starving &amp;&amp; old&amp;mutexLocked != 0 { new |= mutexStarving} Â¶ÇÊûúÂî§ÈÜíÔºåÈúÄË¶ÅÂú®‰∏§ÁßçÊÉÖÂÜµ‰∏ãÈáçËÆæÊ†áÂøóif awoke { Â¶ÇÊûúÂî§ÈÜíÊ†áÂøó‰∏∫‰∏éawoke‰∏çÁõ∏ÂçèË∞ÉÂ∞±panic if new&amp;mutexWoken == 0 { throw(‚Äúsync: inconsistent mutex state‚Äù) } ËÆæÁΩÆÂî§ÈÜíÁä∂ÊÄÅ‰Ωç0,Ë¢´Âî§ÈÜí new &amp;^= mutexWoken} Â¶ÇÊûúËé∑ÂèñÈîÅÊàêÂäü old&amp;(mutexLocked|mutexStarving) == 0ÊàêÁ´ãË°®Á§∫Â∑≤ÁªèËé∑ÂèñÈîÅÔºåÂ∞±Áõ¥Êé•ÈÄÄÂá∫CAS ‰∏≠Èó¥Ëøô‰∏ÄÊÆµÊàëÂ∞±‰∏çÂ§öËß£Èáä‰∫ÜÔºåÂ∞±ÊòØÊúÄÂâçÈù¢Ê≥®ÈáäËØ¥ÁöÑÔºåÊª°Ë∂≥‰ªÄ‰πàÊù°‰ª∂ËΩ¨Êç¢‰ªÄ‰πàÊ®°ÂºèÔºå‰∏çÂ§öËØ¥‰∫Ü„ÄÇÁÑ∂Âêé‰ªéÈòüÂàó‰∏≠Ôºå‰πüÂ∞±ÊòØÂâç29‰Ωç-1„ÄÇÈúÄË¶ÅÊ≥®ÊÑèÂÖ∂‰∏≠Êúâ‰∏Ä‰∏™runtime_SemacquireMutexÂíå‰πãÂâçÁúãÁöÑÁöÑruntime_SemacquireÊòØ‰∏Ä‰∏™ÊÑèÊÄùÔºåÂè™ÊòØÂ§ö‰∫Ü‰∏Ä‰∏™ÂèÇÊï∞„ÄÇËøô‰∏™Â∞±ÊòØËøô‰∏™ÊñπÊ≥ïÁöÑÊ≥®Èáä„ÄÇÂèØ‰ª•ÁúãÂà∞ÔºåÂ∞±ÊòØÂ§ö‰∫Ü‰∏™ÈòüÂàóÂéªÊéíÈòü„ÄÇ Â¶ÇÊûúËé∑ÂèñÈîÅÂ§±Ë¥•ÔºåoldÂà∑Êñ∞Áä∂ÊÄÅÂÜçÊ¨°Âæ™ÁéØÔºåÁªßÁª≠cas UnLockÈáäÊîæÈîÅ UnlockÂ∞±Áõ∏ÂØπÁÆÄÂçï‰∏Ä‰∫õÔºåÁ´ûÊÄÅÂàÜÊûê‰∏çÁúã„ÄÇÂÖ∂ÂÆûÊàë‰ª¨Ëá™Â∑±ÊÉ≥‰πüËÉΩÊÉ≥Âà∞ÔºåunlockÂ∞±ÊòØÂ∞ÜÊ†áËØÜ‰ΩçÊîπÂõûÊù•Âòõ„ÄÇÁÑ∂ÂêéÂõ†‰∏∫Êàë‰ª¨Â∑≤ÁªèÁúãËøáËØªÂÜôÈîÅ‰∫ÜÔºå‰πüÊòØÂêåÊ†∑ÁöÑÈÅìÁêÜÔºåÂ¶ÇÊûúÊ≤°Êúâ‰∏äÈîÅÂ∞±Áõ¥Êé•Ëß£ÈîÅÔºåÈÇ£ËÇØÂÆöÊä•ÈîôÂòõ„ÄÇ ÁÑ∂ÂêéÂ¶ÇÊûúÊòØÊ≠£Â∏∏Ê®°ÂºèÔºåÂ¶ÇÊûúÊ≤°ÊúâÁ≠âÂæÖÁöÑgoroutineÊàñgoroutineÂ∑≤ÁªèËß£ÈîÅÂÆåÊàêÁöÑÊÉÖÂÜµÂ∞±Áõ¥Êé•ËøîÂõû‰∫Ü„ÄÇÂ¶ÇÊûúÊúâÁ≠âÂæÖÁöÑgoroutineÈÇ£Â∞±ÈÄöËøá‰ø°Âè∑ÈáèÂéªÂî§ÈÜíruntime_SemreleaseÔºàÊ≥®ÊÑèËøôÈáåÊòØfalseÔºâÔºåÂêåÊó∂Êìç‰Ωú‰∏Ä‰∏ãÈòüÂàó-1 Â¶ÇÊûúÊòØÈ••È•øÊ®°ÂºèÂ∞±Áõ¥Êé•Âî§ÈÜíÔºàÊ≥®ÊÑèËøôÈáåÊòØtrueÔºâÔºåÂèçÊ≠£ÊúâÈòüÂàóÂòõ„ÄÇ ‰∫íÊñ•ÈîÅÊÄªÁªìÂÖ∂ÂÆûËØùËØ¥ÂõûÊù•ÔºåÊàë‰ª¨ÂÖ∂ÂÆûÁúãËµ∑Êù•‰πüÁÆÄÂçïÔºåÊ≤°ÊúâÂÜ≤Á™ÅÁöÑÊÉÖÂÜµ‰∏ãÔºåËÉΩÊãøÂ∞±ÊãøÂëóÔºåÂ¶ÇÊûúÂá∫Áé∞ÂÜ≤Á™Å‰∫ÜÂ∞±Â∞ùËØïËá™ÊóãËß£ÂÜ≥ÔºàËá™Êóã‰∏ÄËà¨ÈÉΩËÉΩËß£ÂÜ≥ÔºâÂ¶ÇÊûúËß£ÂÜ≥‰∏ç‰∫ÜÂ∞±ÈÄöËøá‰ø°Âè∑ÈáèËß£ÂÜ≥ÔºåÂêåÊó∂Â¶ÇÊûúÊ≠£Â∏∏Ê®°ÂºèÂ∞±ÊòØÊàë‰ª¨ËØ¥ÁöÑÊä¢Âç†ÂºèÔºåÈùûÂÖ¨Âπ≥ÔºåÂ¶ÇÊûúÊòØÈ••È•øÊ®°ÂºèÔºåÂ∞±ÊòØÊàë‰ª¨ËØ¥ÁöÑÊéíÈòüÔºåÂÖ¨Âπ≥ÔºåÈò≤Ê≠¢Êúâ‰∏Ä‰∫õÂÄíÈúâËõã‰∏ÄÁõ¥Êä¢‰∏çÂà∞„ÄÇ Êï¥‰ΩìÊÄªÁªì‰∏Ä‰∏ãÔºåÁúãÂÆåÊ∫êÁ†ÅÊàë‰ª¨ÂèëÁé∞ÔºåÂÖ∂ÂÆûÈîÅÁöÑËÆæËÆ°Âπ∂‰∏çÂ§çÊùÇÔºå‰∏ªË¶ÅËÆæËÆ°Êàë‰ª¨Ë¶ÅÂ≠¶Âà∞casÂíåÂ§ÑÁêÜËØªÂÜôÁä∂ÊÄÅÁöÑ‰ø°Âè∑ÈáèÈÄöÁü•ÔºåÂØπ‰∫éÈÇ£‰∫õ‰ΩçÊìç‰ΩúÔºåËÉΩÁúãÊáÇÔºåÂ≠¶ÂèØËÉΩ‰∏ÄÊó∂Âçä‰ºöÂ≠¶‰∏ç‰ºöÔºåÂõ†‰∏∫ÂæàÈöæÂú®‰∏ÄÂºÄÂßãÂ∞±ËÆæËÆ°ÁöÑÈÇ£‰πàÂ∑ßÂ¶ôÔºå‰Ω†‰πü‰Ωì‰ºöÂà∞‰∫ÜÂè™Áî®‰∏Ä‰∏™ÂèòÈáèÂ∞±Áª¥Êä§‰∫ÜÊï¥‰∏™‰ΩìÁ≥ªÊòØ‰∏ÄÁßçËâ∫ÊúØ„ÄÇ]]></content>
      <categories>
        <category>golangÊ∫êÁ†ÅËß£Êûê</category>
      </categories>
      <tags>
        <tag>RWMutex</tag>
        <tag>Mutex</tag>
      </tags>
  </entry>
</search>
